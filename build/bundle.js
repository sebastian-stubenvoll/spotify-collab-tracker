/**
 * Copyright 2021 Sebastian Stubenvoll
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 *
 * ------------------
 *
 * For the respective dependency licenses see here: https://github.com/sebastian-stubenvoll/spotify-collab-tracker/blob/main/dependencies
 */

var app=function(){"use strict";function e(){}const t=e=>e;function n(e,t){for(const n in t)e[n]=t[n];return e}function r(e){return e()}function o(){return Object.create(null)}function i(e){e.forEach(r)}function s(e){return"function"==typeof e}function a(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function u(t,...n){if(null==t)return e;const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function c(e,t,n){e.$$.on_destroy.push(u(t,n))}function l(e,t,n,r){if(e){const o=f(e,t,n,r);return e[0](o)}}function f(e,t,r,o){return e[1]&&o?n(r.ctx.slice(),e[1](o(t))):r.ctx}function h(e,t,n,r){if(e[2]&&r){const o=e[2](r(n));if(void 0===t.dirty)return o;if("object"==typeof o){const e=[],n=Math.max(t.dirty.length,o.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|o[r];return e}return t.dirty|o}return t.dirty}function d(e,t,n,r,o,i){if(o){const s=f(t,n,r,i);e.p(s,o)}}function p(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function m(e){const t={};for(const n in e)"$"!==n[0]&&(t[n]=e[n]);return t}function y(e,t){const n={};t=new Set(t);for(const r in e)t.has(r)||"$"===r[0]||(n[r]=e[r]);return n}const g="undefined"!=typeof window;let v=g?()=>window.performance.now():()=>Date.now(),b=g?e=>requestAnimationFrame(e):e;const w=new Set;function _(e){w.forEach((t=>{t.c(e)||(w.delete(t),t.f())})),0!==w.size&&b(_)}function x(e){let t;return 0===w.size&&b(_),{promise:new Promise((n=>{w.add(t={c:e,f:n})})),abort(){w.delete(t)}}}function k(e,t){e.appendChild(t)}function $(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function C(e){const t=O("style");return function(e,t){k(e.head||e,t)}($(e),t),t.sheet}function S(e,t,n){e.insertBefore(t,n||null)}function E(e){e.parentNode.removeChild(e)}function T(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function O(e){return document.createElement(e)}function q(e){return document.createTextNode(e)}function j(){return q(" ")}function A(){return q("")}function I(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function N(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function D(e,t){const n=Object.getOwnPropertyDescriptors(e.__proto__);for(const r in t)null==t[r]?e.removeAttribute(r):"style"===r?e.style.cssText=t[r]:"__value"===r?e.value=e[r]=t[r]:n[r]&&n[r].set?e[r]=t[r]:N(e,r,t[r])}function R(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function M(e,t){e.value=null==t?"":t}function W(e,t,n){e.classList[n?"add":"remove"](t)}function Q(e,t,{bubbles:n=!1,cancelable:r=!1}={}){const o=document.createEvent("CustomEvent");return o.initCustomEvent(e,n,r,t),o}class L{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,n=null){var r;this.e||(this.is_svg?this.e=(r=t.nodeName,document.createElementNS("http://www.w3.org/2000/svg",r)):this.e=O(t.nodeName),this.t=t,this.c(e)),this.i(n)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)S(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(E)}}const P=new Map;let B,F=0;function U(e,t,n,r,o,i,s,a=0){const u=16.666/r;let c="{\n";for(let e=0;e<=1;e+=u){const r=t+(n-t)*i(e);c+=100*e+`%{${s(r,1-r)}}\n`}const l=c+`100% {${s(n,1-n)}}\n}`,f=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(l)}_${a}`,h=$(e),{stylesheet:d,rules:p}=P.get(h)||function(e,t){const n={stylesheet:C(t),rules:{}};return P.set(e,n),n}(h,e);p[f]||(p[f]=!0,d.insertRule(`@keyframes ${f} ${l}`,d.cssRules.length));const m=e.style.animation||"";return e.style.animation=`${m?`${m}, `:""}${f} ${r}ms linear ${o}ms 1 both`,F+=1,f}function V(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),o=n.length-r.length;o&&(e.style.animation=r.join(", "),F-=o,F||b((()=>{F||(P.forEach((e=>{const{stylesheet:t}=e;let n=t.cssRules.length;for(;n--;)t.deleteRule(n);e.rules={}})),P.clear())})))}function G(n,r,o,i){if(!r)return e;const s=n.getBoundingClientRect();if(r.left===s.left&&r.right===s.right&&r.top===s.top&&r.bottom===s.bottom)return e;const{delay:a=0,duration:u=300,easing:c=t,start:l=v()+a,end:f=l+u,tick:h=e,css:d}=o(n,{from:r,to:s},i);let p,m=!0,y=!1;function g(){d&&V(n,p),m=!1}return x((e=>{if(!y&&e>=l&&(y=!0),y&&e>=f&&(h(1,0),g()),!m)return!1;if(y){const t=0+1*c((e-l)/u);h(t,1-t)}return!0})),d&&(p=U(n,0,1,u,a,c,d)),a||(y=!0),h(0,1),g}function J(e){const t=getComputedStyle(e);if("absolute"!==t.position&&"fixed"!==t.position){const{width:n,height:r}=t,o=e.getBoundingClientRect();e.style.position="absolute",e.style.width=n,e.style.height=r,K(e,o)}}function K(e,t){const n=e.getBoundingClientRect();if(t.left!==n.left||t.top!==n.top){const r=getComputedStyle(e),o="none"===r.transform?"":r.transform;e.style.transform=`${o} translate(${t.left-n.left}px, ${t.top-n.top}px)`}}function H(e){B=e}function z(){if(!B)throw new Error("Function called outside component initialization");return B}function Y(e){z().$$.on_mount.push(e)}function X(e){z().$$.after_update.push(e)}function Z(e){z().$$.on_destroy.push(e)}function ee(){const e=z();return(t,n,{cancelable:r=!1}={})=>{const o=e.$$.callbacks[t];if(o){const i=Q(t,n,{cancelable:r});return o.slice().forEach((t=>{t.call(e,i)})),!i.defaultPrevented}return!0}}function te(e,t){return z().$$.context.set(e,t),t}function ne(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e.call(this,t)))}const re=[],oe=[],ie=[],se=[],ae=Promise.resolve();let ue=!1;function ce(){ue||(ue=!0,ae.then(ye))}function le(){return ce(),ae}function fe(e){ie.push(e)}function he(e){se.push(e)}const de=new Set;let pe,me=0;function ye(){const e=B;do{for(;me<re.length;){const e=re[me];me++,H(e),ge(e.$$)}for(H(null),re.length=0,me=0;oe.length;)oe.pop()();for(let e=0;e<ie.length;e+=1){const t=ie[e];de.has(t)||(de.add(t),t())}ie.length=0}while(re.length);for(;se.length;)se.pop()();ue=!1,de.clear(),H(e)}function ge(e){if(null!==e.fragment){e.update(),i(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(fe)}}function ve(){return pe||(pe=Promise.resolve(),pe.then((()=>{pe=null}))),pe}function be(e,t,n){e.dispatchEvent(Q(`${t?"intro":"outro"}${n}`))}const we=new Set;let _e;function xe(){_e={r:0,c:[],p:_e}}function ke(){_e.r||i(_e.c),_e=_e.p}function $e(e,t){e&&e.i&&(we.delete(e),e.i(t))}function Ce(e,t,n,r){if(e&&e.o){if(we.has(e))return;we.add(e),_e.c.push((()=>{we.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}const Se={duration:0};function Ee(n,r,o){let i,a,u=r(n,o),c=!1,l=0;function f(){i&&V(n,i)}function h(){const{delay:r=0,duration:o=300,easing:s=t,tick:h=e,css:d}=u||Se;d&&(i=U(n,0,1,o,r,s,d,l++)),h(0,1);const p=v()+r,m=p+o;a&&a.abort(),c=!0,fe((()=>be(n,!0,"start"))),a=x((e=>{if(c){if(e>=m)return h(1,0),be(n,!0,"end"),f(),c=!1;if(e>=p){const t=s((e-p)/o);h(t,1-t)}}return c}))}let d=!1;return{start(){d||(d=!0,V(n),s(u)?(u=u(),ve().then(h)):h())},invalidate(){d=!1},end(){c&&(f(),c=!1)}}}function Te(n,r,o){let a,u=r(n,o),c=!0;const l=_e;function f(){const{delay:r=0,duration:o=300,easing:s=t,tick:f=e,css:h}=u||Se;h&&(a=U(n,1,0,o,r,s,h));const d=v()+r,p=d+o;fe((()=>be(n,!1,"start"))),x((e=>{if(c){if(e>=p)return f(0,1),be(n,!1,"end"),--l.r||i(l.c),!1;if(e>=d){const t=s((e-d)/o);f(1-t,t)}}return c}))}return l.r+=1,s(u)?ve().then((()=>{u=u(),f()})):f(),{end(e){e&&u.tick&&u.tick(1,0),c&&(a&&V(n,a),c=!1)}}}function Oe(n,r,o,a){let u=r(n,o),c=a?0:1,l=null,f=null,h=null;function d(){h&&V(n,h)}function p(e,t){const n=e.b-c;return t*=Math.abs(n),{a:c,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function m(r){const{delay:o=0,duration:s=300,easing:a=t,tick:m=e,css:y}=u||Se,g={start:v()+o,b:r};r||(g.group=_e,_e.r+=1),l||f?f=g:(y&&(d(),h=U(n,c,r,s,o,a,y)),r&&m(0,1),l=p(g,s),fe((()=>be(n,r,"start"))),x((e=>{if(f&&e>f.start&&(l=p(f,s),f=null,be(n,l.b,"start"),y&&(d(),h=U(n,c,l.b,l.duration,0,a,u.css))),l)if(e>=l.end)m(c=l.b,1-c),be(n,l.b,"end"),f||(l.b?d():--l.group.r||i(l.group.c)),l=null;else if(e>=l.start){const t=e-l.start;c=l.a+l.d*a(t/l.duration),m(c,1-c)}return!(!l&&!f)})))}return{run(e){s(u)?ve().then((()=>{u=u(),m(e)})):m(e)},end(){d(),l=f=null}}}function qe(e,t){const n=t.token={};function r(e,r,o,i){if(t.token!==n)return;t.resolved=i;let s=t.ctx;void 0!==o&&(s=s.slice(),s[o]=i);const a=e&&(t.current=e)(s);let u=!1;t.block&&(t.blocks?t.blocks.forEach(((e,n)=>{n!==r&&e&&(xe(),Ce(e,1,1,(()=>{t.blocks[n]===e&&(t.blocks[n]=null)})),ke())})):t.block.d(1),a.c(),$e(a,1),a.m(t.mount(),t.anchor),u=!0),t.block=a,t.blocks&&(t.blocks[r]=a),u&&ye()}if((o=e)&&"object"==typeof o&&"function"==typeof o.then){const n=z();if(e.then((e=>{H(n),r(t.then,1,t.value,e),H(null)}),(e=>{if(H(n),r(t.catch,2,t.error,e),H(null),!t.hasCatch)throw e})),t.current!==t.pending)return r(t.pending,0),!0}else{if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved=e}var o}function je(e,t,n){const r=t.slice(),{resolved:o}=e;e.current===e.then&&(r[e.value]=o),e.current===e.catch&&(r[e.error]=o),e.block.p(r,n)}const Ae="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function Ie(e,t){e.f(),function(e,t){Ce(e,1,1,(()=>{t.delete(e.key)}))}(e,t)}function Ne(e,t,n,r,o,i,s,a,u,c,l,f){let h=e.length,d=i.length,p=h;const m={};for(;p--;)m[e[p].key]=p;const y=[],g=new Map,v=new Map;for(p=d;p--;){const e=f(o,i,p),a=n(e);let u=s.get(a);u?r&&u.p(e,t):(u=c(a,e),u.c()),g.set(a,y[p]=u),a in m&&v.set(a,Math.abs(p-m[a]))}const b=new Set,w=new Set;function _(e){$e(e,1),e.m(a,l),s.set(e.key,e),l=e.first,d--}for(;h&&d;){const t=y[d-1],n=e[h-1],r=t.key,o=n.key;t===n?(l=t.first,h--,d--):g.has(o)?!s.has(r)||b.has(r)?_(t):w.has(o)?h--:v.get(r)>v.get(o)?(w.add(r),_(t)):(b.add(o),h--):(u(n,s),h--)}for(;h--;){const t=e[h];g.has(t.key)||u(t,s)}for(;d;)_(y[d-1]);return y}function De(e,t){const n={},r={},o={$$scope:1};let i=e.length;for(;i--;){const s=e[i],a=t[i];if(a){for(const e in s)e in a||(r[e]=1);for(const e in a)o[e]||(n[e]=a[e],o[e]=1);e[i]=a}else for(const e in s)o[e]=1}for(const e in r)e in n||(n[e]=void 0);return n}function Re(e){return"object"==typeof e&&null!==e?e:{}}function Me(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function We(e){e&&e.c()}function Qe(e,t,n,o){const{fragment:a,on_mount:u,on_destroy:c,after_update:l}=e.$$;a&&a.m(t,n),o||fe((()=>{const t=u.map(r).filter(s);c?c.push(...t):i(t),e.$$.on_mount=[]})),l.forEach(fe)}function Le(e,t){const n=e.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Pe(t,n,r,s,a,u,c,l=[-1]){const f=B;H(t);const h=t.$$={fragment:null,ctx:null,props:u,update:e,not_equal:a,bound:o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(f?f.$$.context:[])),callbacks:o(),dirty:l,skip_bound:!1,root:n.target||f.$$.root};c&&c(h.root);let d=!1;if(h.ctx=r?r(t,n.props||{},((e,n,...r)=>{const o=r.length?r[0]:n;return h.ctx&&a(h.ctx[e],h.ctx[e]=o)&&(!h.skip_bound&&h.bound[e]&&h.bound[e](o),d&&function(e,t){-1===e.$$.dirty[0]&&(re.push(e),ce(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),n})):[],h.update(),d=!0,i(h.before_update),h.fragment=!!s&&s(h.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);h.fragment&&h.fragment.l(e),e.forEach(E)}else h.fragment&&h.fragment.c();n.intro&&$e(t.$$.fragment),Qe(t,n.target,n.anchor,n.customElement),ye()}H(f)}class Be{$destroy(){Le(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function Fe(e){let t;return{c(){t=O("i"),N(t,"class","loading-default svelte-10h86fq")},m(e,n){S(e,t,n)},d(e){e&&E(t)}}}function Ue(e){let t;return{c(){t=O("span"),t.innerHTML='<span class="wave-item svelte-10h86fq"></span> \n\t\t<span class="wave-item svelte-10h86fq"></span> \n\t\t<span class="wave-item svelte-10h86fq"></span> \n\t\t<span class="wave-item svelte-10h86fq"></span> \n\t\t<span class="wave-item svelte-10h86fq"></span>',N(t,"class","loading-wave-dots svelte-10h86fq")},m(e,n){S(e,t,n)},d(e){e&&E(t)}}}function Ve(e){let t;return{c(){t=O("i"),N(t,"class","loading-spiral svelte-10h86fq")},m(e,n){S(e,t,n)},d(e){e&&E(t)}}}function Ge(e){let t;return{c(){t=O("span"),t.innerHTML='<span class="circle-item svelte-10h86fq"></span> \n\t\t<span class="circle-item svelte-10h86fq"></span> \n\t\t<span class="circle-item svelte-10h86fq"></span> \n\t\t<span class="circle-item svelte-10h86fq"></span> \n\t\t<span class="circle-item svelte-10h86fq"></span> \n\t\t<span class="circle-item svelte-10h86fq"></span> \n\t\t<span class="circle-item svelte-10h86fq"></span> \n\t\t<span class="circle-item svelte-10h86fq"></span>',N(t,"class","loading-circles svelte-10h86fq")},m(e,n){S(e,t,n)},d(e){e&&E(t)}}}function Je(e){let t;return{c(){t=O("span"),t.innerHTML='<span class="bubble-item svelte-10h86fq"></span> \n\t\t<span class="bubble-item svelte-10h86fq"></span> \n\t\t<span class="bubble-item svelte-10h86fq"></span> \n\t\t<span class="bubble-item svelte-10h86fq"></span> \n\t\t<span class="bubble-item svelte-10h86fq"></span> \n\t\t<span class="bubble-item svelte-10h86fq"></span> \n\t\t<span class="bubble-item svelte-10h86fq"></span> \n\t\t<span class="bubble-item svelte-10h86fq"></span>',N(t,"class","loading-bubbles svelte-10h86fq")},m(e,n){S(e,t,n)},d(e){e&&E(t)}}}function Ke(t){let n;function r(e,t){return"bubbles"===e[0]?Je:"circles"===e[0]?Ge:"spiral"===e[0]?Ve:"wavedots"===e[0]?Ue:Fe}let o=r(t),i=o(t);return{c(){i.c(),n=A()},m(e,t){i.m(e,t),S(e,n,t)},p(e,[t]){o!==(o=r(e))&&(i.d(1),i=o(e),i&&(i.c(),i.m(n.parentNode,n)))},i:e,o:e,d(e){i.d(e),e&&E(n)}}}function He(e,t,n){let{spinner:r=""}=t;return e.$$set=e=>{"spinner"in e&&n(0,r=e.spinner)},[r]}class ze extends Be{constructor(e){super(),Pe(this,e,He,Ke,a,{spinner:0})}}const Ye=e=>({}),Xe=e=>({attemptLoad:e[7]}),Ze=e=>({}),et=e=>({}),tt=e=>({}),nt=e=>({}),rt=e=>({isFirstLoad:2&e}),ot=e=>({isFirstLoad:e[1]});function it(e){let t,n;const r=e[15].spinner,o=l(r,e,e[14],ot),i=o||function(e){let t,n;return t=new ze({props:{spinner:e[0]}}),{c(){We(t.$$.fragment)},m(e,r){Qe(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.spinner=e[0]),t.$set(r)},i(e){n||($e(t.$$.fragment,e),n=!0)},o(e){Ce(t.$$.fragment,e),n=!1},d(e){Le(t,e)}}}(e);return{c(){t=O("div"),i&&i.c(),N(t,"class","infinite-status-prompt")},m(e,r){S(e,t,r),i&&i.m(t,null),n=!0},p(e,t){o?o.p&&(!n||16386&t)&&d(o,r,e,e[14],n?h(r,e[14],t,rt):p(e[14]),ot):i&&i.p&&(!n||1&t)&&i.p(e,n?t:-1)},i(e){n||($e(i,e),n=!0)},o(e){Ce(i,e),n=!1},d(e){e&&E(t),i&&i.d(e)}}}function st(e){let t,n;const r=e[15].noResults,o=l(r,e,e[14],nt),i=o||function(e){let t;return{c(){t=q("No results :(")},m(e,n){S(e,t,n)},d(e){e&&E(t)}}}();return{c(){t=O("div"),i&&i.c(),N(t,"class","infinite-status-prompt")},m(e,r){S(e,t,r),i&&i.m(t,null),n=!0},p(e,t){o&&o.p&&(!n||16384&t)&&d(o,r,e,e[14],n?h(r,e[14],t,tt):p(e[14]),nt)},i(e){n||($e(i,e),n=!0)},o(e){Ce(i,e),n=!1},d(e){e&&E(t),i&&i.d(e)}}}function at(e){let t,n;const r=e[15].noMore,o=l(r,e,e[14],et),i=o||function(e){let t;return{c(){t=q("No more data :)")},m(e,n){S(e,t,n)},d(e){e&&E(t)}}}();return{c(){t=O("div"),i&&i.c(),N(t,"class","infinite-status-prompt")},m(e,r){S(e,t,r),i&&i.m(t,null),n=!0},p(e,t){o&&o.p&&(!n||16384&t)&&d(o,r,e,e[14],n?h(r,e[14],t,Ze):p(e[14]),et)},i(e){n||($e(i,e),n=!0)},o(e){Ce(i,e),n=!1},d(e){e&&E(t),i&&i.d(e)}}}function ut(t){let n,r;const o=t[15].error,i=l(o,t,t[14],Xe),s=i||function(t){let n,r,o,i,s,a;return{c(){n=q("Oops, something went wrong :(\n\t\t\t\t"),r=O("br"),o=j(),i=O("button"),i.textContent="Retry",N(i,"class","btn-try-infinite svelte-o3w4bf")},m(e,u){S(e,n,u),S(e,r,u),S(e,o,u),S(e,i,u),s||(a=I(i,"click",t[7]),s=!0)},p:e,d(e){e&&E(n),e&&E(r),e&&E(o),e&&E(i),s=!1,a()}}}(t);return{c(){n=O("div"),s&&s.c(),N(n,"class","infinite-status-prompt")},m(e,t){S(e,n,t),s&&s.m(n,null),r=!0},p(e,t){i&&i.p&&(!r||16384&t)&&d(i,o,e,e[14],r?h(o,e[14],t,Ye):p(e[14]),Xe)},i(e){r||($e(s,e),r=!0)},o(e){Ce(s,e),r=!1},d(e){e&&E(n),s&&s.d(e)}}}function ct(e){let t,n,r,o,i,s=e[6]&&it(e),a=e[4]&&st(e),u=e[3]&&at(e),c=e[5]&&ut(e);return{c(){t=O("div"),s&&s.c(),n=j(),a&&a.c(),r=j(),u&&u.c(),o=j(),c&&c.c(),N(t,"class","infinite-loading-container svelte-o3w4bf")},m(l,f){S(l,t,f),s&&s.m(t,null),k(t,n),a&&a.m(t,null),k(t,r),u&&u.m(t,null),k(t,o),c&&c.m(t,null),e[16](t),i=!0},p(e,[i]){e[6]?s?(s.p(e,i),64&i&&$e(s,1)):(s=it(e),s.c(),$e(s,1),s.m(t,n)):s&&(xe(),Ce(s,1,1,(()=>{s=null})),ke()),e[4]?a?(a.p(e,i),16&i&&$e(a,1)):(a=st(e),a.c(),$e(a,1),a.m(t,r)):a&&(xe(),Ce(a,1,1,(()=>{a=null})),ke()),e[3]?u?(u.p(e,i),8&i&&$e(u,1)):(u=at(e),u.c(),$e(u,1),u.m(t,o)):u&&(xe(),Ce(u,1,1,(()=>{u=null})),ke()),e[5]?c?(c.p(e,i),32&i&&$e(c,1)):(c=ut(e),c.c(),$e(c,1),c.m(t,null)):c&&(xe(),Ce(c,1,1,(()=>{c=null})),ke())},i(e){i||($e(s),$e(a),$e(u),$e(c),i=!0)},o(e){Ce(s),Ce(a),Ce(u),Ce(c),i=!1},d(n){n&&E(t),s&&s.d(),a&&a.d(),u&&u.d(),c&&c.d(),e[16](null)}}}const lt=["executed the callback function more than 10 times for a short time, it looks like searched a wrong scroll wrapper that doest not has fixed height or maximum height, please check it. If you want to force to set a element as scroll wrapper rather than automatic searching, you can do this:","\x3c!-- add a special attribute for the real scroll wrapper (can also be data-infinite-wrapper) --\x3e","<div infinite-wrapper>","  ...","  \x3c!-- set forceUseInfiniteWrapper --\x3e","  <InfiniteLoading forceUseInfiniteWrapper>","</div>","or",'<div class="infinite-wrapper">',"  ...","  \x3c!-- set forceUseInfiniteWrapper as css selector of the real scroll wrapper --\x3e",'  <InfiniteLoading forceUseInfiniteWrapper=".infinite-wrapper" />',"</div>"].join("\n"),ft=(()=>{let e=!1;try{const t=Object.defineProperty({},"passive",{get:()=>(e={passive:!0},!0)});window.addEventListener("testPassive",null,t),window.removeEventListener("testPassive",null,t)}catch(e){}return e})(),ht={timers:[],caches:[],throttle(e){-1===this.caches.indexOf(e)&&(this.caches.push(e),this.timers.push(setTimeout((()=>{e(),this.caches.splice(this.caches.indexOf(e),1),this.timers.shift()}),50)))},reset(){this.timers.forEach((e=>{clearTimeout(e)})),this.timers.length=0,this.caches=[]}},dt={isChecked:!1,timer:null,times:0,track(){this.times+=1,clearTimeout(this.timer),this.timer=setTimeout((()=>{this.isChecked=!0}),1e3),this.times>10&&(console.error(lt),this.isChecked=!0)}},pt={key:"_infiniteScrollHeight",getScrollElement:e=>e===window?document.documentElement:e,save(e){const t=this.getScrollElement(e);t[this.key]=t.scrollHeight},restore(e){const t=this.getScrollElement(e);"number"==typeof t[this.key]&&(t.scrollTop=t.scrollHeight-t[this.key]+t.scrollTop),this.remove(t)},remove(e){void 0!==e[this.key]&&delete e[this.key]}};function mt(e){return e&&e.offsetWidth+e.offsetHeight>0}function yt(e,t,n){let r,o,i,s,{$$slots:a={},$$scope:u}=t;const c=ee(),l=0,f=1,h=2,d=3;let p,m,{distance:y=100}=t,{spinner:g="default"}=t,{direction:v="bottom"}=t,{forceUseInfiniteWrapper:b=!1}=t,{identifier:w=+new Date}=t,_=!0,x=l,k=!1;const $={loaded:async()=>{n(1,_=!1),"top"===v&&(await le(),pt.restore(m)),x===f&&(await le(),await S(!0))},complete:async()=>{n(12,x=h),await le(),m.removeEventListener("scroll",C,ft)},reset:async()=>{n(12,x=l),n(1,_=!0),pt.remove(m),m.addEventListener("scroll",C,ft),setTimeout((()=>{ht.reset(),C()}),1)},error:()=>{n(12,x=d),ht.reset()}};function C(e){x===l&&(e&&e.constructor===Event&&mt(p)?ht.throttle(S):S())}async function S(e){x!==h&&mt(p)&&function(){let e;if("top"===v)e="number"==typeof m.scrollTop?m.scrollTop:m.pageYOffset;else{e=p.getBoundingClientRect().top-(m===window?window.innerHeight:m.getBoundingClientRect().bottom)}return e}()<=y?(n(12,x=f),"top"===v&&(await le(),pt.save(m)),c("infinite",$),!e||b||dt.isChecked||dt.track()):x===f&&n(12,x=l)}function E(e=p){let t;return"string"==typeof b&&(t=document.querySelector(b)),t||("BODY"===e.tagName?t=window:(!b&&["scroll","auto"].indexOf(getComputedStyle(e).overflowY)>-1||e.hasAttribute("infinite-wrapper")||e.hasAttribute("data-infinite-wrapper"))&&(t=e)),t||E(e.parentNode)}function T(){k&&(m=E())}return Y((async()=>{n(13,k=!0),setTimeout((()=>{C(),m.addEventListener("scroll",C,ft)}),1)})),Z((()=>{k&&x!==h&&(ht.reset(),pt.remove(m),m.removeEventListener("scroll",C,ft))})),e.$$set=e=>{"distance"in e&&n(8,y=e.distance),"spinner"in e&&n(0,g=e.spinner),"direction"in e&&n(9,v=e.direction),"forceUseInfiniteWrapper"in e&&n(10,b=e.forceUseInfiniteWrapper),"identifier"in e&&n(11,w=e.identifier),"$$scope"in e&&n(14,u=e.$$scope)},e.$$.update=()=>{4096&e.$$.dirty&&n(6,r=x===f),4096&e.$$.dirty&&n(5,o=x===d),4098&e.$$.dirty&&n(4,i=x===h&&_),4098&e.$$.dirty&&n(3,s=x===h&&!_),9216&e.$$.dirty&&T(),10240&e.$$.dirty&&k&&$.reset()},[g,_,p,s,i,o,r,S,y,v,b,w,x,k,u,a,function(e){oe[e?"unshift":"push"]((()=>{p=e,n(2,p)}))}]}class gt extends Be{constructor(e){super(),Pe(this,e,yt,ct,a,{distance:8,spinner:0,direction:9,forceUseInfiniteWrapper:10,identifier:11})}}function vt(e){return("0"+e.toString(16)).substr(-2)}function bt(){const e=new Uint32Array(28);return window.crypto.getRandomValues(e),Array.from(e,vt).join("")}async function wt(e){const t=await function(e){const t=(new TextEncoder).encode(e);return window.crypto.subtle.digest("SHA-256",t)}(e);var n;return n=t,btoa(String.fromCharCode.apply(null,new Uint8Array(n))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const _t="0a004f36100a460ca97d2d99f485af2f",xt="https://sebastian-stubenvoll.github.io/spotify-collab-tracker";let kt,$t,Ct,St;async function Et(){const e="client_id="+_t,t="redirect_uri="+encodeURIComponent(xt),n=bt();localStorage.setItem("state",n);const r="state="+n,o="scope="+encodeURIComponent("playlist-read-private playlist-read-collaborative");return"https://accounts.spotify.com/authorize?"+[e,"response_type=code",t,await async function(e){return"code_challenge="+await wt(e)}(function(){const e=bt();return localStorage.setItem("verifier",e),e}()),"code_challenge_method=S256",r,o].join("&")}const Tt=async function(){clearInterval(St),console.log("Refreshing access token...");let e=[];const t={grant_type:"refresh_token",refresh_token:$t,client_id:_t};for(let n in t){const r=encodeURIComponent(n),o=encodeURIComponent(t[n]);e.push(r+"="+o)}e=e.join("&");const n=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e}),r=await n.json();kt=r.access_token,$t=r.refresh_token,Ct=1e3*r.expires_in,St=setInterval(Tt,Ct-.1*Ct)};function Ot(e){return{Authorization:"Bearer "+e}}async function qt(e,t){const n="https://api.spotify.com/v1/users/"+t,r=await fetch(n,{method:"GET",headers:Ot(e)}),o=await r.json();return[o.display_name,o.images]}function jt(e){var t={exports:{}};return e(t,t.exports),t.exports
/*!
     * @license :jsstore - V4.3.10 - 24/07/2022
     * https://github.com/ujjwalguptaofficial/JsStore
     * Copyright (c) 2022 @Ujjwal Gupta; Licensed MIT
     */}var At=jt((function(e){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}({2:function(e,t,n){n.r(t),n.d(t,"Connection",(function(){return w})),n.d(t,"ERROR_TYPE",(function(){return r})),n.d(t,"WORKER_STATUS",(function(){return o})),n.d(t,"DATA_TYPE",(function(){return i})),n.d(t,"API",(function(){return s})),n.d(t,"EVENT",(function(){return a})),n.d(t,"QUERY_OPTION",(function(){return u})),n.d(t,"IDB_MODE",(function(){return c})),n.d(t,"OCCURENCE",(function(){return l})),n.d(t,"CONNECTION_STATUS",(function(){return f})),n.d(t,"promise",(function(){return p})),n.d(t,"promiseAll",(function(){return _})),n.d(t,"promiseResolve",(function(){return m})),n.d(t,"forObj",(function(){return x}));var r,o,i,s,a,u,c,l,f,h=function(){function e(e,t){this.type=e,this._info=t,this.message=this.getMsg()}return e.prototype.throw=function(){throw this},e.prototype.log=function(e){this.status&&console.log(e)},e.prototype.logError=function(){console.error(this.get())},e.prototype.logWarning=function(){console.warn(this.get())},e.prototype.get=function(){return{message:this.message,type:this.type}},e.prototype.getMsg=function(){return this.type,this.message},e}();!function(e){e.InvalidUpdateColumn="invalid_update_column",e.UndefinedColumn="undefined_column",e.UndefinedValue="undefined_value",e.UndefinedColumnName="undefined_column_name",e.UndefinedDbName="undefined_database_name",e.UndefinedColumnValue="undefined_column_value",e.NotArray="not_array",e.NoValueSupplied="no_value_supplied",e.ColumnNotExist="column_not_exist",e.EnableSearchOff="enable_search_off",e.InvalidOp="invalid_operator",e.NullValue="null_value",e.WrongDataType="wrong_data_type",e.TableNotExist="table_not_exist",e.DbNotExist="db_not_exist",e.ConnectionAborted="connection_aborted",e.ConnectionClosed="connection_closed",e.NotObject="not_object",e.InvalidConfig="invalid_config",e.DbBlocked="Db_blocked",e.IndexedDbNotSupported="indexeddb_not_supported",e.NullValueInWhere="null_value_in_where",e.InvalidJoinQuery="invalid_join_query",e.InvalidOrderQuery="invalid_order_query",e.InvalidQuery="invalid_query",e.InvalidGroupQuery="invalid_group_query",e.ImportScriptsFailed="import_scripts_failed",e.MethodNotExist="method_not_exist",e.Unknown="unknown",e.InvalidMiddleware="invalid_middleware"}(r||(r={})),function(e){e.Registered="registerd",e.Failed="failed",e.NotStarted="not_started"}(o||(o={})),function(e){e.String="string",e.Object="object",e.Array="array",e.Number="number",e.Boolean="boolean",e.Null="null",e.DateTime="date_time"}(i||(i={})),function(e){e.InitDb="init_db",e.Get="get",e.Set="set",e.Select="select",e.Insert="insert",e.Update="update",e.Remove="remove",e.OpenDb="open_db",e.Clear="clear",e.DropDb="drop_db",e.Count="count",e.ChangeLogStatus="change_log_status",e.Terminate="terminate",e.Transaction="transaction",e.CloseDb="close_db",e.Union="union",e.Intersect="intersect",e.ImportScripts="import_scripts",e.Middleware="middleware"}(s||(s={})),function(e){e.RequestQueueEmpty="requestQueueEmpty",e.RequestQueueFilled="requestQueueFilled",e.Upgrade="upgrade",e.Create="create",e.Open="open"}(a||(a={})),function(e){e.Where="where",e.Like="like",e.Regex="regex",e.In="in",e.Equal="=",e.Between="-",e.GreaterThan=">",e.LessThan="<",e.GreaterThanEqualTo=">=",e.LessThanEqualTo="<=",e.NotEqualTo="!=",e.Aggregate="aggregate",e.Max="max",e.Min="min",e.Avg="avg",e.Count="count",e.Sum="sum",e.Or="or",e.Skip="skip",e.Limit="limit",e.And="and",e.IgnoreCase="ignoreCase",e.Then="then"}(u||(u={})),function(e){e.ReadOnly="readonly",e.ReadWrite="readwrite"}(c||(c={})),function(e){e.First="f",e.Last="l",e.Any="a"}(l||(l={})),function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_started",e.UnableToStart="unable_to_start",e.ClosedByJsStore="closed_by_jsstore"}(f||(f={}));var d,p=function(e){return new Promise(e)},m=function(e){return Promise.resolve(e)},y=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},g=function(){function e(e){this._events={},this._ctx=e}return e.prototype.on=function(e,t){return null==this._events[e]&&(this._events[e]=[]),this._events[e].push(t),this},e.prototype.off=function(e,t){if(this._events[e])if(t){var n=this._events[e].indexOf(t);this._events[e].splice(n,1)}else this._events[e]=[]},e.prototype.emit=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=this._events[e]||[],i=0,s=o.length,a=[],u=function(){var e=o[i++];if(e){var r=e.call.apply(e,y([t._ctx],n));return r&&r.then?r:Promise.resolve(r)}};return new Promise((function(e){var t=function(){i<s?u().then((function(e){a.push(e),t()})):e(a)};t()}))},e.prototype.destroy=function(){this._events=null,this._ctx=null},e}(),v=function(){function e(e){this.isConOpened_=!1,this.isDbIdle_=!0,this.requestQueue_=[],this.isCodeExecuting_=!1,this.inactivityTimer_=-1e3,this.middlewares=[],this.eventBus_=new g(this),this.whiteListApi_=[s.InitDb,s.OpenDb,s.Get,s.Set,s.ChangeLogStatus,s.Terminate,s.DropDb],this.isWorker=!0,this.logger=new h(null),e?(this.worker_=e,this.worker_.onmessage=this.onMessageFromWorker_.bind(this)):(this.isWorker=!1,this.initQueryManager_())}return Object.defineProperty(e.prototype,"jsstoreWorker",{get:function(){return this.$worker||self.JsStoreWorker},enumerable:!1,configurable:!0}),e.prototype.initQueryManager_=function(){var e=this.jsstoreWorker;e&&(this.queryManager=new e.QueryManager(this.processFinishedQuery_.bind(this)))},e.prototype.onMessageFromWorker_=function(e){this.processFinishedQuery_(e.data)},e.prototype.processFinishedQuery_=function(e){var t=this.requestQueue_.shift();if(t){if(this.logger.log("request "+t.name+" finished"),e.error)t.onError(e.error);else{switch(t.name){case s.OpenDb:case s.InitDb:this.isConOpened_=!0;break;case s.Terminate:this.isConOpened_=!1,!0===this.isWorker&&this.worker_.terminate();case s.DropDb:this.isConOpened_=!1,this.requestQueue_=[],this.isDbIdle_=!0;break;case s.CloseDb:this.requestQueue_.length>0?this.openDb_():(this.isDbIdle_=!0,this.eventBus_.emit(a.RequestQueueEmpty,[]))}t.onSuccess(e.result)}this.isCodeExecuting_=!1,this.executeQry_()}},e.prototype.openDb_=function(){this.prcoessExecutionOfQry_({name:s.OpenDb,query:{name:this.database.name,version:this.database.version},onSuccess:function(){},onError:function(e){console.error(e)}},0)},e.prototype.executeMiddleware_=function(e){var t=this;return p((function(n){var r=0,o=t.middlewares.length-1,i=function(){if(r<=o){var s=t.middlewares[r++](e);s&&s.then||(s=m(s)),s.then((function(e){i()}))}else n()};i()}))},e.prototype.callResultMiddleware=function(e,t){return p((function(n){var r=0,o=e.length-1,i=function(){if(r<=o){var s=e[r++](t);s.then||(s=m(s)),s.then((function(e){t=e,i()}))}else n(t)};i()}))},e.prototype.pushApi=function(e){var t=this;return new Promise((function(n,r){var o=[];e.onResult=function(e){o.push((function(t){return e(t)}))},t.executeMiddleware_(e).then((function(){(e.onSuccess=function(r){t.callResultMiddleware(o,r).then((function(e){n(e)})).catch((function(t){e.onError(t)}))},e.onError=function(e){o=[],r(e)},0===t.requestQueue_.length)&&(t.eventBus_.emit(a.RequestQueueFilled,[]),!([s.CloseDb,s.DropDb,s.OpenDb,s.Terminate].indexOf(e.name)>=0)&&t.isDbIdle_&&t.isConOpened_?t.openDb_():clearTimeout(t.inactivityTimer_));t.prcoessExecutionOfQry_(e)})).catch(r)}))},e.prototype.prcoessExecutionOfQry_=function(e,t){this.isDbIdle_=!1,null!=t?this.requestQueue_.splice(t,0,e):this.requestQueue_.push(e),this.logger.log("request pushed: "+e.name),this.executeQry_()},e.prototype.executeQry_=function(){var e=this,t=this.requestQueue_.length;if(!this.isCodeExecuting_&&t>0){if(!0===this.isConOpened_)return void this.sendRequestToWorker_(this.requestQueue_[0]);var n=this.requestQueue_.findIndex((function(t){return e.whiteListApi_.indexOf(t.name)>=0}));n>=0&&(this.requestQueue_.splice(0,0,this.requestQueue_.splice(n,1)[0]),this.sendRequestToWorker_(this.requestQueue_[0]))}else 0===t&&!1===this.isDbIdle_&&this.isConOpened_&&(this.inactivityTimer_=setTimeout((function(){e.prcoessExecutionOfQry_({name:s.CloseDb,onSuccess:function(){},onError:function(e){console.error(e)}})}),100))},e.prototype.sendRequestToWorker_=function(e){this.isCodeExecuting_=!0,this.logger.log("request executing: "+e.name);var t={name:e.name,query:e.query};!0===this.isWorker?this.worker_.postMessage(t):this.queryManager.run(t)},e}(),b=(d=function(e,t){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},d(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),w=function(e){function t(t){return e.call(this,t)||this}return b(t,e),t.prototype.initDb=function(e){var t=this;return this.database=e,this.pushApi({name:s.InitDb,query:e}).then((function(e){var n,r=e.database;return e.isCreated&&(n=e.oldVersion?t.eventBus_.emit(a.Upgrade,r,e.oldVersion,e.newVersion):t.eventBus_.emit(a.Create,r)),(n||m()).then((function(e){return t.eventBus_.emit(a.Open,r)})).then((function(t){return e.isCreated}))}))},t.prototype.dropDb=function(){return this.pushApi({name:s.DropDb})},t.prototype.select=function(e){return this.pushApi({name:s.Select,query:e})},t.prototype.count=function(e){return this.pushApi({name:s.Count,query:e})},t.prototype.insert=function(e){return this.pushApi({name:s.Insert,query:e})},t.prototype.update=function(e){return this.pushApi({name:s.Update,query:e})},t.prototype.remove=function(e){return this.pushApi({name:s.Remove,query:e})},t.prototype.clear=function(e){return this.pushApi({name:s.Clear,query:e})},Object.defineProperty(t.prototype,"logStatus",{set:function(e){this.logger.status=e,this.pushApi({name:s.ChangeLogStatus,query:e})},enumerable:!1,configurable:!0}),t.prototype.openDb=function(e,t){var n=this;return this.pushApi({name:s.OpenDb,query:{version:t,name:e}}).then((function(e){return n.database=e,e}))},t.prototype.getDbList=function(){return console.warn("Api getDbList is recommended to use for debugging only. Do not use in code."),indexedDB.databases()},t.prototype.get=function(e){return this.pushApi({name:s.Get,query:e})},t.prototype.set=function(e,t){return this.pushApi({name:s.Set,query:{key:e,value:t}})},t.prototype.terminate=function(){return this.pushApi({name:s.Terminate})},t.prototype.transaction=function(e){return this.pushApi({name:s.Transaction,query:e})},t.prototype.on=function(e,t){this.eventBus_.on(e,t)},t.prototype.off=function(e,t){this.eventBus_.off(e,t)},t.prototype.union=function(e){return this.pushApi({name:s.Union,query:e})},t.prototype.intersect=function(e){return this.pushApi({name:s.Intersect,query:e})},t.prototype.addPlugin=function(e,t){return e.setup(this,t)},t.prototype.addMiddleware=function(e,t){return t?this.pushApi({name:s.Middleware,query:e}):(this.middlewares.push(e),Promise.resolve())},t.prototype.importScripts=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.pushApi({name:s.ImportScripts,query:e})},t}(v),_=function(e){return Promise.all(e)},x=function(e,t){for(var n in e)t(n,e[n])}}})})),It=At,Nt=jt((function(e){e.exports=It})),Dt=jt((function(e){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}({2:function(e,t,n){n.r(t),n.d(t,"QueryManager",(function(){return Ke}));var r,o,i,s,a,u,c,l,f,h=function(e){return Promise.resolve(e)},d=function(e){return new Promise(e)};!function(e){e.InvalidUpdateColumn="invalid_update_column",e.UndefinedColumn="undefined_column",e.UndefinedValue="undefined_value",e.UndefinedColumnName="undefined_column_name",e.UndefinedDbName="undefined_database_name",e.UndefinedColumnValue="undefined_column_value",e.NotArray="not_array",e.NoValueSupplied="no_value_supplied",e.ColumnNotExist="column_not_exist",e.EnableSearchOff="enable_search_off",e.InvalidOp="invalid_operator",e.NullValue="null_value",e.WrongDataType="wrong_data_type",e.TableNotExist="table_not_exist",e.DbNotExist="db_not_exist",e.ConnectionAborted="connection_aborted",e.ConnectionClosed="connection_closed",e.NotObject="not_object",e.InvalidConfig="invalid_config",e.DbBlocked="Db_blocked",e.IndexedDbNotSupported="indexeddb_not_supported",e.NullValueInWhere="null_value_in_where",e.InvalidJoinQuery="invalid_join_query",e.InvalidOrderQuery="invalid_order_query",e.InvalidQuery="invalid_query",e.InvalidGroupQuery="invalid_group_query",e.ImportScriptsFailed="import_scripts_failed",e.MethodNotExist="method_not_exist",e.Unknown="unknown",e.InvalidMiddleware="invalid_middleware"}(r||(r={})),function(e){e.Registered="registerd",e.Failed="failed",e.NotStarted="not_started"}(o||(o={})),function(e){e.String="string",e.Object="object",e.Array="array",e.Number="number",e.Boolean="boolean",e.Null="null",e.DateTime="date_time"}(i||(i={})),function(e){e.InitDb="init_db",e.Get="get",e.Set="set",e.Select="select",e.Insert="insert",e.Update="update",e.Remove="remove",e.OpenDb="open_db",e.Clear="clear",e.DropDb="drop_db",e.Count="count",e.ChangeLogStatus="change_log_status",e.Terminate="terminate",e.Transaction="transaction",e.CloseDb="close_db",e.Union="union",e.Intersect="intersect",e.ImportScripts="import_scripts",e.Middleware="middleware"}(s||(s={})),function(e){e.RequestQueueEmpty="requestQueueEmpty",e.RequestQueueFilled="requestQueueFilled",e.Upgrade="upgrade",e.Create="create",e.Open="open"}(a||(a={})),function(e){e.Where="where",e.Like="like",e.Regex="regex",e.In="in",e.Equal="=",e.Between="-",e.GreaterThan=">",e.LessThan="<",e.GreaterThanEqualTo=">=",e.LessThanEqualTo="<=",e.NotEqualTo="!=",e.Aggregate="aggregate",e.Max="max",e.Min="min",e.Avg="avg",e.Count="count",e.Sum="sum",e.Or="or",e.Skip="skip",e.Limit="limit",e.And="and",e.IgnoreCase="ignoreCase",e.Then="then"}(u||(u={})),function(e){e.ReadOnly="readonly",e.ReadWrite="readwrite"}(c||(c={})),function(e){e.First="f",e.Last="l",e.Any="a"}(l||(l={})),function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_started",e.UnableToStart="unable_to_start",e.ClosedByJsStore="closed_by_jsstore"}(f||(f={}));var p,m=function(){function e(e){this.columns=[],this.autoIncColumnValue={},this.columns=this.setColumn(e.columns),this.name=e.name,this.alter=e.alter||{}}return e.prototype.setColumn=function(e){var t=[],n=function(n){var o=e[n];o.name=n,o.autoIncrement&&(r.autoIncColumnValue[n]=0),o.primaryKey&&(r.primaryKey=n),o.enableSearch=null==o.enableSearch||o.enableSearch;var i=r.columns.indexOf((function(e){return e.name===n}));if(i<0)t.push(o);else{var s=r.columns[i];Object.assign(s,o)}},r=this;for(var o in e)n(o);return t},e}(),y=function(){function e(){}return e.autoIncrementKey=function(e,t){return"JsStore_"+e+"_"+t+"_Value"},e.set=function(t,n,r){r.tx||r.createTransaction([e.tableName]);var o=r.objectStore(e.tableName);return d((function(e,r){var i=o.put({key:t,value:n});i.onsuccess=function(){e()},i.onerror=r}))},e.get=function(t,n){n.tx||n.createTransaction([e.tableName]);var r=n.objectStore(e.tableName);return d((function(e,o){var i=r.get(n.keyRange(t));i.onsuccess=function(){var t=i.result;e(t&&t.value)},i.onerror=o}))},e.remove=function(t,n){n.tx||n.createTransaction([e.tableName]);var r=n.objectStore(e.tableName);return d((function(e,o){var i=r.delete(n.keyRange(t));i.onsuccess=e,i.onerror=o}))},e.tableName="JsStore_Meta",e.dbSchema="JsStore_DbSchema",e}(),g=function(e){this.name=e.name,this.version=e.version||1,e.tables.push({name:y.tableName,columns:{key:{primaryKey:!0},value:{enableSearch:!1}}}),this.tables=e.tables.map((function(e){return new m(e)}))},v=function(e,t){for(var n in e)t(n,e[n])},b=function(){function e(e,t){this.type=e,this.info_=t,this.message=this.getMsg_()}return e.prototype.log=function(e){this.status&&console.log(e)},e.prototype.throw=function(){throw this.get()},e.prototype.logError=function(){console.error(this.get())},e.prototype.get=function(){return{message:this.message,type:this.type}},e.prototype.getMsg_=function(){var e;switch(this.type){case r.NotArray:e="Supplied value is not an array";break;case r.UndefinedColumn:e="Column is undefined in Where";break;case r.UndefinedValue:e="Value is undefined in Where";break;case r.UndefinedColumnName:e="Column name is undefined '"+this.info_.TableName+"'";break;case r.UndefinedDbName:e="Database name is not supplied";break;case r.UndefinedColumnValue:e="Column value is undefined";break;case r.NoValueSupplied:e="No value is supplied";break;case r.InvalidOp:e="Invalid Op Value '"+this.info_.Op+"'";break;case r.ColumnNotExist:e=this.info_.isOrder?"Column '"+this.info_.column+"' in order query does not exist":"Column '"+this.info_.column+"' does not exist";break;case r.EnableSearchOff:e="Search is turned off for the Column '"+this.info_.column+"'";break;case r.NullValue:e="Null value is not allowed for column '"+this.info_.ColumnName+"'";break;case r.WrongDataType:e="Supplied value for column '"+this.info_.column+"' have wrong data type";break;case r.TableNotExist:e="Table '"+this.info_.tableName+"' does not exist";break;case r.DbNotExist:e="Database with name "+this.info_.dbName+" does not exist";break;case r.NotObject:e="supplied value is not object";break;case r.InvalidOp:e="Invalid Config '"+this.info_.Config+" '";break;case r.DbBlocked:e="database is blocked, cant be deleted right now";break;case r.NullValueInWhere:e="Null/undefined is not allowed in where. Column '"+this.info_.column+"' has null";break;case r.MethodNotExist:e="method '"+this.info_+"' does not exist.";break;case r.IndexedDbNotSupported:e="Browser does not support indexeddb";break;case r.InvalidJoinQuery:case r.InvalidGroupQuery:case r.InvalidOrderQuery:case r.ImportScriptsFailed:e=this.info_;break;case r.InvalidMiddleware:e="No function "+this.info_+" is found.";break;default:this.type||(this.type=r.Unknown),e=this.message}return e},e}(),w=function(){function e(){this.logger=new b(null)}return e.prototype.emptyTx=function(){this.tx&&(this.tx.oncomplete=null,this.tx.onabort=null,this.tx.onerror=null,this.tx=null)},e.prototype.createTransactionIfNotExist=function(e,t){this.tx||this.createTransaction(e,t)},e.prototype.createTransaction=function(e,t){var n=this;return void 0===t&&(t=c.ReadWrite),this.tx=this.con.transaction(e,t),d((function(e,t){n.tx.oncomplete=e,n.tx.onabort=e,n.tx.onerror=t}))},e.prototype.keyRange=function(e,t){var n;switch(t){case u.Between:n=IDBKeyRange.bound(e.low,e.high,!1,!1);break;case u.GreaterThan:n=IDBKeyRange.lowerBound(e,!0);break;case u.GreaterThanEqualTo:n=IDBKeyRange.lowerBound(e);break;case u.LessThan:n=IDBKeyRange.upperBound(e,!0);break;case u.LessThanEqualTo:n=IDBKeyRange.upperBound(e);break;default:n=IDBKeyRange.only(e)}return n},e.prototype.objectStore=function(e){return this.tx.objectStore(e)},e.prototype.abortTransaction=function(){this.tx&&this.tx.abort()},e.prototype.close=function(){var e=this;return this.con&&this.con.close(),d((function(t){e.con=null,setTimeout(t,100)}))},e.prototype.initDb=function(e){var t,n=this,r=!1,o=e.version;return d((function(i,s){var a=indexedDB.open(e.name,o);a.onsuccess=function(){n.con=a.result,n.con.onversionchange=function(e){e.target.close()},i({isCreated:r,oldVersion:t,newVersion:o})},a.onerror=function(e){console.error("error",e),s(e)},a.onupgradeneeded=function(n){t=n.oldVersion;var i=n.target,s=i.result;r=!0;var a=i.transaction,u=s.objectStoreNames,c=function(e,t){var n=t.name;if(t.enableSearch&&!e.indexNames.contains(n)){var r=t.primaryKey?{unique:!0}:{unique:t.unique};r.multiEntry=t.multiEntry;var o=null==t.keyPath?n:t.keyPath;e.createIndex(n,o,r)}},l=function(e,t,n){var r=t.columns.findIndex((function(e){return e.name===n}));r>=0&&(t.columns.splice(r,1),e.deleteIndex(n))};e.tables.forEach((function(e){if(!u.contains(e.name))return function(e){var t=e.primaryKey?{keyPath:e.primaryKey}:{autoIncrement:!0},n=s.createObjectStore(e.name,t);e.columns.forEach((function(e){c(n,e)}))}(e);for(var n=a.objectStore(e.name),r=t+1;r<=o;r++){var i=e.alter[r];if(i){if(i.add)e.setColumn(i.add).forEach((function(t){c(n,t),e.columns.push(t)}));v(i.drop||{},(function(t){l(n,e,t)})),v(i.modify||{},(function(t,r){var o=r.multiEntry||r.keyPath||r.unique,i=e.columns.find((function(e){return e.name===t})),s=Object.assign(i,r);s.name=t,o&&(l(n,e,t),c(n,s),e.columns.push(s))}))}}}));for(var f=function(t,n){var r=u.item(t);e.tables.findIndex((function(e){return e.name===r}))<0&&s.deleteObjectStore(r)},h=0,d=u.length;h<d;h++)f(h)}}))},e}(),_=function(e){return Promise.all(e)},x=function(e){return Promise.reject(e)},k=function(e){if(e instanceof b)return e.logError(),e.get();var t=void 0;return e.name?(t=new b(e.name)).message=e.message:(t=new b(e.target.error.name)).message=e.target.error.message,t.logError(),t.get()},$=function(){function e(){this.rowAffected=0,this.isTxQuery=!1,this.results=[]}return Object.defineProperty(e.prototype,"db",{get:function(){return this.util.db},enumerable:!1,configurable:!0}),e.prototype.table=function(e){var t=e||this.tableName;return this.db.tables.find((function(e){return e.name===t}))},e.prototype.primaryKey=function(e){return this.table(e).primaryKey},e.prototype.getColumnInfo=function(e,t){return this.table(t).columns.find((function(t){return t.name===e}))},e.prototype.onException=function(e,t){return console.error(e),this.util.abortTransaction(),x(function(e,t){return void 0===t&&(t=r.InvalidQuery),e.name=t,k(e)}(e,t))},e}(),C=function(e){if(null==e)return i.Null;var t=typeof e;if("object"===t){if(Array.isArray(e))return i.Array;if(e instanceof Date)return i.DateTime}return t},S=function(e){return null==e||"number"==typeof e&&isNaN(e)},E=function(){function e(e,t){this.table=e,this.autoIncrementValue=t}return e.prototype.checkAndModifyValues=function(e){var t,n=this;this.query=e;var r=e.values,o=[];return r.every((function(r,i){return t=n.checkAndModifyValue(r),e.ignore&&t&&(o.push(i),t=null),!t})),o.forEach((function(e){r.splice(e,1)})),{err:t,values:r}},e.prototype.checkAndModifyValue=function(e){var t,n=this;return this.table.columns.every((function(r){return!(t=n.checkAndModifyColumnValue_(r,e))})),t},e.prototype.checkNotNullAndDataType_=function(e,t){return e.notNull&&S(t[e.name])?this.getError(r.NullValue,{ColumnName:e.name}):e.dataType&&!S(t[e.name])&&C(t[e.name])!==e.dataType?this.getError(r.WrongDataType,{column:e.name}):void 0},e.prototype.checkAndModifyColumnValue_=function(e,t){var n=t[e.name];if(e.autoIncrement?S(n)?t[e.name]=++this.autoIncrementValue[e.name]:C(n)===i.Number&&n>this.autoIncrementValue[e.name]&&(this.autoIncrementValue[e.name]=n):void 0!==e.default&&S(n)&&(t[e.name]=e.default),this.query.validation)return this.checkNotNullAndDataType_(e,t)},e.prototype.getError=function(e,t){return new b(e,t)},e}(),T=function(){function e(e){this.table=e}return e.prototype.check=function(e,t){var n,o=this;return typeof e===i.Object?this.table?this.table.columns.every((function(t){return t.name in e&&(n=o.checkByColumn_(t,e[t.name])),!n})):n=new b(r.TableNotExist,{tableName:t}):n=new b(r.NotObject),n},e.prototype.checkByColumn_=function(e,t){if(!0===e.notNull&&S(t))return new b(r.NullValue,{ColumnName:e.name});var n=C(t),o=null!=t;if(e.dataType&&o&&n!==e.dataType&&"object"!==n)return new b(r.WrongDataType,{column:e.name});if(o&&"object"===n){var i=["+","-","*","/","{push}"];for(var s in t)if(i.indexOf(s)<0&&e.dataType&&n!==e.dataType)return new b(r.WrongDataType,{column:e.name})}},e}(),O=function(){function e(e){this.db=e}return e.prototype.validate=function(e,t){switch(e){case s.Select:case s.Remove:case s.Count:return this.checkSelect(t);case s.Insert:return this.checkInsertQuery(t);case s.Update:return this.checkUpdate(t)}},e.prototype.getTable_=function(e){return this.db.tables.find((function(t){return t.name===e}))},e.prototype.isInsertQryValid=function(e){var t,n=this.getTable_(e.into);if(n)switch(C(e.values)){case i.Array:break;case i.Null:t=new b(r.NoValueSupplied);break;default:t=new b(r.NotArray)}else t=new b(r.TableNotExist,{tableName:e.into});return{table:n,log:t}},e.prototype.checkUpdate=function(e){var t=new T(this.getTable_(e.in)).check(e.set,e.in);if(t)return t;if(null!=e.where){if(t=this.checkForNullInWhere_(e))return t;this.addGreatAndLessToNotOp_(e)}},e.prototype.checkSelect=function(e){if(!this.getTable_(e.from))return new b(r.TableNotExist,{tableName:e.from});if(e.where){var t=this.checkForNullInWhere_(e);if(t)return t;this.addGreatAndLessToNotOp_(e)}},e.prototype.checkForNullInWhere_=function(e){for(var t in e.where)if(null==e.where[t])return new b(r.NullValueInWhere,{column:t})},e.prototype.addGreatAndLessToNotOp_=function(e){var t=e.where,n=function(e,t){return t.findIndex((function(t){return null!=e[t][u.NotEqualTo]}))>=0},r=function(e,t){var n;return t.forEach((function(t){null!=(n=e[t])[u.NotEqualTo]&&(e[t][u.GreaterThan]=n[u.NotEqualTo],void 0===e[u.Or]?(e[u.Or]={},e[u.Or][t]={}):void 0===e[u.Or][t]&&(e[u.Or][t]={}),e[u.Or][t][u.LessThan]=n[u.NotEqualTo],delete e[t][u.NotEqualTo])})),e};if(C(t)===i.Object){var o=Object.keys(t);if(n(t,o))if(1===o.length)e.where=r(t,o);else{var s=[];o.forEach((function(e){var n;s.push(r(((n={})[e]=t[e],n),[e]))})),e.where=s}}else{var a=[];t.forEach((function(e){var t=Object.keys(e);n(e,t)&&(e=r(e,t)),a.push(e)})),e.where=a}},e.prototype.checkInsertQuery=function(e){var t=this.isInsertQryValid(e),n=t.table,r=t.log;if(r)return r;if(!e.skipDataCheck){var o=new E(n,n.autoIncColumnValue).checkAndModifyValues(e),i=o.values,s=o.err;return e.values=i,s}},e}(),q=(p=function(e,t){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},p(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),j=function(e){function t(t,n){var r=e.call(this)||this;return r.valuesAffected_=[],null==t.validation&&(t.validation=!0),r.query=t,r.util=n,r.tableName=t.into,r}return q(t,e),t.prototype.execute=function(e){var t=this,n=this.db,r=new O(n).validate(s.Insert,this.query);return r?x(r):e().then((function(e){return t.insertData_(n).then((function(e){return t.query.return?t.valuesAffected_:t.rowAffected}))})).catch((function(e){return t.util.abortTransaction(),x(e)}))},t.prototype.insertData_=function(e){var t,n,r,o=this,i=this.query;return t=i.return?function(e){o.valuesAffected_.push(e)}:function(e){++o.rowAffected},r=i.upsert?"put":"add",n=i.ignore&&!o.isTxQuery?function(e){return o.util.con.transaction(i.into,c.ReadWrite).objectStore(i.into)[r](e)}:(o.isTxQuery||o.util.createTransaction([i.into,y.tableName]),o.objectStore=o.util.objectStore(o.tableName),function(e){return o.objectStore[r](e)}),_(i.values.map((function(e){return d((function(r,o){var s=n(e);s.onerror=function(e){i.ignore?r():o(e)},s.onsuccess=function(){t(e),r()}}))}))).then((function(){y.set(y.dbSchema,e,o.util)}))},t}($),A=void 0===self.alert&&"undefined"==typeof ServiceWorkerGlobalScope,I=function(){try{if(indexedDB||(indexedDB=self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB),!indexedDB)return!1;IDBTransaction=IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange}catch(e){return!1}return!0}(),N=function(e){return Object.keys(e)},D=function(e){return Array.isArray(e)},R=function(e){return N(e).length},M=function(e){for(var t in e)return t},W=function(){function e(){}return e.prototype.setCaseAndValue=function(e,t){this.caseQuery_=e,this.setValue(t)},e.prototype.setCaseAndColumn=function(e,t){return this.caseQuery_=e,this.setColumn(t),this},e.prototype.setColumn=function(e){return this.columnName_=e,this.caseColumnQuery_=this.caseQuery_[this.columnName_],this.length_=this.caseColumnQuery_.length,this},e.prototype.setValue=function(e){return this.value=e,this},e.prototype.evaluate=function(){for(var e=0;e<this.length_;e++)if(!0===this.checkCase_(this.caseColumnQuery_[e]))return this.caseColumnQuery_[e].then;var t=this.caseColumnQuery_[this.length_-1].then;return null==t?this.value[this.columnName_]:t},e.prototype.checkCase_=function(e){var t;for(t in e){switch(t){case u.GreaterThan:if(this.value[this.columnName_]>e[t])return!0;break;case u.Equal:if(this.value[this.columnName_]===e[t])return!0;break;case u.LessThan:if(this.value[this.columnName_]<e[t])return!0;break;case u.GreaterThanEqualTo:if(this.value[this.columnName_]>=e[t])return!0;break;case u.LessThanEqualTo:if(this.value[this.columnName_]<=e[t])return!0;break;case u.NotEqualTo:if(this.value[this.columnName_]!==e[t])return!0;break;case u.Between:if(this.value[this.columnName_]>e[t].low&&this.value[this.columnName_]<e[t].high)return!0}return!1}},e}(),Q=function(e){var t,n=this,r=!1;return function(o){(t=o.target.result)?r&&n.results.length!==n.limitRecord?(n.pushResult(t.value),t.continue()):(r=!0,t.advance(n.skipRecord)):e()}},L=function(e){var t,n=this,r=!1;return function(o){(t=o.target.result)?r?(n.pushResult(t.value),t.continue()):(r=!0,t.advance(n.skipRecord)):e()}},P=function(e){var t,n=this;return function(r){(t=r.target.result)?(n.pushResult(t.value),t.continue()):e()}},B=function(e){var t,n=this;return function(r){(t=r.target.result)&&n.results.length!==n.limitRecord?(n.pushResult(t.value),t.continue()):e()}},F=function(e){return e.replace(/\s/g,"")},U=function(e){var t;if(null==this.query.join)t=this.getColumnInfo(e);else{var n=F(e).split(".");e=n[1],t=this.getColumnInfo(e,n[0])}if(null==t){var o=this.results[0][e];if(o)return{dataType:C(o),name:e};throw new b(r.ColumnNotExist,{column:e,isOrder:!0})}return t},V=function(e,t){return t.localeCompare(e)},G=function(e,t){return e.localeCompare(t)},J=function(e,t){return new String(t).localeCompare(e)},K=function(e,t){return new String(e).localeCompare(t)},H=function(e,t){return t-e},z=function(e,t){return e-t},Y=function(e,t){return t.getTime()-e.getTime()},X=function(e,t){return e.getTime()-t.getTime()},Z=function(e,t,n){for(var r in n){this.thenEvaluator.setCaseAndValue(n,e);var o=this.thenEvaluator.setColumn(r).evaluate();this.thenEvaluator.setCaseAndValue(n,t);var s=this.thenEvaluator.setColumn(r).evaluate();return typeof e[o]===i.String?V(e[o],t[s]):H(e[o],t[s])}},ee=function(e,t,n){for(var r in n){this.thenEvaluator.setCaseAndValue(n,e);var o=this.thenEvaluator.setColumn(r).evaluate();this.thenEvaluator.setCaseAndValue(n,t);var s=this.thenEvaluator.setColumn(r).evaluate();return typeof e[o]===i.String?G(e[o],t[s]):z(e[o],t[s])}},te=function(e,t){switch(e.dataType){case i.String:return"asc"===t.type?G:V;case i.Number:return"asc"===t.type?z:H;case i.DateTime:return"asc"===t.type?X:Y;default:return"asc"===t.type?K:J}},ne=function(e){var t,n=this;e.type=re(e.type);var r=e.by;if(null!=r&&typeof r===i.Object)"asc"===e.type?this.results.sort((function(e,t){return ee.call(n,e,t,r)})):this.results.sort((function(e,t){return Z.call(n,e,t,r)}));else{var o=U.call(this,r);if(null!=o){var s=te(o,e);r=o.name,null==e.case?this.results.sort((function(e,t){return s(e[r],t[r])})):(this.thenEvaluator.setCaseAndColumn(((t={})[r]=e.case,t),r),this.results.sort((function(e,t){return s(n.thenEvaluator.setValue(e).evaluate(),n.thenEvaluator.setValue(t).evaluate())})))}}},re=function(e){return null==e?"asc":e.toLowerCase()},oe=function(e){var t=this,n=!1;return function(r){var o=r.target.result;if(o)if(n&&t.results.length!==t.limitRecord){var i=o.value;t.shouldAddValue(i)&&t.pushResult(i),o.continue()}else n=!0,o.advance(t.skipRecord);else e()}},ie=function(e){var t=this,n=!1;return function(r){var o=r.target.result;if(o)if(n){var i=o.value;t.shouldAddValue(i)&&t.pushResult(i),o.continue()}else n=!0,o.advance(t.skipRecord);else e()}},se=function(e){var t=this;return function(n){var r=n.target.result;if(r&&t.results.length!==t.limitRecord){var o=r.value;t.shouldAddValue(o)&&t.pushResult(o),r.continue()}else e()}},ae=function(e){var t=this;return function(n){var r=n.target.result;if(r){var o=r.value;t.shouldAddValue(o)&&t.pushResult(o),r.continue()}else e()}},ue=function(e){var t,n,r=e.split("%");switch(r[1]?(t=r[1],n=r.length>2?l.Any:l.Last):(t=r[0],n=l.First),n){case l.First:return new RegExp("^"+t,"i");case l.Last:return new RegExp(t+"$","i");default:return new RegExp(""+t,"i")}},ce=function(e){return"object"===C(e)&&!(e instanceof RegExp)},le=function(e){if(ce(e)){var t={};for(var n in e)t[n]=null!=e[n]&&ce(e[n])?le(e[n]):e[n];return t}return e},fe=function(e,t,n){var r=C(e);if(r!==C(t))return!1;switch(r===i.DateTime&&(e=e.getTime(),t=t.getTime()),n){case u.GreaterThan:return e>t;case u.LessThan:return e<t;case u.LessThanEqualTo:return e<=t;case u.GreaterThanEqualTo:return e>=t;case u.NotEqualTo:return e!==t;default:return e===t}},he=function(){function e(e,t){this.where=le(e),this.checkFlag=t}return e.prototype.remove=function(e){var t=e.pop();delete e.reduce((function(e,t){return e&&e[t]}),this.where)[t]},e.prototype.check=function(e){var t=!0;if(!this.checkFlag)return t;for(var n in this.where){if(!t)return t;var r=this.where[n],o=e[n];if("object"===C(r))for(var i in r){if(!t)return t;switch(i){case u.In:t=this.checkIn(n,o);break;case u.Like:t=this.checkLike_(n,o);break;case u.Regex:t=this.checkRegex(n,o);break;case u.Between:case u.GreaterThan:case u.LessThan:case u.GreaterThanEqualTo:case u.LessThanEqualTo:case u.NotEqualTo:t=this.checkComparisionOp_(n,o,i);break;default:t=!1}}else t=fe(r,o)}return t},e.prototype.checkIn=function(e,t){return null!=this.where[e][u.In].find((function(e){return fe(e,t)}))},e.prototype.checkLike_=function(e,t){return ue(this.where[e][u.Like]).test(t)},e.prototype.checkRegex=function(e,t){return this.where[e][u.Regex].test(t)},e.prototype.checkComparisionOp_=function(e,t,n){var r=this.where[e][n];return n!=u.Between?fe(t,r,n):fe(t,r.low,">=")&&fe(t,r.high,"<=")},e}(),de=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.shouldEvaluateLimitAtEnd=!1,t.shouldEvaluateSkipAtEnd=!1,t}return de(t,e),t.prototype.goToWhereLogic=function(){var e=this.query,t=M(e.where);if(!this.objectStore.indexNames.contains(t)){var n=this.getColumnInfo(t),o=new b(null==n?r.ColumnNotExist:r.EnableSearchOff,{column:t});return x(o)}var i=e.where[t];if("object"!==C(i)){s=R(e.where)>1;return this.whereCheckerInstance=new he(e.where,s),this.whereCheckerInstance.remove([t]),this.executeWhereLogic(t,i,null,"next")}var s=R(i)>1||R(e.where)>1;this.whereCheckerInstance=new he(e.where,s);var a=M(i);switch(this.whereCheckerInstance.remove([t,a]),a){case u.Like:var c=ue(i[u.Like]);return this.executeRegexLogic(t,c);case u.Regex:return this.executeRegexLogic(t,i[u.Regex]);case u.In:return this.executeInLogic(t,i[u.In]);case u.Between:case u.GreaterThan:case u.LessThan:case u.GreaterThanEqualTo:case u.LessThanEqualTo:return this.executeWhereLogic(t,i,a,"next");case u.Aggregate:break;default:return this.executeWhereLogic(t,i,null,"next")}},t}($),me=function(e,t){var n=this;return function(r){var o=r.target.result;if(n.results.length!==n.limitRecord&&o){var i=o.value;n.shouldAddValue(i)&&t(i),o.continue()}else e()}},ye=function(e,t){var n=this;return function(r){var o=r.target.result;if(o){var i=o.value;n.shouldAddValue(i)&&t(i),o.continue()}else e()}},ge=function(e){var t=this;return function(n){var r=n.target.result;if(r&&t.results.length!==t.limitRecord){var o=r.value;t.shouldAddValue(o)&&t.pushResult(r.value),r.continue()}else e()}},ve=function(e){var t=this;return function(n){var r=n.target.result;if(r){var o=r.value;t.shouldAddValue(o)&&t.pushResult(o),r.continue()}else e()}},be=function(e,t){var n=this;return function(r){var o=r.target.result;n.results.length!==n.limitRecord&&o?(n.shouldAddValue(o)&&t(o.value),o.continue()):e()}},we=function(e,t){var n=this;return function(r){var o=r.target.result;o?(n.shouldAddValue(o)&&t(o.value),o.continue()):e()}},_e=function(e){var t=this;return function(n){var r=n.target.result;t.results.length!==t.limitRecord&&r?(t.shouldAddValue(r)&&t.pushResult(r.value),r.continue()):e()}},xe=function(e){var t=this;return function(n){var r=n.target.result;r?(t.shouldAddValue(r)&&t.pushResult(r.value),r.continue()):e()}},ke=function(){return ke=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ke.apply(this,arguments)},$e=function(){function e(e){this.joinQueryStack_=[],this.currentQueryStackIndex_=0,this.tablesFetched=[],this.results=[],this.select=e}return Object.defineProperty(e.prototype,"query",{get:function(){return this.select.query},enumerable:!1,configurable:!0}),e.prototype.getTable=function(e){return this.select.table(e)},e.prototype.executeSelect=function(e){return new Te(e,this.select.util).execute()},e.prototype.execute=function(){var e=this,t=this.query;this.joinQueryStack_=C(t.join)===i.Object?[t.join]:t.join;for(var n=t.from,r=[n],o=0,s=this.joinQueryStack_.length;o<s;o++){var a=this.joinQueryStack_[o],u=this.getJoinTableInfo_(a.on);a.with===u.table1.table&&(u={table1:u.table2,table2:u.table1});var c=this.checkJoinQuery_(u,a);if(c)return x(c);this.joinQueryStack_[o].joinTableInfo=u,r.push(a.with)}return this.select.isTxQuery||this.select.util.createTransaction(r),this.executeSelect({from:n,where:t.where,case:t.case,flatten:t.flatten}).then((function(t){return e.results=t.map((function(t){var n;return(n={})[e.currentQueryStackIndex_]=t,n})),e.tablesFetched.push(n),e.startExecutingJoinLogic_()}))},e.prototype.onJoinQueryFinished_=function(){var e=this;if(this.results.length>0)try{var t=[],n=Object.keys(this.results[0]).length,o=function(e,t){if(null!=e.as)for(var n in e.as)void 0===t[e.as[n]]&&(t[e.as[n]]=t[n],delete t[n]);return t};this.results.forEach((function(r){for(var i=r[0],s=1;s<n;s++){var a=e.joinQueryStack_[s-1];i=ke(ke({},i),o(a,r[s]))}t.push(i)})),this.select.results=t,this.select.setLimitAndSkipEvaluationAtEnd_(),this.select.query.flatten=null;try{this.select.processOrderBy()}catch(e){return x(new b(r.InvalidOrderQuery,e.message))}try{this.select.processGroupDistinctAggr()}catch(e){return x(new b(r.InvalidGroupQuery,e.message))}}catch(e){return x(new b(r.InvalidJoinQuery,e.message))}},e.prototype.startExecutingJoinLogic_=function(){var e=this,t=this.joinQueryStack_[this.currentQueryStackIndex_];if(!t)return this.onJoinQueryFinished_();try{var n=t.joinTableInfo;return this.executeSelect({from:t.with,where:t.where,case:t.case,flatten:t.flatten}).then((function(r){return e.jointables(t.type,n,r),e.tablesFetched.push(n.table2.table),++e.currentQueryStackIndex_,e.startExecutingJoinLogic_()}))}catch(e){return x(new b(r.InvalidJoinQuery,e.message))}},e.prototype.jointables=function(e,t,n){var r,o,i,s,a=this,u=[],c=t.table1.column,l=t.table2.column,f=this.tablesFetched.indexOf(t.table1.table),h=this.currentQueryStackIndex_+1;if("left"===e)i=0,s={},a.getTable(t.table2.table).columns.forEach((function(e){s[e.name]=null})),a.results.forEach((function(e){r=[],o=1===h?function(t){e[f][c]===t[l]&&r.push(t)}:function(t){var n=e[f];null!=n&&n[c]===t[l]&&r.push(t)},n.forEach(o),0===r.length&&(r=[s]),r.forEach((function(t){u[i]=ke({},e),u[i++][h]=t}))}));else!function(){var e=0;a.results.forEach((function(t){n.forEach((function(n){t[f][c]===n[l]&&(u[e]=ke({},t),u[e++][h]=n)}))}))}();this.results=u},e.prototype.getJoinTableInfo_=function(e){var t=(e=F(e)).split("="),n=t[0].split("."),r=t[1].split(".");return{table1:{table:n[0],column:n[1]},table2:{table:r[0],column:r[1]}}},e.prototype.checkJoinQuery_=function(e,t){var n,o=e.table1,i=e.table2,s=this.getTable(o.table),a=this.getTable(i.table);return t.with!==i.table&&(n=new b(r.InvalidJoinQuery,"on value should contains value of with")),null==s.columns.find((function(e){return e.name===o.column}))?n=new b(r.InvalidJoinQuery,"column "+o.column+" does not exist in table "+o.table):null==a.columns.find((function(e){return e.name===i.column}))&&(n=new b(r.InvalidJoinQuery,"column "+i.column+" does not exist in table "+i.table)),null==t.as&&(t.as={}),s.columns.every((function(e){var s=a.columns.find((function(t){return t.name===e.name&&t.name!==o.column}));return null==s||null!=t.as[s.name]||(n=new b(r.InvalidJoinQuery,"column "+e.name+" exist in both table "+o.table+" & "+i.table),!1)})),n},e}(),Ce=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Se=function(){return Se=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Se.apply(this,arguments)},Ee=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},Te=function(e){function t(t,n){var r=e.call(this)||this;return r.sorted=!1,r.isSubQuery=!1,r.thenEvaluator=new W,r.returnResult_=function(){if(r.results.length>0){if(r.query.flatten){var e=[],t={};r.query.flatten.forEach((function(n){r.results.forEach((function(r,o){r[n].forEach((function(t){var o;e.push(Se(Se({},r),((o={})[n]=t,o)))})),t[o]=!0}))}));var n=0;N(t).forEach((function(e){r.results.splice(Number(e)-n,1),++n})),r.results=r.results.concat(e)}r.processGroupDistinctAggr(),r.processOrderBy(),r.shouldEvaluateSkipAtEnd&&r.results.splice(0,r.query.skip),r.shouldEvaluateLimitAtEnd&&(r.results=r.results.slice(0,r.query.limit))}return r.results},r.query=t,r.util=n,r.tableName=t.from,r.setPushResult(),D(r.query.where)?(r.isArrayQry=!0,r.setLimitAndSkipEvaluationAtEnd_()):(r.skipRecord=t.skip,r.limitRecord=t.limit),t.order?((D(t.order)||t.order.case||"object"==typeof t.order.by)&&(t.order.idbSorting=!1),r.setLimitAndSkipEvaluationAtEnd_()):t.groupBy&&r.setLimitAndSkipEvaluationAtEnd_(),r}return Ce(t,e),t.prototype.execute=function(e){var t=this;e||(e=function(){return h(null)});try{var n=new O(this.db).validate(s.Select,this.query);return n?x(n):e().then((function(e){return t.initTransaction_(),(null==t.query.join?null!=t.query.where?D(t.query.where)?t.processWhereArrayQry():t.processWhere_():t.executeWhereUndefinedLogic():t.executeJoinQuery()).then(t.returnResult_.bind(t))}))}catch(e){return this.onException(e)}},t.prototype.processWhereArrayQry=function(){var e=this;this.isArrayQry=!0;var t,n=this.query.where,r=this.primaryKey(),o=!0,i=[],s=function(){if(t===u.And){!0===o?i=e.results:i.length>0&&(s=[],e.results.forEach((function(e){var t;t=e[r],i.findIndex((function(e){return e[r]===t}))>=0&&s.push(e)})),i=s,s=null)}else i.length>0?(e.results=Ee(Ee([],i),e.results),e.removeDuplicates(),i=e.results):i=e.results;var s;if(o=!1,n.length>0)return e.results=[],a();e.results=i},a=function(){return e.query.where=n.shift(),e.query.where[u.Or]&&1===R(e.query.where)?(t=u.Or,e.query.where=e.query.where[u.Or]):t=u.And,e.processWhere_().then(s)};return a()},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransactionIfNotExist([this.tableName],c.ReadOnly),this.objectStore=this.util.objectStore(this.tableName)},t.prototype.processWhere_=function(){var e=this;return this.shouldAddValue=function(t){return e.whereCheckerInstance.check(t)},this.query.where.or&&this.processOrLogic_(),this.goToWhereLogic().then((function(){return e.onWhereEvaluated()}))},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQueryFinish_=function(){this.isOr=!1,this.results=this.orInfo.results,this.orInfo=null,this.removeDuplicates()},t.prototype.orQuerySuccess_=function(){if(this.orInfo.results=Ee(Ee([],this.orInfo.results),this.results),!this.query.limit||this.query.limit>this.orInfo.results.length){this.results=[];var e=M(this.orInfo.orQuery);if(null!=e){var t={};return t[e]=this.orInfo.orQuery[e],delete this.orInfo.orQuery[e],this.query.where=t,this.goToWhereLogic().then(this.onWhereEvaluated.bind(this))}}return this.orQueryFinish_()},t.prototype.processOrLogic_=function(){this.isOr=!0;var e=this.query.where;this.orInfo={orQuery:e.or,results:[]},delete e.or},t}(pe);Te.prototype.executeInLogic=function(e,t){var n=this,r=this.skipRecord,o=function(e){0===r?n.pushResult(e):--r},i=function(){if(!1===n.shouldEvaluateLimitAtEnd&&!1===n.shouldEvaluateSkipAtEnd){if(n.skipRecord&&n.limitRecord)return me;if(n.skipRecord)return ye;if(n.limitRecord)return ge}return ve}(),s=this.objectStore.index(e);return _(t.map((function(e){return t=e,d((function(e,r){var a=s.openCursor(n.util.keyRange(t));a.onsuccess=i.call(n,e,o),a.onerror=r}));var t})))},Te.prototype.executeWhereUndefinedLogic=function(){var e,t=this,n=this.query.order;if(n&&!1!==n.idbSorting&&n.by){if(!this.objectStore.indexNames.contains(n.by))return x(new b(r.ColumnNotExist,{column:n.by,isOrder:!0}));var o=n.type&&"desc"===n.type.toLowerCase()?"prev":"next";this.sorted=!0,e=this.objectStore.index(n.by).openCursor(null,o)}else e=this.objectStore.openCursor();var i=function(){if(!1===t.shouldEvaluateLimitAtEnd&&!1===t.shouldEvaluateSkipAtEnd){if(t.skipRecord&&t.limitRecord)return Q;if(t.skipRecord)return L;if(t.limitRecord)return B}return P}();return d((function(n,r){e.onerror=r,e.onsuccess=i.call(t,n)}))},Te.prototype.executeWhereLogic=function(e,t,n,r){var o=this;t=n?t[n]:t;var i=this.objectStore.index(e).openCursor(this.util.keyRange(t,n),r),s=function(){if(!1===o.shouldEvaluateLimitAtEnd&&!1===o.shouldEvaluateSkipAtEnd){if(o.skipRecord&&o.limitRecord)return oe;if(o.skipRecord)return ie;if(o.limitRecord)return se}return ae}();return d((function(e,t){i.onerror=t,i.onsuccess=s.call(o,e)}))},Te.prototype.executeRegexLogic=function(e,t){var n=this,r=this.skipRecord,o=function(e){0===r?n.pushResult(e):--r};this.shouldAddValue=function(e){return t.test(e.key)&&n.whereCheckerInstance.check(e.value)};var i=this.objectStore.index(e).openCursor(),s=function(){if(!1===n.shouldEvaluateLimitAtEnd&&!1===n.shouldEvaluateSkipAtEnd){if(n.skipRecord&&n.limitRecord)return be;if(n.skipRecord)return we;if(n.limitRecord)return _e}return xe}();return d((function(e,t){i.onerror=t,i.onsuccess=s.call(n,e,o)}))},Te.prototype.setLimitAndSkipEvaluationAtEnd_=function(){this.query.limit&&(this.shouldEvaluateLimitAtEnd=!0),this.query.skip&&(this.shouldEvaluateSkipAtEnd=!0)},Te.prototype.setPushResult=function(){var e=this;this.query.case?this.pushResult=function(t){var n;for(n in e.thenEvaluator.setCaseAndValue(e.query.case,t),e.query.case)t[n]=e.thenEvaluator.setColumn(n).evaluate();e.results.push(t)}:this.pushResult=function(t){e.results.push(t)}},Te.prototype.removeDuplicates=function(){var e=this.results;this.results=null;for(var t=this.primaryKey(),n={},r=0,o=e.length;r<o;r++)n[e[r][t]]=e[r];for(var r in e=[],n)e.push(n[r]);this.results=e},Te.prototype.executeJoinQuery=function(){return new $e(this).execute()},Te.prototype.processGroupDistinctAggr=function(){if(this.query.distinct){var e=[],t=this.results[0];for(var n in t)e.push(n);var r=this.primaryKey(),o=e.indexOf(r);e.splice(o,1),this.query.groupBy=e.length>0?e:null}this.query.groupBy?this.query.aggregate?this.executeAggregateGroupBy():this.processGroupBy():this.query.aggregate&&this.processAggregateQry()},Te.prototype.processOrderBy=function(){var e=this.query.order;if(e&&this.results.length>0&&!this.sorted){var t=C(e);if(t===i.Object)ne.call(this,e);else if(t===i.Array){ne.call(this,e[0]);for(var n=function(t,n){var o=e[t-1].by,i=e[t],s=i.by,a=U.call(r,s);if(null!=a){s=a.name,i.type=re(i.type);var u=te(a,i);r.results.sort((function(e,t){return e[o]===t[o]?u(e[s],t[s]):0}))}},r=this,o=1,s=e.length;o<s;o++)n(o)}}},Te.prototype.processAggregateQry=function(){var e,t=this.results,n=t.length,r={};this.results=void 0;var o=function(){var n=0;for(var r in t)n+=t[r][e]?1:0;return n},s=function(){var n=0;for(var r in t)n=n>t[r][e]?n:t[r][e];return n},a=function(){var n=1/0,r=1/0;for(var o in t)n=n<(r=t[o][e]?t[o][e]:1/0)?n:r;return n},u=function(){var n=0;for(var r in t)n+=t[r][e];return n},c=function(){var r=0;for(var o in t)r+=t[o][e];return r/n};for(var l in this.query.aggregate){var f=this.query.aggregate[l],h=C(f),d=void 0;switch(l){case"count":d=o;break;case"max":d=s;break;case"min":d=a;break;case"sum":d=u;break;case"avg":d=c}switch(h){case i.String:r[l+"("+(e=f)+")"]=d();break;case i.Array:for(var p in f)r[l+"("+(e=f[p])+")"]=d()}}for(var l in r)t[0][l]=r[l];this.results=[t[0]]},Te.prototype.executeAggregateGroupBy=function(){var e=this.query.groupBy,t=this.results;this.results=void 0;var n,r,o,s,a={},c=this.query.aggregate,l=function(){var e=function(){return o=(o=a[r])?o["count("+s+")"]:0,o+=t[n][s]?1:0},l=function(){return o=(o=a[r])?o["max("+s+")"]:0,t[n][s]=t[n][s]?t[n][s]:0,o>t[n][s]?o:t[n][s]},f=function(){return o=(o=a[r])?o["min("+s+")"]:1/0,t[n][s]=t[n][s]?t[n][s]:1/0,o<t[n][s]?o:t[n][s]},h=function(){return o=(o=a[r])?o["sum("+s+")"]:0,o+=t[n][s]?t[n][s]:0},d=function(){var e=(o=a[r])?o["sum("+s+")"]:0;e+=t[n][s]?t[n][s]:0,t[n]["sum("+s+")"]=e,o=o?o["count("+s+")"]:0,o+=t[n][s]?1:0,t[n]["count("+s+")"]=o};for(var p in c){var m=c[p],y=C(m),g=void 0;switch(p){case u.Count:g=e;break;case u.Max:g=l;break;case u.Min:g=f;break;case u.Sum:g=h;break;case u.Avg:g=d}switch(y){case i.String:s=m,t[n][p+"("+s+")"]=g();break;case i.Array:for(var v in m)s=m[v],t[n][p+"("+s+")"]=g()}}};if(C(e)===i.String)for(n in t)r=t[n][e],l(),a[r]=t[n];else for(n in t){for(var f in r="",e)r+=t[n][e[f]];l(),a[r]=t[n]}for(var h in t=[],a)t.push(a[h]);if(c.avg)if(C(c.avg)===i.String)for(n in t){var d=t[n]["sum("+c.avg+")"],p=t[n]["count("+c.avg+")"];t[n]["avg("+c.avg+")"]=d/p,c.count!==c.avg&&delete t[n]["count("+c.avg+")"],c.sum!==c.avg&&delete t[n]["sum("+c.avg+")"]}else{var m=C(c.count)===i.String,y=C(c.sum)===i.String;for(n in t)for(var f in c.avg){var g=c.avg[f],v=t[n]["sum("+g+")"],b=t[n]["count("+g+")"];t[n]["avg("+g+")"]=v/b,m&&(c.count!==g||-1===c.count.indexOf(g))&&delete t[n]["count("+g+")"],y&&(c.sum!==g||-1===c.sum.indexOf(g))&&delete t[n]["sum("+g+")"]}}this.results=t},Te.prototype.processGroupBy=function(){var e=this.query.groupBy,t=this.results,n={};if(this.results=this.query.groupBy=null,C(e)!==i.Object)if(C(e)===i.String)for(var r in t)n[t[r][e]]=t[r];else{var o=void 0;for(var r in t){for(var s in o="",e)o+=t[r][e[s]];n[o]=t[r]}}else if(1===Object.keys(e).length){var a=M(e);for(var r in this.thenEvaluator.setCaseAndColumn(e,a),t)n[this.thenEvaluator.setValue(t[r]).evaluate()]=t[r]}else{o=void 0;for(var r in t){for(var s in o="",this.thenEvaluator.setCaseAndValue(e,t[r]),e)o+=this.thenEvaluator.setColumn(s).evaluate();n[o]=t[r]}}for(var r in t=[],n)t.push(n[r]);this.results=t};var Oe=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qe=function(e){function t(t,n){var r=e.call(this)||this;return r.resultCount=0,r.query=t,r.util=n,r.tableName=t.from,r}return Oe(t,e),t.prototype.execute=function(e){var t=this,n=new O(this.db),r=this.query,o=n.validate(s.Count,r);return o?x(o):e().then((function(e){var n;try{var o=function(){var e=new Te(t.query,t.util);return e.isTxQuery=t.isTxQuery,e.execute().then((function(e){t.resultCount=e.length}))};t.initTransaction_(),n=null==r.join?null!=r.where?r.where.or||D(t.query.where)?o():t.goToWhereLogic():t.executeWhereUndefinedLogic():o()}catch(e){t.onException(e)}return n.then((function(e){return t.resultCount}))}))},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.query.from],c.ReadOnly),this.objectStore=this.util.objectStore(this.query.from)},t}(pe);qe.prototype.executeWhereUndefinedLogic=function(){var e,t,n=this,r=n.objectStore.count?(e=n.objectStore.count(),function(t){return function(){n.resultCount=e.result,t()}}):(e=n.objectStore.openCursor(),function(e){return function(r){(t=r.target.result)?(++n.resultCount,t.continue()):e()}});return d((function(t,n){e.onerror=n,e.onsuccess=r(t)}))},qe.prototype.executeWhereLogic=function(e,t,n){var r,o,i=this;t=n?t[n]:t;var s=1===R(this.query.where);return d((function(a,u){s&&i.objectStore.count?(r=i.objectStore.index(e).count(i.util.keyRange(t,n))).onsuccess=function(){i.resultCount=r.result,a()}:(r=i.objectStore.index(e).openCursor(i.util.keyRange(t,n))).onsuccess=function(e){(o=e.target.result)?(i.whereCheckerInstance.check(o.value)&&++i.resultCount,o.continue()):a()},r.onerror=u}))},qe.prototype.executeRegexLogic=function(e,t){var n,r=this,o=this.objectStore.index(e).openCursor();return this.shouldAddValue=function(e){return t.test(e.key)&&r.whereCheckerInstance.check(e.value)},d((function(e,t){o.onerror=t,o.onsuccess=function(t){(n=t.target.result)?(r.shouldAddValue(n)&&++r.resultCount,n.continue()):e()}}))},qe.prototype.executeInLogic=function(e,t){var n,r=this,o=this.objectStore.index(e),i=1===R(this.query.where);return _(t.map((function(e){return t=e,s=r.util.keyRange(t),i&&r.objectStore.count?d((function(e,t){var n=o.count(s);n.onsuccess=function(t){r.resultCount+=t.target.result,e()},n.onerror=t})):d((function(e,t){var i=o.openCursor(s);i.onsuccess=function(t){(n=t.target.result)?(r.whereCheckerInstance.check(n.value)&&++r.resultCount,n.continue()):e()},i.onerror=t}));var t,s})))};var je=function(e){return(D(e)?e:e.split(".")).reduce((function(e,t){return e&&e[t]}),self)},Ae=function(e,t){var n=e.set,r=e.mapSet;if(r){var o=r(n,t);null!=o&&(n=o)}for(var s in n){var a=n[s];if(C(a)!==i.Object)t[s]=a;else for(var u in a){var c=a[u];switch(u){case"+":t[s]+=c;break;case"-":t[s]-=c;break;case"*":t[s]*=c;break;case"/":t[s]/=c;break;case"{push}":t[s].push(c);break;default:t[s]=a}break}}return t},Ie=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ne=function(e){function t(t,n){var o=e.call(this)||this;o.query=t,o.util=n,o.tableName=t.in;var s=t.mapSet;if(s){var a=C(s)===i.String?je(s):s;if(!a)throw new b(r.MethodNotExist,s);t.mapSet=a}return o}return Ie(t,e),t.prototype.execute=function(e){var t=this,n=this.query;try{var r=new O(this.db).validate(s.Update,n);return r?x(r):e().then((function(e){return t.initTransaction(),(null!=n.where?n.where.or||D(n.where)?t.executeComplexLogic_():t.goToWhereLogic():t.executeWhereUndefinedLogic()).then((function(){return t.rowAffected}))}))}catch(e){return this.onException(e)}},t.prototype.executeComplexLogic_=function(){var e=this,t=this.query,n=new Te({from:t.in,where:t.where,ignoreCase:t.ignoreCase},this.util);return n.isTxQuery=this.isTxQuery,n.execute().then((function(n){var r,o,i=e.primaryKey(t.in),s=[];n.forEach((function(e){s.push(e[i])})),n=null;var a=((r={})[i]=((o={})[u.In]=s,o),r);return e.query.where=a,e.initTransaction(),e.goToWhereLogic()}))},t.prototype.initTransaction=function(){var e=this.query.in;this.isTxQuery||this.util.createTransaction([e]),this.objectStore=this.util.objectStore(e)},t}(pe);Ne.prototype.executeWhereUndefinedLogic=function(){var e=this,t=this.objectStore.openCursor();return d((function(n,r){t.onsuccess=function(t){var o=t.target.result;if(o)try{var i=o.update(Ae(e.query,o.value));i.onsuccess=function(){++e.rowAffected,o.continue()},i.onerror=r}catch(e){r(e)}else n()},t.onerror=r}))},Ne.prototype.executeWhereLogic=function(e,t,n){var r=this,o=this.query;t=n?t[n]:t;var i=this.objectStore.index(e).openCursor(this.util.keyRange(t,n));return d((function(e,t){i.onsuccess=function(n){var i=n.target.result;if(i)if(r.whereCheckerInstance.check(i.value))try{var s=i.update(Ae(o,i.value));s.onsuccess=function(){++r.rowAffected,i.continue()},s.onerror=t}catch(e){t(e)}else i.continue();else e()},i.onerror=t}))},Ne.prototype.executeRegexLogic=function(e,t){var n,r=this,o=this.objectStore.index(e).openCursor();return this.shouldAddValue=function(e){return t.test(e.key)&&r.whereCheckerInstance.check(e.value)},d((function(e,t){o.onsuccess=function(o){if(n=o.target.result)if(r.shouldAddValue(n))try{var i=n.update(Ae(r.query,n.value));i.onsuccess=function(){++r.rowAffected,n.continue()},i.onerror=t}catch(e){t(e)}else n.continue();else e()},o.onerror=t}))},Ne.prototype.executeInLogic=function(e,t){var n=this,r=this.objectStore.index(e),o=this.query;return _(t.map((function(e){return t=e,d((function(e,i){var s=r.openCursor(n.util.keyRange(t));s.onsuccess=function(t){var r=t.target.result;if(r){var s=r.value;if(n.whereCheckerInstance.check(s))try{var a=r.update(Ae(o,s));a.onsuccess=function(){++n.rowAffected,r.continue()},a.onerror=i}catch(e){i(e)}else r.continue()}else e()},s.onerror=i}));var t})))};var De=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Re=function(){return Re=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Re.apply(this,arguments)},Me=function(e){function t(t,n){var r=e.call(this)||this;return r.query=t,r.util=n,r}return De(t,e),t.prototype.execute=function(){var e,t,n=this,r=this.query,o=0,i={},s={},a=!0,u=r.queries,c=u.length;if(u.every((function(e,t){return!(t+1<c&&e.from!==u[t+1].from)||(a=!1,!1)})),a){var l=this.primaryKey(u[0].from);e=function(e){return e[l]}}else e=function(e){var t="";for(var n in e)t+=e[n];return t};var f=function(){if(o<c)return(t=new Te(u[o],n.util)).execute().then((function(t){return i={},t.forEach((function(t){var n=e(t);0===o?s[n]=t:null!=s[n]&&(i[n]=t)})),o>0&&(s=Re({},i)),++o,f()}));var a,l=[],h=void 0,d=r.skip,p=r.limit,m=!1,y=function(){l.push(i[a])},g=function(){l.length<p?y():m=!0},v=function(e){0===d?e():--d};if(h=r.skip&&r.limit?function(){v((function(){g()}))}:r.limit?g:r.skip?function(){v((function(){y()}))}:function(){y()},p){for(a in i)if(h(a),m)break}else for(a in i)h(a);return t.results=l,Object.assign(t.query,{order:r.order,join:{}}),t.processOrderBy(),t.processGroupDistinctAggr(),t.results};return f()},t}($),We=function(){function e(){}return e.prototype.execute=function(e){return d((function(t,n){var o=indexedDB.deleteDatabase(e);o.onblocked=function(){var e=new b(r.DbBlocked);return n(k(e))},o.onerror=function(e){return n(k(e))},o.onsuccess=function(){t()}}))},e}(),Qe=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Le=function(e){function t(t,n){var r=e.call(this)||this;return r.query=t,r.util=n,r}return Qe(t,e),t.prototype.execute=function(){var e,t=this,n=this.query,r=0,o={},i=!0,s=n.length;if(n.every((function(e,t){return!(t+1<s&&e.from!==n[t+1].from)||(i=!1,!1)})),i){var a=this.primaryKey(n[0].from);e=function(e){return e[a]}}else e=function(e){var t="";for(var n in e)t+=e[n];return t};var u=function(){if(r<n.length)return new Te(n[r++],t.util).execute().then((function(t){return t.forEach((function(t){o[e(t)]=t})),u()}));var i=[];for(var s in o)i.push(o[s]);return i};return u()},t}($),Pe=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Be=function(e){function t(t,n){var r=e.call(this)||this;return r.query=t,r.util=n,r.tableName=t.from,r}return Pe(t,e),t.prototype.execute=function(e){var t,n=this,r=new O(this.db),o=this.query,i=r.validate(s.Remove,o);return i?x(i):e().then((function(e){try{n.initTransaction_(),t=null!=o.where?D(o.where)?n.processWhereArrayQry():n.processWhere_():n.executeWhereUndefinedLogic()}catch(e){return n.onException(e)}return t.then((function(){return n.rowAffected}))}))},t.prototype.processWhereArrayQry=function(){var e=this,t=new Te(this.query,this.util);return t.isTxQuery=this.isTxQuery,t.execute().then((function(t){var n,r,o=[],i=e.primaryKey(e.query.from);t.forEach((function(e){o.push(e[i])})),t=null;var s=((n={})[i]=((r={})[u.In]=o,r),n);return e.query[u.Where]=s,e.processWhere_()}))},t.prototype.processWhere_=function(){var e=this;return this.query.where.or&&this.processOrLogic(),this.goToWhereLogic().then((function(){return e.onWhereEvaluated()}))},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.query.from]),this.objectStore=this.util.objectStore(this.query.from)},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQuerySuccess_=function(){var e=this,t=M(this._orInfo.OrQuery);if(null!=t){var n={};return n[t]=this._orInfo.OrQuery[t],delete this._orInfo.OrQuery[t],this.query.where=n,this.goToWhereLogic().then((function(){return e.onWhereEvaluated()}))}this.isOr=!0},t.prototype.processOrLogic=function(){this.isOr=!0;var e=this.query.where;this._orInfo={OrQuery:e.or},delete e.or},t}(pe);Be.prototype.executeInLogic=function(e,t){var n=this,r=this.objectStore.index(e);return _(t.map((function(e){return t=e,d((function(e,o){var i=r.openCursor(n.util.keyRange(t));i.onsuccess=function(t){var r=t.target.result;r?(n.whereCheckerInstance.check(r.value)&&(r.delete(),++n.rowAffected),r.continue()):e()},i.onerror=o}));var t})))},Be.prototype.executeWhereUndefinedLogic=function(){var e,t=this,n=this.objectStore.openCursor();return d((function(r,o){n.onsuccess=function(n){(e=n.target.result)?(e.delete(),++t.rowAffected,e.continue()):r()},n.onerror=o}))},Be.prototype.executeWhereLogic=function(e,t,n){var r,o,i=this;return t=n?t[n]:t,o=this.objectStore.index(e).openCursor(this.util.keyRange(t,n)),d((function(e,t){o.onsuccess=function(t){(r=t.target.result)?(i.whereCheckerInstance.check(r.value)&&(r.delete(),++i.rowAffected),r.continue()):e()},o.onerror=t}))},Be.prototype.executeRegexLogic=function(e,t){var n,r=this,o=this.objectStore.index(e).openCursor();return this.shouldAddValue=function(e){return t.test(e.key)&&r.whereCheckerInstance.check(e.value)},d((function(e,t){o.onsuccess=function(t){(n=t.target.result)?(r.shouldAddValue(n)&&(n.delete(),++r.rowAffected),n.continue()):e()},o.onerror=t}))};var Fe=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ue=function(e){function t(t,n){var r=e.call(this)||this;return r.query=t,r.util=n,r.tableName=t,r}return Fe(t,e),t.prototype.execute=function(e){var t=this,n=this.query;return this.isTxQuery||this.util.createTransaction([n,y.tableName]),e().then((function(e){var r=t.util.objectStore(n).clear();try{return d((function(e,o){r.onsuccess=function(r){var i=t.table(n);for(var s in i.autoIncColumnValue)i.autoIncColumnValue[s]=0;y.set(y.dbSchema,t.util.db,t.util).then((function(){e()})).catch(o)},r.onerror=o}))}catch(e){return t.onException(e)}}))},t}($),Ve=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ge=function(e){function t(t,n){var r=e.call(this)||this;return r.results={},r.reqQueue=[],r.isQueryExecuting=!1,r.isTxStarted_=!1,r.query=t,r.util=n,r}return Ve(t,e),t.prototype.execute=function(e){var t=this;this.beforeExecute=e;var n=this.validate();return n?x(n):(this.startExecution_(),d((function(e,n){t.onSuccess=e,t.onError=n})).then((function(e){return t.beforeExecute=null,t.log("transaction finished"),e})))},t.prototype.validate=function(){var e=this.query,t=this.notExistingTable_(e.tables);if(t)return new b(r.TableNotExist,{tableName:t});var n=e.method;return je(n)?void 0:new b(r.MethodNotExist,n)},t.prototype.startExecution_=function(){var e=this,t=this.query,n=t.method,r=je(n);return this.log("transaction query started"),r.call(this,{data:t.data,insert:function(t){return e.pushReq_({name:s.Insert,query:t})},select:function(t){return e.pushReq_({name:s.Select,query:t})},update:function(t){return e.pushReq_({name:s.Update,query:t})},remove:function(t){return e.pushReq_({name:s.Remove,query:t})},count:function(t){return e.pushReq_({name:s.Count,query:t})},setResult:function(t,n){e.results[t]=n},getResult:function(t){return e.results[t]},abort:function(t){e.abortTx_(t)},start:function(){e.startTx_()}})},t.prototype.log=function(e){this.util.logger.log(e)},t.prototype.startTx_=function(){var e=this;try{this.isTxStarted_=!0;var t=this.query.tables;return t=t.concat(y.tableName),this.util.createTransaction(t).then((function(t){e.onSuccess(e.results)})).catch((function(t){e.onError(t)})),this.processExecutionOfQry_()}catch(e){this.onError(this.onException(e))}},t.prototype.onReqFinished_=function(e){var t=this.reqQueue.shift();this.log("finished request : "+t.name+" "),t&&(e.error?(this.abortTx_("automatic abort of transaction due to error occured"),this.log("transaction aborted due to error occured"),this.onError(e.error)):(this.isQueryExecuting=!1,t.onSuccess&&t.onSuccess(e),this.processExecutionOfQry_()))},t.prototype.abortTx_=function(e){this.reqQueue=[],this.util.abortTransaction(),this.log("transaction aborted. Msg : "+e)},t.prototype.executeRequest_=function(e){var t;this.isQueryExecuting=!0,this.log("executing request : "+e.name+" ");var n=this.onReqFinished_.bind(this),r=e.query;switch(e.name){case s.Select:t=new Te(r,this.util);break;case s.Insert:t=new j(r,this.util);break;case s.Update:t=new Ne(r,this.util);break;case s.Remove:t=new Be(r,this.util);break;case s.Count:t=new qe(r,this.util)}t.isTxQuery=!0,t.execute(this.beforeExecute).then(n).catch((function(e){n({error:e})}))},t.prototype.pushReq_=function(e){var t=this,n=function(){t.reqQueue.push(e)},r=d((function(t,n){e.onSuccess=function(e){t(e)},e.onError=function(e){n(e)}}));return!0===this.isTxStarted_?(n(),this.processExecutionOfQry_()):n(),this.log("request pushed : "+e.name),r},t.prototype.processExecutionOfQry_=function(){!1===this.isQueryExecuting&&this.reqQueue.length>0&&this.executeRequest_(this.reqQueue[0])},t.prototype.notExistingTable_=function(e){var t=this,n=null;return e.every((function(e){return null!=t.table(e)||(n=e,!1)})),n},t}($),Je=function(e){var t={name:e.name,version:e.version,tables:[]};return e.tables.forEach((function(e){var n={name:e.name,columns:{}};e.columns.forEach((function(e){n.columns[e.name]=e})),t.tables.push(n)})),t},Ke=function(){function e(e){this.middlewares=[],this.util=new w,this.onQryFinished=A?function(e){self.postMessage(e)}:e}return Object.defineProperty(e.prototype,"db",{get:function(){return this.util.db},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"logger",{get:function(){return this.util.logger},enumerable:!1,configurable:!0}),e.prototype.executeMiddleware_=function(e){var t=this,n=R(this.middlewares)-1;if(n<0)return h();var r={},o=this.db;return Object.defineProperty(r,"database",{get:function(){return Je(o)}}),d((function(o){var i=0,s=function(){if(i<=n){var a=je(t.middlewares[i++])(e,r);a&&a.then||(a=Promise.resolve(a)),a.then((function(e){s()}))}else o()};s()}))},e.prototype.executeQuery=function(e,t){var n,o=e.query;switch(e.name){case s.OpenDb:t(),n=this.openDb(o);break;case s.InitDb:t(),n=this.initDb(o);break;case s.CloseDb:t(),n=this.closeDb();break;case s.Insert:n=new j(o,this.util).execute(t);break;case s.Select:n=new Te(o,this.util).execute(t);break;case s.Count:n=new qe(o,this.util).execute(t);break;case s.Update:n=new Ne(o,this.util).execute(t);break;case s.Intersect:t(),n=new Me(o,this.util).execute();break;case s.DropDb:t(),n=this.dropDb();break;case s.Terminate:t(),n=this.terminate();break;case s.Union:t(),n=new Le(o,this.util).execute();break;case s.Remove:n=new Be(o,this.util).execute(t);break;case s.Clear:n=new Ue(o,this.util).execute(t);break;case s.Transaction:n=new Ge(o,this.util).execute(t);break;case s.Get:t(),n=y.get(o,this.util);break;case s.Set:t(),n=y.set(o.key,o.value,this.util);break;case s.ImportScripts:t(),n=this.importScripts_(e);break;case s.ChangeLogStatus:t(),this.logger.status=o,n=Promise.resolve();break;case s.Middleware:return t(),je(o)?(this.middlewares.push(o),h()):x(new b(r.InvalidMiddleware,o));default:console.error("The Api:-"+e.name+" does not support."),n=h()}return this.logger.log("Executing query "+e.name+" in web worker"),n},e.prototype.callResultMiddleware=function(e,t){return d((function(n){var r=0,o=R(e)-1,i=function(){if(r<=o){var s=e[r++](t);s instanceof Promise||(s=h(s)),s.then((function(e){t=e,i()}))}else n(t)};i()}))},e.prototype.callBeforeMiddleware=function(e){return d((function(t){var n=0,r=R(e)-1,o=function(){if(n<=r){var i=e[n++]();i instanceof Promise||(i=h(i)),i.then(o)}else t()};o()}))},e.prototype.run=function(e){var t=this,n=[],r=[];e.onResult=function(e){n.push((function(t){return e(t)}))},e.beforeExecute=function(e){r.push((function(t){return e(t)}))},this.executeMiddleware_(e).then((function(o){return t.executeQuery(e,(function(){return t.callBeforeMiddleware(r)})).then((function(e){return t.callResultMiddleware(n,e).then((function(e){t.returnResult_({result:e})}))}))})).catch((function(e){n=[];var r={error:k(e)};t.returnResult_(r)}))},e.prototype.importScripts_=function(e){return d((function(t,n){try{importScripts.apply(void 0,e.query),t()}catch(e){n(new b(r.ImportScriptsFailed,e.message))}}))},e.prototype.returnResult_=function(e){this.logger.log("Query finished inside web worker"),this.util&&this.util.emptyTx(),this.onQryFinished(e)},e.prototype.dropDb=function(){var e=this.db.name;return this.terminate().then((function(){return(new We).execute(e)}))},e.prototype.closeDb=function(){return this.util.close()},e.prototype.terminate=function(){var e=this;return this.closeDb().then((function(){e.util.db=null}))},e.prototype.openDb=function(e){var t=this;return this.closeDb().then((function(n){return(t.db&&e.name===t.db.name?t.initDb():t.initDb({name:e.name,tables:[],version:e.version})).then((function(){return t.db}))}))},e.prototype.initDb=function(e){var t=this;if(!I)return x(new b(r.IndexedDbNotSupported));var n=e?new g(e):this.db;return this.util=new w,d((function(e,r){t.util.initDb(n).then((function(r){r.isCreated?y.get(y.dbSchema,t.util).then((function(o){o&&o.tables.forEach((function(e,t){var r=n.tables[t];r&&(r.autoIncColumnValue=e.autoIncColumnValue)})),t.util.db=n,r.database=Je(t.db),y.set(y.dbSchema,n,t.util).then((function(){e(r)}))})):y.get(y.dbSchema,t.util).then((function(n){t.util.db=n,r.database=Je(t.db),e(r)}))})).catch(r)}))},e}();if(A){var He=new Ke;self.onmessage=function(e){He.run(e.data)}}}})})),Rt=Dt,Mt={setup(e,t){e.$worker=Rt,e.initQueryManager_()}},Wt=Mt;const Qt=[];function Lt(t,n=e){let r;const o=new Set;function i(e){if(a(t,e)&&(t=e,r)){const e=!Qt.length;for(const e of o)e[1](),Qt.push(e,t);if(e){for(let e=0;e<Qt.length;e+=2)Qt[e][0](Qt[e+1]);Qt.length=0}}}return{set:i,update:function(e){i(e(t))},subscribe:function(s,a=e){const u=[s,a];return o.add(u),1===o.size&&(r=n(i)||e),s(t),()=>{o.delete(u),0===o.size&&(r(),r=null)}}}}function Pt(e,t){return e.filter((function(e){return e!=t}))}const Bt=function(){const{subscribe:e,set:t,update:n}=Lt(20);return{subscribe:e,increment:()=>n((e=>e+20)),reset:()=>t(20)}}(),Ft=function(){const{subscribe:e,set:t,update:n}=Lt([]);return{subscribe:e,set:t,refresh:()=>n((e=>e))}}(),Ut=function(){const{subscribe:e,set:t}=Lt(!1);return{subscribe:e,yes:()=>t(!0),no:()=>t(!1)}}(),Vt=function(){const{subscribe:e,update:t}=Lt({criteria:{users:[],playlists:[]},active:{users:[],playlists:[]}});return{subscribe:e,update_criteria:(e,n)=>t((t=>{const r=[],o=[];return e.forEach((e=>{r.push({id:e.subm_id,name:e.subm_name})})),n.forEach((e=>{o.push({id:e.playlist_id,name:e.playlist_name})})),t.criteria.users=r,t.criteria.playlists=o,t})),add:(e,n)=>t((t=>(t.active[e].includes(n)||(t.active[e]=[...t.active[e],n]),t.criteria[e].includes(n)&&(t.criteria[e]=Pt(t.criteria[e],n)),t))),delete:(e,n)=>t((t=>(t.active[e].includes(n)&&(t.active[e]=Pt(t.active[e],n)),t.criteria[e].includes(n)||(t.criteria[e]=[...t.criteria[e],n]),t))),toggle:(e,n)=>t((t=>t=t.active[e].includes(n)?this.remove(e,n):this.add(e,n))),reset:()=>t((e=>(e.active.users=[],e.active.playlists=[],e)))}}(),Gt=Lt(0);async function Jt(){await async function(){Ht=new Nt.Connection,Ht.addPlugin(Wt)}(),await async function(){zt={name:"playlists",columns:{id:{primaryKey:!0,notNull:!0,dataType:"string"},snapshot:{notNull:!0,dataType:"string"}}},Yt={name:"songs",columns:{uid:{primaryKey:!0,notNull:!0,dataType:"string"},unix:{notNull:!0,dataType:"number"},subm_name:{notNull:!0,dataType:"string"},subm_id:{notNull:!0,dataType:"string"},subm_link:{dataType:"string"},subm_images:{dataType:"object"},song_title:{notNull:!0,dataType:"string"},song_link:{dataType:"string"},song_popularity:{dataType:"number"},song_duration:{dataType:"number"},song_islocal:{dataType:"boolean"},song_id:{dataType:"string"},album_name:{dataType:"string"},album_link:{dataType:"string"},artists:{notNull:!0,dataType:"array"},playlist_name:{notNull:!0,dataType:"string"},playlist_link:{notNull:!0,dataType:"string"},playlist_id:{notNull:!0,dataType:"string"}}},Xt={name:"sctdb",tables:[zt,Yt]},await Ht.initDb(Xt)}();const e=await async function(){const e=await Ht.select({from:"playlists"});let t={};e.forEach((e=>{t[e.id]=e.snapshot}));const n=await async function(e,t){let n="https://api.spotify.com/v1/me/playlists?limit=20",r=!0,o=t,i={update:{},remove:{}};for(;r;){const t=await fetch(n,{method:"GET",headers:Ot(e)}),s=await t.json();for(let e of s.items){const t=e.id,a=e.snapshot_id;e.collaborative&&(o.hasOwnProperty(t)?(o[t]!=a&&(i.update[t]=a),delete o[t]):i.update[t]=a),null!=s.next?n=s.next:r=!1}}return i.remove=o,i}(kt,t);return Object.keys(n.remove).forEach((e=>{Ht.remove({from:"playlists",where:{id:e}}),Ht.remove({from:"songs",where:{playlist_id:e}})})),Object.entries(n.update).forEach((e=>{const[t,n]=e,r={id:t,snapshot:n};Ht.insert({into:"playlists",values:[r],upsert:"true"}),Ht.remove({from:"songs",where:{playlist_id:t}})})),n}(),t=await async function(e){const t=await async function(e,t){const n=t,r={market:"from_token",limit:"100",fields:"name,id,external_urls,tracks.items(is_local,track(duration_ms,external_urls,name,popularity,id),added_at,added_by(id,external_urls,href),track.album(external_urls,name),track.artists(external_urls,name)),tracks(limit,next,offset)"},o={market:"from_token",limit:"100",fields:"items(is_local,track(duration_ms,external_urls,name,popularity,id),added_at,added_by(id,external_urls,href),track.album(external_urls,name),track.artists(external_urls,name)),limit,next,offset"};let i={},s=[];for(let t in n){let n,u=!0,c=new URL("https://api.spotify.com/v1/playlists/"+t),l=r;for(c.search=new URLSearchParams(l).toString();u;){const t=await fetch(c,{method:"GET",headers:Ot(e)});let r=await t.json();null!=n&&(n.tracks.items=r.items,n.tracks.next=r.next,r=n);for(let t of r.tracks.items)try{const n=(a=t.added_at,Date.parse(a)),o=t.added_by.id,u=t.added_by.external_urls.spotify,c=t.track.name,l=t.track.external_urls.spotify,f=t.track.popularity,h=t.is_local,d=t.track.id,p=t.track.duration_ms,m=t.track.album.name,y=t.track.album.external_urls.spotify,g=r.name,v=r.external_urls.spotify,b=r.id;let w=[];for(let e of t.track.artists)w.push({name:e.name,link:e.external_urls.spotify});i.hasOwnProperty(o)||(i[o]=await qt(e,o));const _=i[o][0];let x;try{x=i[o][1][0]}catch{x=null}const k={uid:`${n} ${b} ${d}`,unix:n,subm_name:_,subm_id:o,subm_link:u,subm_images:x,song_title:c,song_link:l,song_popularity:f,song_duration:p,song_islocal:h,song_id:d,album_name:m,album_link:y,artists:w,playlist_name:g,playlist_link:v,playlist_id:b};s.push(k)}catch{}null!=r.tracks.next?(c=new URL(r.tracks.next),n=r,l=o):u=!1}}var a;return{songs:s}}(kt,e.update);return await Ht.insert({into:"songs",values:t.songs,upsert:"true"}),t}(e),n=await async function(){const e=await Ht.select({from:"songs",groupBy:"subm_name"}),t=await Ht.select({from:"songs",groupBy:"playlist_name"});return{users:e,playlists:t}}();return Vt.update_criteria(n.users,n.playlists),0!=t.songs.length}async function Kt(e){const t=await async function(e){let t={from:"songs",order:{by:"unix",type:"desc"},limit:e,where:{}},n=[],r=function(e){let t;return u(e,(e=>t=e))(),t}(Vt);r.active.playlists.forEach((e=>{n.push(e.id)}));const o=new RegExp(n.join("|"));""!=o&&(t.where.playlist_id={regex:o});n=[],r.active.users.forEach((e=>{n.push(e.id)}));const i=new RegExp(n.join("|"));""!=i&&(t.where.subm_id={regex:i});t.where==={}&&delete t.where;return await Ht.select(t)}(e);return t}let Ht,zt,Yt,Xt;function Zt(e){const t=e-1;return t*t*t+1}function en(e){return-e*(e-2)}function tn(e){return--e*e*e*e*e+1}function nn(e,{delay:n=0,duration:r=400,easing:o=t}={}){const i=+getComputedStyle(e).opacity;return{delay:n,duration:r,easing:o,css:e=>"opacity: "+e*i}}function rn(e,{delay:t=0,duration:n=400,easing:r=Zt,x:o=0,y:i=0,opacity:s=0}={}){const a=getComputedStyle(e),u=+a.opacity,c="none"===a.transform?"":a.transform,l=u*(1-s);return{delay:t,duration:n,easing:r,css:(e,t)=>`\n\t\t\ttransform: ${c} translate(${(1-e)*o}px, ${(1-e)*i}px);\n\t\t\topacity: ${u-l*t}`}}function on(e,{from:t,to:n},r={}){const o=getComputedStyle(e),i="none"===o.transform?"":o.transform,[a,u]=o.transformOrigin.split(" ").map(parseFloat),c=t.left+t.width*a/n.width-(n.left+a),l=t.top+t.height*u/n.height-(n.top+u),{delay:f=0,duration:h=(e=>120*Math.sqrt(e)),easing:d=Zt}=r;return{delay:f,duration:s(h)?h(Math.sqrt(c*c+l*l)):h,easing:d,css:(e,r)=>{const o=r*c,s=r*l,a=e+r*t.width/n.width,u=e+r*t.height/n.height;return`transform: ${i} translate(${o}px, ${s}px) scale(${a}, ${u});`}}}const sn=(()=>{const{subscribe:e,update:t}=Lt([]);let n=0,r={};return{subscribe:e,push:(e,o={})=>{const i={id:++n,msg:e,...r,...o,theme:{...r.theme,...o.theme}};return t((e=>i.reversed?[...e,i]:[i,...e])),n},pop:e=>{t((t=>e?t.filter((t=>t.id!==e)):t.splice(1)))},set:(e,n)=>{t((t=>{const r=t.findIndex((t=>t.id===e));return r>-1&&(t[r]={...t[r],...n}),t}))},_opts:(e={})=>(r={...r,...e,theme:{...r.theme,...e.theme}},r)}})();function an(e){return"[object Date]"===Object.prototype.toString.call(e)}function un(e,t){if(e===t||e!=e)return()=>e;const n=typeof e;if(n!==typeof t||Array.isArray(e)!==Array.isArray(t))throw new Error("Cannot interpolate values of different type");if(Array.isArray(e)){const n=t.map(((t,n)=>un(e[n],t)));return e=>n.map((t=>t(e)))}if("object"===n){if(!e||!t)throw new Error("Object cannot be null");if(an(e)&&an(t)){e=e.getTime();const n=(t=t.getTime())-e;return t=>new Date(e+t*n)}const n=Object.keys(t),r={};return n.forEach((n=>{r[n]=un(e[n],t[n])})),e=>{const t={};return n.forEach((n=>{t[n]=r[n](e)})),t}}if("number"===n){const n=t-e;return t=>e+t*n}throw new Error(`Cannot interpolate ${n} values`)}function cn(t){let n,r,o;return{c(){n=O("div"),n.textContent="✕",N(n,"class","_toastBtn svelte-1r0vvz1"),N(n,"role","button"),N(n,"tabindex","-1")},m(e,i){S(e,n,i),r||(o=I(n,"click",t[4]),r=!0)},p:e,d(e){e&&E(n),r=!1,o()}}}function ln(t){let n,r,o,i,s,a=t[0].msg+"",u=t[0].dismissable&&cn(t);return{c(){n=O("div"),r=O("div"),o=j(),u&&u.c(),i=j(),s=O("progress"),N(r,"class","_toastMsg svelte-1r0vvz1"),N(s,"class","_toastBar svelte-1r0vvz1"),s.value=t[1],N(n,"class","_toastItem svelte-1r0vvz1")},m(e,t){S(e,n,t),k(n,r),r.innerHTML=a,k(n,o),u&&u.m(n,null),k(n,i),k(n,s)},p(e,[t]){1&t&&a!==(a=e[0].msg+"")&&(r.innerHTML=a),e[0].dismissable?u?u.p(e,t):(u=cn(e),u.c(),u.m(n,i)):u&&(u.d(1),u=null),2&t&&(s.value=e[1])},i:e,o:e,d(e){e&&E(n),u&&u.d()}}}function fn(e,r,o){let i,{item:s}=r;const a=function(e,r={}){const o=Lt(e);let i,s=e;function a(a,u){if(null==e)return o.set(e=a),Promise.resolve();s=a;let c=i,l=!1,{delay:f=0,duration:h=400,easing:d=t,interpolate:p=un}=n(n({},r),u);if(0===h)return c&&(c.abort(),c=null),o.set(e=s),Promise.resolve();const m=v()+f;let y;return i=x((t=>{if(t<m)return!0;l||(y=p(e,a),"function"==typeof h&&(h=h(e,a)),l=!0),c&&(c.abort(),c=null);const n=t-m;return n>h?(o.set(e=a),!1):(o.set(e=y(d(n/h))),!0)})),i.promise}return{set:a,update:(t,n)=>a(t(s,e),n),subscribe:o.subscribe}}(s.initial,{duration:s.duration,easing:t});c(e,a,(e=>o(1,i=e)));let u=s.initial;return e.$$set=e=>{"item"in e&&o(0,s=e.item)},e.$$.update=()=>{9&e.$$.dirty&&u!==s.progress&&(1===s.progress||0===s.progress?a.set(s.progress).then((()=>sn.pop(s.id))):a.set(s.progress),o(3,u=s.progress))},[s,i,a,u,()=>sn.pop(s.id)]}class hn extends Be{constructor(e){super(),Pe(this,e,fn,ln,a,{item:0})}}function dn(e,t,n){const r=e.slice();return r[4]=t[n],r}function pn(t,n){let r,o,i,s,a,u,c,l,f=e;return o=new hn({props:{item:n[4]}}),{key:t,first:null,c(){r=O("li"),We(o.$$.fragment),i=j(),N(r,"style",s=n[1](n[4].theme)),this.first=r},m(e,t){S(e,r,t),Qe(o,r,null),k(r,i),l=!0},p(e,t){n=e;const i={};1&t&&(i.item=n[4]),o.$set(i),(!l||1&t&&s!==(s=n[1](n[4].theme)))&&N(r,"style",s)},r(){c=r.getBoundingClientRect()},f(){J(r),f(),K(r,c)},a(){f(),f=G(r,c,on,{duration:200})},i(e){l||($e(o.$$.fragment,e),fe((()=>{u&&u.end(1),a=Ee(r,rn,n[4].intro),a.start()})),l=!0)},o(e){Ce(o.$$.fragment,e),a&&a.invalidate(),u=Te(r,nn,{}),l=!1},d(e){e&&E(r),Le(o),e&&u&&u.end()}}}function mn(e){let t,n,r=[],o=new Map,i=e[0];const s=e=>e[4].id;for(let t=0;t<i.length;t+=1){let n=dn(e,i,t),a=s(n);o.set(a,r[t]=pn(a,n))}return{c(){t=O("ul");for(let e=0;e<r.length;e+=1)r[e].c();N(t,"class","svelte-1wt6bln")},m(e,o){S(e,t,o);for(let e=0;e<r.length;e+=1)r[e].m(t,null);n=!0},p(e,[n]){if(3&n){i=e[0],xe();for(let e=0;e<r.length;e+=1)r[e].r();r=Ne(r,n,s,1,e,i,o,t,Ie,pn,null,dn);for(let e=0;e<r.length;e+=1)r[e].a();ke()}},i(e){if(!n){for(let e=0;e<i.length;e+=1)$e(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)Ce(r[e]);n=!1},d(e){e&&E(t);for(let e=0;e<r.length;e+=1)r[e].d()}}}function yn(e,t,n){let r;c(e,sn,(e=>n(0,r=e)));let{options:o={}}=t;sn._opts({duration:4e3,dismissable:!0,initial:1,progress:0,reversed:!1,intro:{x:256},theme:{}});return e.$$set=e=>{"options"in e&&n(2,o=e.options)},e.$$.update=()=>{4&e.$$.dirty&&sn._opts(o)},[r,e=>Object.keys(e).reduce(((t,n)=>`${t}${n}:${e[n]};`),""),o]}class gn extends Be{constructor(e){super(),Pe(this,e,yn,mn,a,{options:2})}}var vn=jt((function(e,t){!function(){var t={};e.exports=t,t.simpleFilter=function(e,n){return n.filter((function(n){return t.test(e,n)}))},t.test=function(e,n){return null!==t.match(e,n)},t.match=function(e,t,n){n=n||{};var r,o=0,i=[],s=t.length,a=0,u=0,c=n.pre||"",l=n.post||"",f=n.caseSensitive&&t||t.toLowerCase();e=n.caseSensitive&&e||e.toLowerCase();for(var h=0;h<s;h++)r=t[h],f[h]===e[o]?(r=c+r+l,o+=1,u+=1+u):u=0,a+=u,i[i.length]=r;return o===e.length?(a=f===e?1/0:a,{rendered:i.join(""),score:a}):null},t.filter=function(e,n,r){return n&&0!==n.length?"string"!=typeof e?n:(r=r||{},n.reduce((function(n,o,i,s){var a=o;r.extract&&(a=r.extract(o));var u=t.match(e,a,r);return null!=u&&(n[n.length]={string:u.rendered,score:u.score,index:i,original:o}),n}),[]).sort((function(e,t){var n=t.score-e.score;return n||e.index-t.index}))):[]}}()}));const bn=e=>({}),wn=e=>({});function _n(e){let t,r,o,s,a,u,c,f,m,y;const g=e[10].label,v=l(g,e,e[9],wn),b=v||function(e){let t;return{c(){t=q(e[2])},m(e,n){S(e,t,n)},p(e,n){4&n&&R(t,e[2])},d(e){e&&E(t)}}}(e);let w=[{name:"search"},{type:"search"},{placeholder:"Search..."},{autocomplete:"off"},{spellcheck:"false"},e[6],{id:e[4]}],_={};for(let e=0;e<w.length;e+=1)_=n(_,w[e]);return{c(){t=O("form"),r=O("label"),b&&b.c(),s=j(),a=O("input"),N(r,"id",o=e[4]+"-label"),N(r,"for",e[4]),N(r,"class","svelte-5m0wg6"),W(r,"hide-label",e[3]),D(a,_),W(a,"svelte-5m0wg6",!0),N(t,"data-svelte-search",""),N(t,"role",u=e[5]?null:"search"),N(t,"aria-labelledby",c=e[5]?null:e[4])},m(n,o){var i;S(n,t,o),k(t,r),b&&b.m(r,null),k(t,s),k(t,a),a.autofocus&&a.focus(),e[17](a),M(a,e[0]),f=!0,m||(y=[I(a,"input",e[18]),I(a,"input",e[12]),I(a,"change",e[13]),I(a,"focus",e[14]),I(a,"blur",e[15]),I(a,"keydown",e[16]),I(t,"submit",(i=e[11],function(e){return e.preventDefault(),i.call(this,e)}))],m=!0)},p(e,[n]){v?v.p&&(!f||512&n)&&d(v,g,e,e[9],f?h(g,e[9],n,bn):p(e[9]),wn):b&&b.p&&(!f||4&n)&&b.p(e,f?n:-1),(!f||16&n&&o!==(o=e[4]+"-label"))&&N(r,"id",o),(!f||16&n)&&N(r,"for",e[4]),8&n&&W(r,"hide-label",e[3]),D(a,_=De(w,[{name:"search"},{type:"search"},{placeholder:"Search..."},{autocomplete:"off"},{spellcheck:"false"},64&n&&e[6],(!f||16&n)&&{id:e[4]}])),1&n&&M(a,e[0]),W(a,"svelte-5m0wg6",!0),(!f||32&n&&u!==(u=e[5]?null:"search"))&&N(t,"role",u),(!f||48&n&&c!==(c=e[5]?null:e[4]))&&N(t,"aria-labelledby",c)},i(e){f||($e(b,e),f=!0)},o(e){Ce(b,e),f=!1},d(n){n&&E(t),b&&b.d(n),e[17](null),m=!1,i(y)}}}function xn(e,t,r){const o=["value","autofocus","debounce","label","hideLabel","id","ref","removeFormAriaAttributes"];let i=y(t,o),{$$slots:s={},$$scope:a}=t,{value:u=""}=t,{autofocus:c=!1}=t,{debounce:l=0}=t,{label:f="Label"}=t,{hideLabel:h=!1}=t,{id:d="search"+Math.random().toString(36)}=t,{ref:p=null}=t,{removeFormAriaAttributes:g=!1}=t;const v=ee();let b,w=u,_=!1;return Y((()=>(c&&window.requestAnimationFrame((()=>p.focus())),()=>clearTimeout(b)))),X((()=>{var e;u.length>0&&u!==w&&(l>0?(e=()=>v("type",u),_||(_=!0,b=setTimeout((()=>{e(),_=!1}),l))):v("type",u)),0===u.length&&w.length>0&&v("clear"),w=u})),e.$$set=e=>{t=n(n({},t),m(e)),r(6,i=y(t,o)),"value"in e&&r(0,u=e.value),"autofocus"in e&&r(7,c=e.autofocus),"debounce"in e&&r(8,l=e.debounce),"label"in e&&r(2,f=e.label),"hideLabel"in e&&r(3,h=e.hideLabel),"id"in e&&r(4,d=e.id),"ref"in e&&r(1,p=e.ref),"removeFormAriaAttributes"in e&&r(5,g=e.removeFormAriaAttributes),"$$scope"in e&&r(9,a=e.$$scope)},[u,p,f,h,d,g,i,c,l,a,s,function(t){ne.call(this,e,t)},function(t){ne.call(this,e,t)},function(t){ne.call(this,e,t)},function(t){ne.call(this,e,t)},function(t){ne.call(this,e,t)},function(t){ne.call(this,e,t)},function(e){oe[e?"unshift":"push"]((()=>{p=e,r(1,p)}))},function(){u=this.value,r(0,u)}]}var kn=class extends Be{constructor(e){super(),Pe(this,e,xn,_n,a,{value:0,autofocus:7,debounce:8,label:2,hideLabel:3,id:4,ref:1,removeFormAriaAttributes:5})}};function $n(e,t,n){const r=e.slice();return r[38]=t[n],r[40]=n,r}const Cn=e=>({result:2&e[0]}),Sn=e=>({result:e[38],index:e[40]});function En(e){let t,n,r=e[1],o=[];for(let t=0;t<r.length;t+=1)o[t]=Tn($n(e,r,t));const i=e=>Ce(o[e],1,1,(()=>{o[e]=null}));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=A()},m(e,r){for(let t=0;t<o.length;t+=1)o[t].m(e,r);S(e,t,r),n=!0},p(e,n){if(262342&n[0]){let s;for(r=e[1],s=0;s<r.length;s+=1){const i=$n(e,r,s);o[s]?(o[s].p(i,n),$e(o[s],1)):(o[s]=Tn(i),o[s].c(),$e(o[s],1),o[s].m(t.parentNode,t))}for(xe(),s=r.length;s<o.length;s+=1)i(s);ke()}},i(e){if(!n){for(let e=0;e<r.length;e+=1)$e(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)Ce(o[e]);n=!1},d(e){T(o,e),e&&E(t)}}}function Tn(e){let t,n,r,o,i,s,a;const u=e[19].default,c=l(u,e,e[18],Sn),f=c||function(e){let t,n,r=e[38].string+"";return{c(){t=new L(!1),n=A(),t.a=n},m(e,o){t.m(r,e,o),S(e,n,o)},p(e,n){2&n[0]&&r!==(r=e[38].string+"")&&t.p(r)},d(e){e&&E(n),e&&t.d()}}}(e);function m(){return e[33](e[38],e[40])}return{c(){t=O("li"),f&&f.c(),n=j(),N(t,"role","option"),N(t,"id",r=e[2]+"-result-"+e[40]),N(t,"aria-selected",o=e[6]===e[40]),N(t,"class","svelte-t0wd5r"),W(t,"selected",e[6]===e[40]),W(t,"disabled",e[38].disabled)},m(e,r){S(e,t,r),f&&f.m(t,null),k(t,n),i=!0,s||(a=I(t,"click",m),s=!0)},p(n,s){e=n,c?c.p&&(!i||262146&s[0])&&d(c,u,e,e[18],i?h(u,e[18],s,Cn):p(e[18]),Sn):f&&f.p&&(!i||2&s[0])&&f.p(e,i?s:[-1,-1]),(!i||4&s[0]&&r!==(r=e[2]+"-result-"+e[40]))&&N(t,"id",r),(!i||64&s[0]&&o!==(o=e[6]===e[40]))&&N(t,"aria-selected",o),64&s[0]&&W(t,"selected",e[6]===e[40]),2&s[0]&&W(t,"disabled",e[38].disabled)},i(e){i||($e(f,e),i=!0)},o(e){Ce(f,e),i=!1},d(e){e&&E(t),f&&f.d(e),s=!1,a()}}}function On(e){let t,r,o,i,s,a,u,c,l,f,h,d,p,m;const y=[{id:e[2]},{removeFormAriaAttributes:!0},e[8],{"aria-autocomplete":"list"},{"aria-controls":e[2]+"-listbox"},{"aria-labelledby":e[2]+"-label"},{"aria-activedescendant":e[6]>=0&&!e[5]&&e[1].length>0?`${e[2]}-result-${e[6]}`:null}];function g(t){e[21](t)}function v(t){e[22](t)}let b={};for(let e=0;e<y.length;e+=1)b=n(b,y[e]);void 0!==e[4]&&(b.ref=e[4]),void 0!==e[0]&&(b.value=e[0]),r=new kn({props:b}),oe.push((()=>Me(r,"ref",g))),oe.push((()=>Me(r,"value",v))),r.$on("type",e[23]),r.$on("input",e[24]),r.$on("change",e[25]),r.$on("focus",e[26]),r.$on("focus",e[27]),r.$on("clear",e[28]),r.$on("clear",e[29]),r.$on("blur",e[30]),r.$on("keydown",e[31]),r.$on("keydown",e[32]);let w=!e[5]&&e[1].length>0&&En(e);return{c(){t=O("div"),We(r.$$.fragment),s=j(),a=O("ul"),w&&w.c(),N(a,"role","listbox"),N(a,"aria-labelledby",u=e[2]+"-label"),N(a,"id",c=e[2]+"-listbox"),N(a,"class","svelte-t0wd5r"),W(a,"svelte-typeahead-list",!0),N(t,"data-svelte-typeahead",""),N(t,"role","combobox"),N(t,"aria-haspopup","listbox"),N(t,"aria-owns",l=e[2]+"-listbox"),N(t,"aria-expanded",f=!e[5]&&e[1].length>0),N(t,"id",h=e[2]+"-typeahead"),N(t,"class","svelte-t0wd5r"),W(t,"dropdown",e[1].length>0)},m(n,o){S(n,t,o),Qe(r,t,null),k(t,s),k(t,a),w&&w.m(a,null),e[34](t),d=!0,p||(m=I(window,"click",e[20]),p=!0)},p(e,n){const s=358&n[0]?De(y,[4&n[0]&&{id:e[2]},y[1],256&n[0]&&Re(e[8]),y[3],4&n[0]&&{"aria-controls":e[2]+"-listbox"},4&n[0]&&{"aria-labelledby":e[2]+"-label"},102&n[0]&&{"aria-activedescendant":e[6]>=0&&!e[5]&&e[1].length>0?`${e[2]}-result-${e[6]}`:null}]):{};!o&&16&n[0]&&(o=!0,s.ref=e[4],he((()=>o=!1))),!i&&1&n[0]&&(i=!0,s.value=e[0],he((()=>i=!1))),r.$set(s),!e[5]&&e[1].length>0?w?(w.p(e,n),34&n[0]&&$e(w,1)):(w=En(e),w.c(),$e(w,1),w.m(a,null)):w&&(xe(),Ce(w,1,1,(()=>{w=null})),ke()),(!d||4&n[0]&&u!==(u=e[2]+"-label"))&&N(a,"aria-labelledby",u),(!d||4&n[0]&&c!==(c=e[2]+"-listbox"))&&N(a,"id",c),(!d||4&n[0]&&l!==(l=e[2]+"-listbox"))&&N(t,"aria-owns",l),(!d||34&n[0]&&f!==(f=!e[5]&&e[1].length>0))&&N(t,"aria-expanded",f),(!d||4&n[0]&&h!==(h=e[2]+"-typeahead"))&&N(t,"id",h),2&n[0]&&W(t,"dropdown",e[1].length>0)},i(e){d||($e(r.$$.fragment,e),$e(w),d=!0)},o(e){Ce(r.$$.fragment,e),Ce(w),d=!1},d(n){n&&E(t),Le(r),w&&w.d(),e[34](null),p=!1,m()}}}function qn(e,t,r){let o,i;const s=["id","value","data","extract","disable","filter","autoselect","inputAfterSelect","results","focusAfterSelect","limit"];let a=y(t,s),{$$slots:u={},$$scope:c}=t,{id:l="typeahead-"+Math.random().toString(36)}=t,{value:f=""}=t,{data:h=[]}=t,{extract:d=(e=>e)}=t,{disable:p=(e=>!1)}=t,{filter:g=(e=>!1)}=t,{autoselect:v=!0}=t,{inputAfterSelect:b="update"}=t,{results:w=[]}=t,{focusAfterSelect:_=!1}=t,{limit:x=1/0}=t;const k=ee();let $=null,C=null,S=!1,E=-1,T="";async function O(){const e=w[E],t=d(e.original),n=f;"clear"==b&&r(0,f=""),"update"==b&&r(0,f=t),k("select",{selectedIndex:E,searched:n,selected:t,original:e.original,originalIndex:e.index}),await le(),_&&C.focus(),r(5,S=!0)}X((()=>{T!==i&&v&&r(6,E=0),T!==i&&r(5,S=0===w.length),T=i}));return e.$$set=e=>{t=n(n({},t),m(e)),r(8,a=y(t,s)),"id"in e&&r(2,l=e.id),"value"in e&&r(0,f=e.value),"data"in e&&r(9,h=e.data),"extract"in e&&r(10,d=e.extract),"disable"in e&&r(11,p=e.disable),"filter"in e&&r(12,g=e.filter),"autoselect"in e&&r(13,v=e.autoselect),"inputAfterSelect"in e&&r(14,b=e.inputAfterSelect),"results"in e&&r(1,w=e.results),"focusAfterSelect"in e&&r(15,_=e.focusAfterSelect),"limit"in e&&r(16,x=e.limit),"$$scope"in e&&r(18,c=e.$$scope)},e.$$.update=()=>{1024&e.$$.dirty[0]&&r(17,o={pre:"<mark>",post:"</mark>",extract:d}),203265&e.$$.dirty[0]&&r(1,w=vn.filter(f,h,o).filter((({score:e})=>e>0)).slice(0,x).filter((e=>!g(e.original))).map((e=>({...e,disabled:p(e.original)})))),1026&e.$$.dirty[0]&&(i=w.map((e=>d(e.original))).join(""))},[f,w,l,$,C,S,E,O,a,h,d,p,g,v,b,_,x,o,c,u,({target:e})=>{!S&&w.length>0&&$&&!$.contains(e)&&r(5,S=!0)},function(e){C=e,r(4,C)},function(e){f=e,r(0,f)},function(t){ne.call(this,e,t)},function(t){ne.call(this,e,t)},function(t){ne.call(this,e,t)},function(t){ne.call(this,e,t)},()=>{r(5,S=!1)},function(t){ne.call(this,e,t)},()=>{r(5,S=!1)},function(t){ne.call(this,e,t)},function(t){ne.call(this,e,t)},e=>{switch(e.key){case"Enter":O();break;case"ArrowDown":e.preventDefault(),r(6,E+=1),E===w.length&&r(6,E=0);break;case"ArrowUp":e.preventDefault(),r(6,E-=1),E<0&&r(6,E=w.length-1);break;case"Escape":e.preventDefault(),r(0,f=""),C.focus(),r(5,S=!0)}},(e,t)=>{e.disabled||(r(6,E=t),O())},function(e){oe[e?"unshift":"push"]((()=>{$=e,r(3,$)}))}]}var jn=class extends Be{constructor(e){super(),Pe(this,e,qn,On,a,{id:2,value:0,data:9,extract:10,disable:11,filter:12,autoselect:13,inputAfterSelect:14,results:1,focusAfterSelect:15,limit:16},null,[-1,-1])}};function An(e,t,n){const r=e.slice();return r[12]=t[n],r}function In(e,t,n){const r=e.slice();return r[15]=t[n],r}function Nn(e){let t,n,r,o,i=e[18].string+"",s=Wn(e[18].original.type)+"";return{c(){t=new L(!1),n=j(),r=O("span"),o=q(s),t.a=n,N(r,"class","category-info svelte-mmit17")},m(e,s){t.m(i,e,s),S(e,n,s),S(e,r,s),k(r,o)},p(e,n){262144&n&&i!==(i=e[18].string+"")&&t.p(i),262144&n&&s!==(s=Wn(e[18].original.type)+"")&&R(o,s)},d(e){e&&t.d(),e&&E(n),e&&E(r)}}}function Dn(e){let t,n,r,o,i=e[15].name+"";function s(){return e[7](e[15])}return{c(){t=O("button"),n=q(i),N(t,"class","svelte-mmit17")},m(e,i){S(e,t,i),k(t,n),r||(o=I(t,"click",s),r=!0)},p(t,r){e=t,1&r&&i!==(i=e[15].name+"")&&R(n,i)},d(e){e&&E(t),r=!1,o()}}}function Rn(e){let t,n,r,o,i,s=e[12].name+"";function a(){return e[8](e[12])}return{c(){t=O("button"),n=q(s),r=j(),N(t,"class","svelte-mmit17")},m(e,s){S(e,t,s),k(t,n),k(t,r),o||(i=I(t,"click",a),o=!0)},p(t,r){e=t,1&r&&s!==(s=e[12].name+"")&&R(n,s)},d(e){e&&E(t),o=!1,i()}}}function Mn(e){let t,n,r,o,i;t=new jn({props:{data:e[2],extract:e[1],limit:"5",inputAfterSelect:"clear",placeholder:"search for filters...",hideLabel:"true",autoselect:"false",$$slots:{default:[Nn,({result:e})=>({18:e}),({result:e})=>e?262144:0]},$$scope:{ctx:e}}}),t.$on("select",e[6]);let s=e[0].active.users,a=[];for(let t=0;t<s.length;t+=1)a[t]=Dn(In(e,s,t));let u=e[0].active.playlists,c=[];for(let t=0;t<u.length;t+=1)c[t]=Rn(An(e,u,t));return{c(){We(t.$$.fragment),n=j(),r=O("div");for(let e=0;e<a.length;e+=1)a[e].c();o=j();for(let e=0;e<c.length;e+=1)c[e].c();N(r,"class","filter-buttons svelte-mmit17")},m(e,s){Qe(t,e,s),S(e,n,s),S(e,r,s);for(let e=0;e<a.length;e+=1)a[e].m(r,null);k(r,o);for(let e=0;e<c.length;e+=1)c[e].m(r,null);i=!0},p(e,[n]){const i={};if(786432&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i),17&n){let t;for(s=e[0].active.users,t=0;t<s.length;t+=1){const i=In(e,s,t);a[t]?a[t].p(i,n):(a[t]=Dn(i),a[t].c(),a[t].m(r,o))}for(;t<a.length;t+=1)a[t].d(1);a.length=s.length}if(17&n){let t;for(u=e[0].active.playlists,t=0;t<u.length;t+=1){const o=An(e,u,t);c[t]?c[t].p(o,n):(c[t]=Rn(o),c[t].c(),c[t].m(r,null))}for(;t<c.length;t+=1)c[t].d(1);c.length=u.length}},i(e){i||($e(t.$$.fragment,e),i=!0)},o(e){Ce(t.$$.fragment,e),i=!1},d(e){Le(t,e),e&&E(n),e&&E(r),T(a,e),T(c,e)}}}function Wn(e){return"in "+e}function Qn(e,t,n){let r,o;c(e,Bt,(e=>n(9,r=e))),c(e,Vt,(e=>n(0,o=e)));let{infiniteId:i}=t;let s=function(e){let t=[],n=[];return e.users.forEach(((e,n)=>t=[...t,{type:"users",data:e}])),e.playlists.forEach(((e,t)=>n=[...n,{type:"playlists",data:e}])),[...t,...n]}(o.criteria);function a(){Kt(r).then((e=>{Gt.set(1e3),Ft.set(e),Ut.yes()}))}function u(e){Vt.add(e.type,e.data),a()}function l(e,t){Vt.delete(e,t),n(5,i=Symbol()),a()}return e.$$set=e=>{"infiniteId"in e&&n(5,i=e.infiniteId)},[o,e=>e.data.name,s,u,l,i,e=>{u(e.detail.original)},e=>{l("users",e)},e=>{l("playlists",e)}]}class Ln extends Be{constructor(e){super(),Pe(this,e,Qn,Mn,a,{infiniteId:5})}}function Pn(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function Bn(e){Pn(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))}var Fn={};function Un(){return Fn}function Vn(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function Gn(e,t){Pn(2,arguments);var n=Bn(e),r=Bn(t),o=n.getTime()-r.getTime();return o<0?-1:o>0?1:o}function Jn(e,t){Pn(2,arguments);var n=Bn(e),r=Bn(t),o=n.getFullYear()-r.getFullYear(),i=n.getMonth()-r.getMonth();return 12*o+i}function Kn(e,t){return Pn(2,arguments),Bn(e).getTime()-Bn(t).getTime()}var Hn={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(e){return e<0?Math.ceil(e):Math.floor(e)}};function zn(e){return e?Hn[e]:Hn.trunc}function Yn(e){Pn(1,arguments);var t=Bn(e);return t.setHours(23,59,59,999),t}function Xn(e){Pn(1,arguments);var t=Bn(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function Zn(e){Pn(1,arguments);var t=Bn(e);return Yn(t).getTime()===Xn(t).getTime()}function er(e,t){Pn(2,arguments);var n,r=Bn(e),o=Bn(t),i=Gn(r,o),s=Math.abs(Jn(r,o));if(s<1)n=0;else{1===r.getMonth()&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-i*s);var a=Gn(r,o)===-i;Zn(Bn(e))&&1===s&&1===Gn(e,o)&&(a=!1),n=i*(s-Number(a))}return 0===n?0:n}function tr(e,t,n){Pn(2,arguments);var r=Kn(e,t)/1e3;return zn(null==n?void 0:n.roundingMethod)(r)}var nr={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},rr=function(e,t,n){var r,o=nr[e];return r="string"==typeof o?o:1===t?o.one:o.other.replace("{{count}}",t.toString()),null!=n&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function or(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width?String(t.width):e.defaultWidth,r=e.formats[n]||e.formats[e.defaultWidth];return r}}var ir={date:or({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:or({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:or({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},sr={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},ar=function(e,t,n,r){return sr[e]};function ur(e){return function(t,n){var r;if("formatting"===(null!=n&&n.context?String(n.context):"standalone")&&e.formattingValues){var o=e.defaultFormattingWidth||e.defaultWidth,i=null!=n&&n.width?String(n.width):o;r=e.formattingValues[i]||e.formattingValues[o]}else{var s=e.defaultWidth,a=null!=n&&n.width?String(n.width):e.defaultWidth;r=e.values[a]||e.values[s]}return r[e.argumentCallback?e.argumentCallback(t):t]}}var cr={ordinalNumber:function(e,t){var n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:ur({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:ur({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:ur({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:ur({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:ur({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})};function lr(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.width,o=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],i=t.match(o);if(!i)return null;var s,a=i[0],u=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(u)?hr(u,(function(e){return e.test(a)})):fr(u,(function(e){return e.test(a)}));s=e.valueCallback?e.valueCallback(c):c,s=n.valueCallback?n.valueCallback(s):s;var l=t.slice(a.length);return{value:s,rest:l}}}function fr(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n}function hr(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n}var dr,pr={ordinalNumber:(dr={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.match(dr.matchPattern);if(!n)return null;var r=n[0],o=e.match(dr.parsePattern);if(!o)return null;var i=dr.valueCallback?dr.valueCallback(o[0]):o[0];i=t.valueCallback?t.valueCallback(i):i;var s=e.slice(r.length);return{value:i,rest:s}}),era:lr({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:lr({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:lr({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:lr({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:lr({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},mr={code:"en-US",formatDistance:rr,formatLong:ir,formatRelative:ar,localize:cr,match:pr,options:{weekStartsOn:0,firstWeekContainsDate:1}};function yr(e,t){if(null==e)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}function gr(e){return yr({},e)}var vr=1440,br=43200;function wr(e,t,n){const r=e.slice();return r[19]=t[n].name,r[20]=t[n].link,r[22]=n,r}function _r(e){let t,n,r,o,i=e[19]+"",s=kr(e[2],e[22])+"";return{c(){t=O("a"),n=q(i),o=q(s),N(t,"href",r=e[20]),N(t,"target","_blank"),N(t,"class","svelte-vbc8jy")},m(e,r){S(e,t,r),k(t,n),S(e,o,r)},p(e,a){4&a&&i!==(i=e[19]+"")&&R(n,i),4&a&&r!==(r=e[20])&&N(t,"href",r),4&a&&s!==(s=kr(e[2],e[22])+"")&&R(o,s)},d(e){e&&E(t),e&&E(o)}}}function xr(t){let n,r,o,i,s,a,u,c,l,f,h,d,p,m,y,g,v,b,w,_,x,$=t[8](t[7])+"",C=t[2],A=[];for(let e=0;e<C.length;e+=1)A[e]=_r(wr(t,C,e));return{c(){n=O("h1"),r=O("a"),o=q(t[1]),i=j(),s=O("h2"),a=q("by \n\t\t");for(let e=0;e<A.length;e+=1)A[e].c();u=j(),c=O("h3"),l=q("added to "),f=O("a"),h=q(t[3]),d=q(" \n\t\tby "),p=O("a"),m=O("b"),y=q(t[6]),g=j(),v=q($),b=j(),w=O("br"),_=j(),x=O("br"),N(r,"href",t[0]),N(r,"target","_blank"),N(r,"class","svelte-vbc8jy"),N(n,"class","svelte-vbc8jy"),N(s,"class","svelte-vbc8jy"),N(f,"href",t[4]),N(f,"target","_blank"),N(f,"class","svelte-vbc8jy"),N(p,"href",t[5]),N(p,"target","_blank"),N(p,"class","svelte-vbc8jy"),N(c,"class","svelte-vbc8jy")},m(e,t){S(e,n,t),k(n,r),k(r,o),S(e,i,t),S(e,s,t),k(s,a);for(let e=0;e<A.length;e+=1)A[e].m(s,null);S(e,u,t),S(e,c,t),k(c,l),k(c,f),k(f,h),k(c,d),k(c,p),k(p,m),k(m,y),k(c,g),k(c,v),S(e,b,t),S(e,w,t),S(e,_,t),S(e,x,t)},p(e,[t]){if(2&t&&R(o,e[1]),1&t&&N(r,"href",e[0]),4&t){let n;for(C=e[2],n=0;n<C.length;n+=1){const r=wr(e,C,n);A[n]?A[n].p(r,t):(A[n]=_r(r),A[n].c(),A[n].m(s,null))}for(;n<A.length;n+=1)A[n].d(1);A.length=C.length}8&t&&R(h,e[3]),16&t&&N(f,"href",e[4]),64&t&&R(y,e[6]),32&t&&N(p,"href",e[5]),128&t&&$!==($=e[8](e[7])+"")&&R(v,$)},i:e,o:e,d(e){e&&E(n),e&&E(i),e&&E(s),T(A,e),e&&E(u),e&&E(c),e&&E(b),e&&E(w),e&&E(_),e&&E(x)}}}function kr(e,t){return e.length-1==t?"":e.length-2==t?" & ":", "}function $r(e,t,n){let{song_link:r}=t,{song_title:o}=t,{artists:i}=t,{playlist_name:s}=t,{playlist_link:a}=t,{playlist_id:u}=t,{uid:c}=t,{song_popularity:l}=t,{song_duration:f}=t,{song_islocal:h}=t,{song_id:d}=t,{album_name:p}=t,{album_link:m}=t,{subm_id:y}=t,{subm_images:g}=t,{subm_link:v}=t,{subm_name:b}=t,{unix:w}=t;return e.$$set=e=>{"song_link"in e&&n(0,r=e.song_link),"song_title"in e&&n(1,o=e.song_title),"artists"in e&&n(2,i=e.artists),"playlist_name"in e&&n(3,s=e.playlist_name),"playlist_link"in e&&n(4,a=e.playlist_link),"playlist_id"in e&&n(9,u=e.playlist_id),"uid"in e&&n(10,c=e.uid),"song_popularity"in e&&n(11,l=e.song_popularity),"song_duration"in e&&n(12,f=e.song_duration),"song_islocal"in e&&n(13,h=e.song_islocal),"song_id"in e&&n(14,d=e.song_id),"album_name"in e&&n(15,p=e.album_name),"album_link"in e&&n(16,m=e.album_link),"subm_id"in e&&n(17,y=e.subm_id),"subm_images"in e&&n(18,g=e.subm_images),"subm_link"in e&&n(5,v=e.subm_link),"subm_name"in e&&n(6,b=e.subm_name),"unix"in e&&n(7,w=e.unix)},[r,o,i,s,a,v,b,w,function(e){const t=function(e,t,n){var r,o;Pn(2,arguments);var i=Un(),s=null!==(r=null!==(o=null==n?void 0:n.locale)&&void 0!==o?o:i.locale)&&void 0!==r?r:mr;if(!s.formatDistance)throw new RangeError("locale must contain formatDistance property");var a=Gn(e,t);if(isNaN(a))throw new RangeError("Invalid time value");var u,c,l=yr(gr(n),{addSuffix:Boolean(null==n?void 0:n.addSuffix),comparison:a});a>0?(u=Bn(t),c=Bn(e)):(u=Bn(e),c=Bn(t));var f,h=tr(c,u),d=(Vn(c)-Vn(u))/1e3,p=Math.round((h-d)/60);if(p<2)return null!=n&&n.includeSeconds?h<5?s.formatDistance("lessThanXSeconds",5,l):h<10?s.formatDistance("lessThanXSeconds",10,l):h<20?s.formatDistance("lessThanXSeconds",20,l):h<40?s.formatDistance("halfAMinute",0,l):h<60?s.formatDistance("lessThanXMinutes",1,l):s.formatDistance("xMinutes",1,l):0===p?s.formatDistance("lessThanXMinutes",1,l):s.formatDistance("xMinutes",p,l);if(p<45)return s.formatDistance("xMinutes",p,l);if(p<90)return s.formatDistance("aboutXHours",1,l);if(p<vr){var m=Math.round(p/60);return s.formatDistance("aboutXHours",m,l)}if(p<2520)return s.formatDistance("xDays",1,l);if(p<br){var y=Math.round(p/vr);return s.formatDistance("xDays",y,l)}if(p<86400)return f=Math.round(p/br),s.formatDistance("aboutXMonths",f,l);if((f=er(c,u))<12){var g=Math.round(p/br);return s.formatDistance("xMonths",g,l)}var v=f%12,b=Math.floor(f/12);return v<3?s.formatDistance("aboutXYears",b,l):v<9?s.formatDistance("overXYears",b,l):s.formatDistance("almostXYears",b+1,l)}(new Date(e),new Date,{addSuffix:!0});return t},u,c,l,f,h,d,p,m,y,g]}class Cr extends Be{constructor(e){super(),Pe(this,e,$r,xr,a,{song_link:0,song_title:1,artists:2,playlist_name:3,playlist_link:4,playlist_id:9,uid:10,song_popularity:11,song_duration:12,song_islocal:13,song_id:14,album_name:15,album_link:16,subm_id:17,subm_images:18,subm_link:5,subm_name:6,unix:7})}}function Sr(t){let n,r,o;return{c(){n=O("div"),n.textContent="↑",N(n,"class","top-button svelte-14i0ems"),W(n,"hidden",t[0])},m(e,i){S(e,n,i),r||(o=[I(window,"scroll",t[1]),I(n,"click",Er)],r=!0)},p(e,[t]){1&t&&W(n,"hidden",e[0])},i:e,o:e,d(e){e&&E(n),r=!1,i(o)}}}function Er(){document.body.scrollIntoView({behavior:"smooth"})}function Tr(){return document.documentElement||document.body}function Or(e,t,n){let{showOnPx:r=250}=t,o=!0;return e.$$set=e=>{"showOnPx"in e&&n(2,r=e.showOnPx)},[o,function(){Tr()&&n(0,o=!(Tr().scrollTop>r))},r]}class qr extends Be{constructor(e){super(),Pe(this,e,Or,Sr,a,{showOnPx:2})}}function jr(e,t,n){const r=e.slice();return r[7]=t[n],r}function Ar(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function Ir(e){let t,n,r,o,i,s,a,u=[],c=new Map;function l(t){e[4](t)}let f={};void 0!==e[0]&&(f.infiniteId=e[0]),t=new Ln({props:f}),oe.push((()=>Me(t,"infiniteId",l)));let h=e[1];const d=e=>e[7].uid;for(let t=0;t<h.length;t+=1){let n=jr(e,h,t),r=d(n);c.set(r,u[t]=Nr(r,n))}return s=new gt({props:{identifier:e[0],spinner:"wavedots",$$slots:{noResults:[Rr],noMore:[Dr]},$$scope:{ctx:e}}}),s.$on("infinite",e[3]),{c(){We(t.$$.fragment),r=j(),o=O("div");for(let e=0;e<u.length;e+=1)u[e].c();i=j(),We(s.$$.fragment),N(o,"class","box svelte-n03c0i")},m(e,n){Qe(t,e,n),S(e,r,n),S(e,o,n);for(let e=0;e<u.length;e+=1)u[e].m(o,null);S(e,i,n),Qe(s,e,n),a=!0},p(e,r){const i={};if(!n&&1&r&&(n=!0,i.infiniteId=e[0],he((()=>n=!1))),t.$set(i),2&r){h=e[1],xe();for(let e=0;e<u.length;e+=1)u[e].r();u=Ne(u,r,d,1,e,h,c,o,Ie,Nr,null,jr);for(let e=0;e<u.length;e+=1)u[e].a();ke()}const a={};1&r&&(a.identifier=e[0]),1024&r&&(a.$$scope={dirty:r,ctx:e}),s.$set(a)},i(e){if(!a){$e(t.$$.fragment,e);for(let e=0;e<h.length;e+=1)$e(u[e]);$e(s.$$.fragment,e),a=!0}},o(e){Ce(t.$$.fragment,e);for(let e=0;e<u.length;e+=1)Ce(u[e]);Ce(s.$$.fragment,e),a=!1},d(e){Le(t,e),e&&E(r),e&&E(o);for(let e=0;e<u.length;e+=1)u[e].d();e&&E(i),Le(s,e)}}}function Nr(t,r){let o,i,s,a,u,c,l,f,h,d=e;const p=[r[7]];let m={};for(let e=0;e<p.length;e+=1)m=n(m,p[e]);return a=new Cr({props:m}),{key:t,first:null,c(){o=O("div"),i=O("div"),s=O("div"),We(a.$$.fragment),l=j(),this.first=o},m(e,t){S(e,o,t),k(o,i),k(i,s),Qe(a,s,null),k(o,l),h=!0},p(e,t){r=e;const n=2&t?De(p,[Re(r[7])]):{};a.$set(n)},r(){f=o.getBoundingClientRect()},f(){J(o),d()},a(){d(),d=G(o,f,on,{duration:2e3,easing:tn,delay:150})},i(e){h||($e(a.$$.fragment,e),u&&u.end(1),c||fe((()=>{c=Ee(i,rn,{duration:3e3,x:-300,opacity:0,easing:tn,delay:r[2]}),c.start()})),h=!0)},o(e){Ce(a.$$.fragment,e),u=Te(s,rn,{duration:1e3,x:300,easing:tn}),h=!1},d(e){e&&E(o),Le(a),e&&u&&u.end()}}}function Dr(t){let n;return{c(){n=O("span"),n.textContent="that's all folks!",N(n,"slot","noMore")},m(e,t){S(e,n,t)},p:e,d(e){e&&E(n)}}}function Rr(t){let n;return{c(){n=O("span"),n.textContent="that's all folks!",N(n,"slot","noResults")},m(e,t){S(e,n,t)},p:e,d(e){e&&E(n)}}}function Mr(t){let n;return{c(){n=O("p"),n.innerHTML="fetching your collaborative playlists from spotify.\n\t\t\t<br/> \n\t\t\t<br/>\n\t\t\tif this is your first time launching this page, this might take a while."},m(e,t){S(e,n,t)},p:e,i:e,o:e,d(e){e&&E(n)}}}function Wr(e){let t,n,r,o,i={ctx:e,current:null,token:null,hasCatch:!1,pending:Mr,then:Ir,catch:Ar,blocks:[,,,]};return qe(Jt(),i),r=new qr({}),{c(){t=O("main"),i.block.c(),n=j(),We(r.$$.fragment)},m(e,s){S(e,t,s),i.block.m(t,i.anchor=null),i.mount=()=>t,i.anchor=n,k(t,n),Qe(r,t,null),o=!0},p(t,[n]){je(i,e=t,n)},i(e){o||($e(i.block),$e(r.$$.fragment,e),o=!0)},o(e){for(let e=0;e<3;e+=1){Ce(i.blocks[e])}Ce(r.$$.fragment,e),o=!1},d(e){e&&E(t),i.block.d(),i.token=null,i=null,Le(r)}}}function Qr(e,t,n){let r,o,i,s;c(e,Bt,(e=>n(5,r=e))),c(e,Ut,(e=>n(6,o=e))),c(e,Ft,(e=>n(1,i=e))),c(e,Gt,(e=>n(2,s=e)));let a=Symbol();return history.pushState({},"feed","/spotify-collab-tracker"),Y((()=>{setInterval((()=>{console.log("Fetching new data..."),Jt().then((e=>{e&&Kt(r).then((e=>{Gt.set(400),Ft.set(e),Ut.yes()})).then(sn.push("something happened!"))}))}),12e4),setInterval((()=>{Ft.refresh()}),6e4)})),[a,i,s,function({detail:{loaded:e,complete:t}}){Kt(r).then((n=>{n.length==i.length&&0==o?t():(Bt.increment(),Gt.set(0),Ft.set(n),Ut.no(),e())}))},function(e){a=e,n(0,a)}]}class Lr extends Be{constructor(e){super(),Pe(this,e,Qr,Wr,a,{})}}function Pr(t){let n;return{c(){n=O("h1"),n.innerHTML='what is this project?\n<p class="svelte-1uxb3mi">this website can help you keep track of all the activity across your collaborative playlists.\nonce logged in, you will be able to see who added what song by what artist to which playlist how long ago. and it&#39;s all sorted chronologically! just keep scrolling to travel back in time. while you browse the page periodically checks if anything has happened and, if anything has, will automatically adjust your feed and tell you. no refreshing required.</p>\nwhy is this project a thing?\n<p class="svelte-1uxb3mi">there&#39;s a good chance this isn&#39;t something you want or need. however if you and peers enjoy actively making use of the collaborative playlist feature then this is supposed to serve you as a fairly easy and comfortable way of keeping up with recently added songs across a large quantity of playlists.</p>\nis this it?\n<p class="svelte-1uxb3mi">this is a passion project i work on in my spare time. i am aware the current version is very basic but more features are planned and in development. if you want more information or are looking to contribute feel free to check out the <a href="https://github.com/sebastian-stubenvoll/spotify-collab-tracker" target="_blank" class="svelte-1uxb3mi">the github page</a>.</p>\nwhy is my playlist not showing up?\n<p class="svelte-1uxb3mi">spotify has recently changed their implementation for collaborative playlists requiring users to explicitly invite other collaborateurs. while this is ultimately a good thing as it does prevent bots from invading collaborative playlists, spotify has not chosen to update their API to reflect this new collaboration system. while i hope that this update is going to happen in the near future, for now this website will only show playlists created using the old collaboration system (i.e. those where anyone with a link can add new songs).</p>',N(n,"class","svelte-1uxb3mi")},m(e,t){S(e,n,t)},p:e,i:e,o:e,d(e){e&&E(n)}}}class Br extends Be{constructor(e){super(),Pe(this,e,null,Pr,a,{})}}function Fr(t){let n,r,o,i,s,a,u,c,l,f,h,d,p,m,y,g;return{c(){n=O("h1"),r=q("how is my data accessed?\n\t"),o=O("p"),o.innerHTML="once you&#39;ve logged in via spotify and granted the required permissions all the requests are sent from <b>your browser directly to spotify</b>. this means none of your private spotify data is ever accessed by the server hosting this website.",i=q("\nhow is my data stored?\n"),s=O("p"),a=q("all of your data is stored "),u=O("b"),u.textContent="locally",c=q(" inside your browser (indexedDB). this is only done to keep the number of requests as low as possible. you can delete the locally stored information at any point via your browser or by clicking "),l=O("button"),l.innerHTML="<b>here</b>",f=q("."),h=q("\nwhat data does this page store exactly?\n"),d=O("p"),d.textContent="this webapp only stores the data that is necessary for functionality. right now this is a database of your collaborative playlists and some information required to log into spotify. in the future this may also include user settings such as themes. all the data is only stored locally (i.e. in your browser) and will never be stored on the server hosting this page (as it is completely static).",p=q("\ni'm still not sure...\n"),m=O("p"),m.innerHTML='if you have any remaining concerns, feel free to check out the <a href="https://github.com/sebastian-stubenvoll/spotify-collab-tracker" target="_blank" class="svelte-17vdl9c"><b>source code</b></a>.',N(o,"class","svelte-17vdl9c"),N(l,"class","svelte-17vdl9c"),N(s,"class","svelte-17vdl9c"),N(d,"class","svelte-17vdl9c"),N(m,"class","svelte-17vdl9c"),N(n,"class","svelte-17vdl9c")},m(e,v){S(e,n,v),k(n,r),k(n,o),k(n,i),k(n,s),k(s,a),k(s,u),k(s,c),k(s,l),k(s,f),k(n,h),k(n,d),k(n,p),k(n,m),y||(g=I(l,"click",t[0]),y=!0)},p:e,i:e,o:e,d(e){e&&E(n),y=!1,g()}}}function Ur(e){return[()=>{indexedDB.deleteDatabase("sctdb"),sn.push("All your data has been deleted!")}]}class Vr extends Be{constructor(e){super(),Pe(this,e,Ur,Fr,a,{})}}function Gr(t){let n,r,o;return{c(){n=O("button"),n.textContent="×",N(n,"class","svelte-x3sqgi")},m(e,i){S(e,n,i),r||(o=I(n,"click",(function(){s(t[0])&&t[0].apply(this,arguments)})),r=!0)},p(e,[n]){t=e},i:e,o:e,d(e){e&&E(n),r=!1,o()}}}function Jr(e,t,n){let{onClose:r}=t;return e.$$set=e=>{"onClose"in e&&n(0,r=e.onClose)},[r]}class Kr extends Be{constructor(e){super(),Pe(this,e,Jr,Gr,a,{onClose:0})}}function Hr(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function zr(t){let n,r,o,s,a,u,c,l,f,h,d,p;return{c(){n=O("h1"),r=O("p"),o=O("a"),s=q("login with spotify"),a=j(),u=O("br"),c=j(),l=O("button"),l.textContent="privacy",f=O("button"),f.textContent="about",N(o,"href",t[6]),N(o,"class","svelte-1qhf4fy"),N(l,"class","svelte-1qhf4fy"),N(f,"class","svelte-1qhf4fy"),N(n,"class","svelte-1qhf4fy")},m(e,i){S(e,n,i),k(n,r),k(r,o),k(o,s),k(r,a),k(r,u),k(r,c),k(r,l),k(r,f),d||(p=[I(l,"click",t[3]),I(f,"click",t[2])],d=!0)},p(e,n){t=e},i(e){h||fe((()=>{h=Ee(r,rn,{duration:2e3,y:t[0]/3,opacity:0,easing:en}),h.start()}))},o:e,d(e){e&&E(n),d=!1,i(p)}}}function Yr(t){let n;return{c(){n=O("h1"),N(n,"class","svelte-1qhf4fy")},m(e,t){S(e,n,t)},p:e,i:e,o:e,d(e){e&&E(n)}}}function Xr(t){let n,r,o,i,s;fe(t[4]);let a={ctx:t,current:null,token:null,hasCatch:!1,pending:Yr,then:zr,catch:Hr,value:6};return qe(t[1],a),{c(){n=O("link"),r=j(),o=A(),a.block.c(),N(n,"rel","stylesheet"),N(n,"href","login.css")},m(e,u){k(document.head,n),S(e,r,u),S(e,o,u),a.block.m(e,a.anchor=u),a.mount=()=>o.parentNode,a.anchor=o,i||(s=I(window,"resize",t[4]),i=!0)},p(e,[n]){je(a,t=e,n)},i(e){$e(a.block)},o:e,d(e){E(n),e&&E(r),e&&E(o),a.block.d(e),a.token=null,a=null,i=!1,s()}}}function Zr(e,t,n){const r=Et();let o;const{open:i}=(s="simple-modal",z().$$.context.get(s));var s;return[o,r,()=>i(Br,{},{closeButton:Kr}),()=>i(Vr,{},{closeButton:Kr}),function(){n(0,o=window.innerHeight)}]}class eo extends Be{constructor(e){super(),Pe(this,e,Zr,Xr,a,{})}}const{window:to}=Ae;function no(e){let t,n,r,o,a,u,c,l,f,h,d,p=e[0].closeButton&&ro(e);var m=e[1];return m&&(u=new m({})),{c(){t=O("div"),n=O("div"),r=O("div"),p&&p.c(),o=j(),a=O("div"),u&&We(u.$$.fragment),N(a,"class","content svelte-2wx9ab"),N(a,"style",e[8]),N(r,"class","window svelte-2wx9ab"),N(r,"role","dialog"),N(r,"aria-modal","true"),N(r,"style",e[7]),N(n,"class","window-wrap svelte-2wx9ab"),N(n,"style",e[6]),N(t,"class","bg svelte-2wx9ab"),N(t,"style",e[5])},m(i,c){S(i,t,c),k(t,n),k(n,r),p&&p.m(r,null),k(r,o),k(r,a),u&&Qe(u,a,null),e[37](r),e[38](n),e[39](t),f=!0,h||(d=[I(r,"introstart",(function(){s(e[12])&&e[12].apply(this,arguments)})),I(r,"outrostart",(function(){s(e[13])&&e[13].apply(this,arguments)})),I(r,"introend",(function(){s(e[14])&&e[14].apply(this,arguments)})),I(r,"outroend",(function(){s(e[15])&&e[15].apply(this,arguments)})),I(t,"click",e[19])],h=!0)},p(i,s){if((e=i)[0].closeButton?p?(p.p(e,s),1&s[0]&&$e(p,1)):(p=ro(e),p.c(),$e(p,1),p.m(r,o)):p&&(xe(),Ce(p,1,1,(()=>{p=null})),ke()),m!==(m=e[1])){if(u){xe();const e=u;Ce(e.$$.fragment,1,0,(()=>{Le(e,1)})),ke()}m?(u=new m({}),We(u.$$.fragment),$e(u.$$.fragment,1),Qe(u,a,null)):u=null}(!f||256&s[0])&&N(a,"style",e[8]),(!f||128&s[0])&&N(r,"style",e[7]),(!f||64&s[0])&&N(n,"style",e[6]),(!f||32&s[0])&&N(t,"style",e[5])},i(n){f||($e(p),u&&$e(u.$$.fragment,n),fe((()=>{c||(c=Oe(r,e[11],e[0].transitionWindowProps,!0)),c.run(1)})),fe((()=>{l||(l=Oe(t,e[10],e[0].transitionBgProps,!0)),l.run(1)})),f=!0)},o(n){Ce(p),u&&Ce(u.$$.fragment,n),c||(c=Oe(r,e[11],e[0].transitionWindowProps,!1)),c.run(0),l||(l=Oe(t,e[10],e[0].transitionBgProps,!1)),l.run(0),f=!1},d(n){n&&E(t),p&&p.d(),u&&Le(u),e[37](null),n&&c&&c.end(),e[38](null),e[39](null),n&&l&&l.end(),h=!1,i(d)}}}function ro(e){let t,n,r,o,i;const s=[io,oo],a=[];function u(e,n){return 1&n[0]&&(t=null),null==t&&(t=!!e[16](e[0].closeButton)),t?0:1}return n=u(e,[-1,-1]),r=a[n]=s[n](e),{c(){r.c(),o=A()},m(e,t){a[n].m(e,t),S(e,o,t),i=!0},p(e,t){let i=n;n=u(e,t),n===i?a[n].p(e,t):(xe(),Ce(a[i],1,1,(()=>{a[i]=null})),ke(),r=a[n],r?r.p(e,t):(r=a[n]=s[n](e),r.c()),$e(r,1),r.m(o.parentNode,o))},i(e){i||($e(r),i=!0)},o(e){Ce(r),i=!1},d(e){a[n].d(e),e&&E(o)}}}function oo(t){let n,r,o;return{c(){n=O("button"),N(n,"class","close svelte-2wx9ab"),N(n,"style",t[9])},m(e,i){S(e,n,i),r||(o=I(n,"click",t[17]),r=!0)},p(e,t){512&t[0]&&N(n,"style",e[9])},i:e,o:e,d(e){e&&E(n),r=!1,o()}}}function io(e){let t,n,r;var o=e[0].closeButton;function i(e){return{props:{onClose:e[17]}}}return o&&(t=new o(i(e))),{c(){t&&We(t.$$.fragment),n=A()},m(e,o){t&&Qe(t,e,o),S(e,n,o),r=!0},p(e,r){if(o!==(o=e[0].closeButton)){if(t){xe();const e=t;Ce(e.$$.fragment,1,0,(()=>{Le(e,1)})),ke()}o?(t=new o(i(e)),We(t.$$.fragment),$e(t.$$.fragment,1),Qe(t,n.parentNode,n)):t=null}},i(e){r||(t&&$e(t.$$.fragment,e),r=!0)},o(e){t&&Ce(t.$$.fragment,e),r=!1},d(e){e&&E(n),t&&Le(t,e)}}}function so(e){let t,n,r,o,i=e[1]&&no(e);const s=e[36].default,a=l(s,e,e[35],null);return{c(){i&&i.c(),t=j(),a&&a.c()},m(s,u){i&&i.m(s,u),S(s,t,u),a&&a.m(s,u),n=!0,r||(o=I(to,"keydown",e[18]),r=!0)},p(e,r){e[1]?i?(i.p(e,r),2&r[0]&&$e(i,1)):(i=no(e),i.c(),$e(i,1),i.m(t.parentNode,t)):i&&(xe(),Ce(i,1,1,(()=>{i=null})),ke()),a&&a.p&&(!n||16&r[1])&&d(a,s,e,e[35],n?h(s,e[35],r,null):p(e[35]),null)},i(e){n||($e(i),$e(a,e),n=!0)},o(e){Ce(i),Ce(a,e),n=!1},d(e){i&&i.d(e),e&&E(t),a&&a.d(e),r=!1,o()}}}function ao(e,t,n){let{$$slots:r={},$$scope:o}=t;const i=ee(),s=te;let{show:a=null}=t,{key:u="simple-modal"}=t,{closeButton:c=!0}=t,{closeOnEsc:l=!0}=t,{closeOnOuterClick:f=!0}=t,{styleBg:h={}}=t,{styleWindowWrap:d={}}=t,{styleWindow:p={}}=t,{styleContent:m={}}=t,{styleCloseButton:y={}}=t,{setContext:g=s}=t,{transitionBg:v=nn}=t,{transitionBgProps:b={duration:250}}=t,{transitionWindow:w=v}=t,{transitionWindowProps:_=b}=t;const x={closeButton:c,closeOnEsc:l,closeOnOuterClick:f,styleBg:h,styleWindowWrap:d,styleWindow:p,styleContent:m,styleCloseButton:y,transitionBg:v,transitionBgProps:b,transitionWindow:w,transitionWindowProps:_};let k,$,C,S,E,T,O,q,j,A,I,N,D,R={...x},M=null;const W=e=>Object.keys(e).reduce(((t,n)=>`${t}; ${(e=>e.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase())(n)}: ${e[n]}`),""),Q=e=>!!(e&&e.constructor&&e.call&&e.apply),L=()=>{};let P=L,B=L,F=L,U=L;const V=(e,t={},r={},o={})=>{n(1,M=function(e,t={}){return function(n){return new e({...n,props:{...t,...n.props}})}}(e,t)),n(0,R={...x,...r}),n(5,E=W(R.styleBg)),n(6,T=W(R.styleWindowWrap)),n(7,O=W(R.styleWindow)),n(8,q=W(R.styleContent)),n(9,j=W(R.styleCloseButton)),n(10,A=R.transitionBg),n(11,I=R.transitionWindow),J(),n(12,P=e=>{o.onOpen&&o.onOpen(e),i("open"),i("opening")}),n(13,B=e=>{o.onClose&&o.onClose(e),i("close"),i("closing")}),n(14,F=e=>{o.onOpened&&o.onOpened(e),i("opened")}),n(15,U=e=>{o.onClosed&&o.onClosed(e),i("closed")})},G=(e={})=>{n(13,B=e.onClose||B),n(15,U=e.onClosed||U),n(1,M=null),K()},J=()=>{S=window.scrollY,N=document.body.style.position,D=document.body.style.overflow,document.body.style.position="fixed",document.body.style.top=`-${S}px`,document.body.style.overflow="hidden"},K=()=>{document.body.style.position=N||"",document.body.style.top="",document.body.style.overflow=D||"",window.scrollTo(0,S)};return g(u,{open:V,close:G}),Z((()=>{G()})),e.$$set=e=>{"show"in e&&n(20,a=e.show),"key"in e&&n(21,u=e.key),"closeButton"in e&&n(22,c=e.closeButton),"closeOnEsc"in e&&n(23,l=e.closeOnEsc),"closeOnOuterClick"in e&&n(24,f=e.closeOnOuterClick),"styleBg"in e&&n(25,h=e.styleBg),"styleWindowWrap"in e&&n(26,d=e.styleWindowWrap),"styleWindow"in e&&n(27,p=e.styleWindow),"styleContent"in e&&n(28,m=e.styleContent),"styleCloseButton"in e&&n(29,y=e.styleCloseButton),"setContext"in e&&n(30,g=e.setContext),"transitionBg"in e&&n(31,v=e.transitionBg),"transitionBgProps"in e&&n(32,b=e.transitionBgProps),"transitionWindow"in e&&n(33,w=e.transitionWindow),"transitionWindowProps"in e&&n(34,_=e.transitionWindowProps),"$$scope"in e&&n(35,o=e.$$scope)},e.$$.update=()=>{1048576&e.$$.dirty[0]&&(Q(a)?V(a):G())},[R,M,k,$,C,E,T,O,q,j,A,I,P,B,F,U,Q,G,e=>{if(R.closeOnEsc&&M&&"Escape"===e.key&&(e.preventDefault(),G()),M&&"Tab"===e.key){const t=C.querySelectorAll("*"),n=Array.from(t).filter((e=>e.tabIndex>=0));let r=n.indexOf(document.activeElement);-1===r&&e.shiftKey&&(r=0),r+=n.length+(e.shiftKey?-1:1),r%=n.length,n[r].focus(),e.preventDefault()}},e=>{!R.closeOnOuterClick||e.target!==k&&e.target!==$||(e.preventDefault(),G())},a,u,c,l,f,h,d,p,m,y,g,v,b,w,_,o,r,function(e){oe[e?"unshift":"push"]((()=>{C=e,n(4,C)}))},function(e){oe[e?"unshift":"push"]((()=>{$=e,n(3,$)}))},function(e){oe[e?"unshift":"push"]((()=>{k=e,n(2,k)}))}]}class uo extends Be{constructor(e){super(),Pe(this,e,ao,so,a,{show:20,key:21,closeButton:22,closeOnEsc:23,closeOnOuterClick:24,styleBg:25,styleWindowWrap:26,styleWindow:27,styleContent:28,styleCloseButton:29,setContext:30,transitionBg:31,transitionBgProps:32,transitionWindow:33,transitionWindowProps:34},null,[-1,-1])}}var co="%[a-f0-9]{2}",lo=new RegExp(co,"gi"),fo=new RegExp("("+co+")+","gi");function ho(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),r=e.slice(t);return Array.prototype.concat.call([],ho(n),ho(r))}function po(e){try{return decodeURIComponent(e)}catch(r){for(var t=e.match(lo),n=1;n<t.length;n++)t=(e=ho(t,n).join("")).match(lo);return e}}var mo=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},n=fo.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var r=po(n[0]);r!==n[0]&&(t[n[0]]=r)}n=fo.exec(e)}t["%C2"]="�";for(var o=Object.keys(t),i=0;i<o.length;i++){var s=o[i];e=e.replace(new RegExp(s,"g"),t[s])}return e}(e)}},yo=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const n=e.indexOf(t);return-1===n?[e]:[e.slice(0,n),e.slice(n+t.length)]},go=function(e,t){for(var n={},r=Object.keys(e),o=Array.isArray(t),i=0;i<r.length;i++){var s=r[i],a=e[s];(o?-1!==t.indexOf(s):t(s,a,e))&&(n[s]=a)}return n},vo=jt((function(e,t){const n=Symbol("encodeFragmentIdentifier");function r(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function o(e,t){return t.encode?t.strict?encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)):encodeURIComponent(e):e}function i(e,t){return t.decode?mo(e):e}function s(e){return Array.isArray(e)?e.sort():"object"==typeof e?s(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function a(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function u(e){const t=(e=a(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function c(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function l(e,t){r((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const n=function(e){let t;switch(e.arrayFormat){case"index":return(e,n,r)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===r[e]&&(r[e]={}),r[e][t[1]]=n):r[e]=n};case"bracket":return(e,n,r)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==r[e]?r[e]=[].concat(r[e],n):r[e]=[n]:r[e]=n};case"colon-list-separator":return(e,n,r)=>{t=/(:list)$/.exec(e),e=e.replace(/:list$/,""),t?void 0!==r[e]?r[e]=[].concat(r[e],n):r[e]=[n]:r[e]=n};case"comma":case"separator":return(t,n,r)=>{const o="string"==typeof n&&n.includes(e.arrayFormatSeparator),s="string"==typeof n&&!o&&i(n,e).includes(e.arrayFormatSeparator);n=s?i(n,e):n;const a=o||s?n.split(e.arrayFormatSeparator).map((t=>i(t,e))):null===n?n:i(n,e);r[t]=a};case"bracket-separator":return(t,n,r)=>{const o=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!o)return void(r[t]=n?i(n,e):n);const s=null===n?[]:n.split(e.arrayFormatSeparator).map((t=>i(t,e)));void 0!==r[t]?r[t]=[].concat(r[t],s):r[t]=s};default:return(e,t,n)=>{void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t),o=Object.create(null);if("string"!=typeof e)return o;if(!(e=e.trim().replace(/^[?#&]/,"")))return o;for(const r of e.split("&")){if(""===r)continue;let[e,s]=yo(t.decode?r.replace(/\+/g," "):r,"=");s=void 0===s?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?s:i(s,t),n(i(e,t),s,o)}for(const e of Object.keys(o)){const n=o[e];if("object"==typeof n&&null!==n)for(const e of Object.keys(n))n[e]=c(n[e],t);else o[e]=c(n,t)}return!1===t.sort?o:(!0===t.sort?Object.keys(o).sort():Object.keys(o).sort(t.sort)).reduce(((e,t)=>{const n=o[t];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?e[t]=s(n):e[t]=n,e}),Object.create(null))}t.extract=u,t.parse=l,t.stringify=(e,t)=>{if(!e)return"";r((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const n=n=>t.skipNull&&null==e[n]||t.skipEmptyString&&""===e[n],i=function(e){switch(e.arrayFormat){case"index":return t=>(n,r)=>{const i=n.length;return void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,[o(t,e),"[",i,"]"].join("")]:[...n,[o(t,e),"[",o(i,e),"]=",o(r,e)].join("")]};case"bracket":return t=>(n,r)=>void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,[o(t,e),"[]"].join("")]:[...n,[o(t,e),"[]=",o(r,e)].join("")];case"colon-list-separator":return t=>(n,r)=>void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,[o(t,e),":list="].join("")]:[...n,[o(t,e),":list=",o(r,e)].join("")];case"comma":case"separator":case"bracket-separator":{const t="bracket-separator"===e.arrayFormat?"[]=":"=";return n=>(r,i)=>void 0===i||e.skipNull&&null===i||e.skipEmptyString&&""===i?r:(i=null===i?"":i,0===r.length?[[o(n,e),t,o(i,e)].join("")]:[[r,o(i,e)].join(e.arrayFormatSeparator)])}default:return t=>(n,r)=>void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,o(t,e)]:[...n,[o(t,e),"=",o(r,e)].join("")]}}(t),s={};for(const t of Object.keys(e))n(t)||(s[t]=e[t]);const a=Object.keys(s);return!1!==t.sort&&a.sort(t.sort),a.map((n=>{const r=e[n];return void 0===r?"":null===r?o(n,t):Array.isArray(r)?0===r.length&&"bracket-separator"===t.arrayFormat?o(n,t)+"[]":r.reduce(i(n),[]).join("&"):o(n,t)+"="+o(r,t)})).filter((e=>e.length>0)).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[n,r]=yo(e,"#");return Object.assign({url:n.split("?")[0]||"",query:l(u(e),t)},t&&t.parseFragmentIdentifier&&r?{fragmentIdentifier:i(r,t)}:{})},t.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0,[n]:!0},r);const i=a(e.url).split("?")[0]||"",s=t.extract(e.url),u=t.parse(s,{sort:!1}),c=Object.assign(u,e.query);let l=t.stringify(c,r);l&&(l=`?${l}`);let f=function(e){let t="";const n=e.indexOf("#");return-1!==n&&(t=e.slice(n)),t}(e.url);return e.fragmentIdentifier&&(f=`#${r[n]?o(e.fragmentIdentifier,r):e.fragmentIdentifier}`),`${i}${l}${f}`},t.pick=(e,r,o)=>{o=Object.assign({parseFragmentIdentifier:!0,[n]:!1},o);const{url:i,query:s,fragmentIdentifier:a}=t.parseUrl(e,o);return t.stringifyUrl({url:i,query:go(s,r),fragmentIdentifier:a},o)},t.exclude=(e,n,r)=>{const o=Array.isArray(n)?e=>!n.includes(e):(e,t)=>!n(e,t);return t.pick(e,o,r)}}));function bo(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function wo(e){let t,n,r,o;const i=[xo,_o],s=[];function a(e,t){return e[0]?1:0}return t=a(e),n=s[t]=i[t](e),{c(){n.c(),r=A()},m(e,n){s[t].m(e,n),S(e,r,n),o=!0},p(e,o){let u=t;t=a(e),t!==u&&(xe(),Ce(s[u],1,1,(()=>{s[u]=null})),ke(),n=s[t],n||(n=s[t]=i[t](e),n.c()),$e(n,1),n.m(r.parentNode,r))},i(e){o||($e(n),o=!0)},o(e){Ce(n),o=!1},d(e){s[t].d(e),e&&E(r)}}}function _o(e){let t,n;return t=new Lr({}),{c(){We(t.$$.fragment)},m(e,r){Qe(t,e,r),n=!0},i(e){n||($e(t.$$.fragment,e),n=!0)},o(e){Ce(t.$$.fragment,e),n=!1},d(e){Le(t,e)}}}function xo(e){let t,n;return t=new eo({}),{c(){We(t.$$.fragment)},m(e,r){Qe(t,e,r),n=!0},i(e){n||($e(t.$$.fragment,e),n=!0)},o(e){Ce(t.$$.fragment,e),n=!1},d(e){Le(t,e)}}}function ko(t){let n;return{c(){n=q("checking spotify access!")},m(e,t){S(e,n,t)},p:e,i:e,o:e,d(e){e&&E(n)}}}function $o(e){let t,n,r,o,i={ctx:e,current:null,token:null,hasCatch:!1,pending:ko,then:wo,catch:bo,blocks:[,,,]};return qe(e[2],i),r=new gn({props:{options:e[1]}}),{c(){t=O("main"),i.block.c(),n=j(),We(r.$$.fragment),N(t,"class","svelte-ocq6f6")},m(e,s){S(e,t,s),i.block.m(t,i.anchor=null),i.mount=()=>t,i.anchor=null,S(e,n,s),Qe(r,e,s),o=!0},p(t,n){je(i,e=t,n)},i(e){o||($e(i.block),$e(r.$$.fragment,e),o=!0)},o(e){for(let e=0;e<3;e+=1){Ce(i.blocks[e])}Ce(r.$$.fragment,e),o=!1},d(e){e&&E(t),i.block.d(),i.token=null,i=null,e&&E(n),Le(r,e)}}}function Co(e){let t,n;return t=new uo({props:{$$slots:{default:[$o]},$$scope:{ctx:e}}}),{c(){We(t.$$.fragment)},m(e,r){Qe(t,e,r),n=!0},p(e,[n]){const r={};33&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||($e(t.$$.fragment,e),n=!0)},o(e){Ce(t.$$.fragment,e),n=!1},d(e){Le(t,e)}}}function So(e,t,n){let r;const o=async function(){await async function(){if("undefined"!=typeof window){const e=vo.parse(window.location.search);if(e.code){if(await async function(e){if(e.state!=localStorage.getItem("state"))return!1;{let t=[];const n={client_id:_t,grant_type:"authorization_code",code:e.code,redirect_uri:xt,code_verifier:localStorage.getItem("verifier")};for(let e in n){const r=encodeURIComponent(e),o=encodeURIComponent(n[e]);t.push(r+"="+o)}t=t.join("&");const r="https://accounts.spotify.com/api/token",o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t});if(200!=o.status)return!1;{const e=await o.json();return kt=e.access_token,$t=e.refresh_token,Ct=1e3*e.expires_in,localStorage.removeItem("verifier"),St=setInterval(Tt,Ct-.1*Ct),!0}}}(e))return!0}}return!1}()?n(0,r=!0):n(0,r=!1)}();return[r,{duration:1e4},o]}return new class extends Be{constructor(e){super(),Pe(this,e,So,Co,a,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
