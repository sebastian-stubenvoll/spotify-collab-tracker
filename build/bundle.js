/**
 * Copyright 2021 Sebastian Stubenvoll
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 *
 * ------------------
 *
 * For the respective dependency licenses see here: https://github.com/sebastian-stubenvoll/spotify-collab-tracker/blob/main/dependencies.txt
 */

var app=function(){"use strict";function e(){}const t=e=>e;function n(e,t){for(const n in t)e[n]=t[n];return e}function r(e){return e()}function o(){return Object.create(null)}function i(e){e.forEach(r)}function s(e){return"function"==typeof e}function a(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function u(t,n,r){t.$$.on_destroy.push(function(t,...n){if(null==t)return e;const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}(n,r))}function c(e,t,n,r){if(e){const o=l(e,t,n,r);return e[0](o)}}function l(e,t,r,o){return e[1]&&o?n(r.ctx.slice(),e[1](o(t))):r.ctx}function f(e,t,n,r,o,i,s){const a=function(e,t,n,r){if(e[2]&&r){const o=e[2](r(n));if(void 0===t.dirty)return o;if("object"==typeof o){const e=[],n=Math.max(t.dirty.length,o.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|o[r];return e}return t.dirty|o}return t.dirty}(t,r,o,i);if(a){const o=l(t,n,r,s);e.p(o,a)}}const h="undefined"!=typeof window;let d=h?()=>window.performance.now():()=>Date.now(),p=h?e=>requestAnimationFrame(e):e;const y=new Set;function m(e){y.forEach((t=>{t.c(e)||(y.delete(t),t.f())})),0!==y.size&&p(m)}function g(e){let t;return 0===y.size&&p(m),{promise:new Promise((n=>{y.add(t={c:e,f:n})})),abort(){y.delete(t)}}}function v(e,t){e.appendChild(t)}function b(e,t,n){e.insertBefore(t,n||null)}function w(e){e.parentNode.removeChild(e)}function _(e){return document.createElement(e)}function k(e){return document.createTextNode(e)}function x(){return k(" ")}function C(){return k("")}function T(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function E(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function S(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function O(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}const q=new Set;let j,I=0;function $(e,t,n,r,o,i,s,a=0){const u=16.666/r;let c="{\n";for(let e=0;e<=1;e+=u){const r=t+(n-t)*i(e);c+=100*e+`%{${s(r,1-r)}}\n`}const l=c+`100% {${s(n,1-n)}}\n}`,f=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(l)}_${a}`,h=e.ownerDocument;q.add(h);const d=h.__svelte_stylesheet||(h.__svelte_stylesheet=h.head.appendChild(_("style")).sheet),p=h.__svelte_rules||(h.__svelte_rules={});p[f]||(p[f]=!0,d.insertRule(`@keyframes ${f} ${l}`,d.cssRules.length));const y=e.style.animation||"";return e.style.animation=`${y?`${y}, `:""}${f} ${r}ms linear ${o}ms 1 both`,I+=1,f}function A(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),o=n.length-r.length;o&&(e.style.animation=r.join(", "),I-=o,I||p((()=>{I||(q.forEach((e=>{const t=e.__svelte_stylesheet;let n=t.cssRules.length;for(;n--;)t.deleteRule(n);e.__svelte_rules={}})),q.clear())})))}function N(n,r,o,i){if(!r)return e;const s=n.getBoundingClientRect();if(r.left===s.left&&r.right===s.right&&r.top===s.top&&r.bottom===s.bottom)return e;const{delay:a=0,duration:u=300,easing:c=t,start:l=d()+a,end:f=l+u,tick:h=e,css:p}=o(n,{from:r,to:s},i);let y,m=!0,v=!1;function b(){p&&A(n,y),m=!1}return g((e=>{if(!v&&e>=l&&(v=!0),v&&e>=f&&(h(1,0),b()),!m)return!1;if(v){const t=0+1*c((e-l)/u);h(t,1-t)}return!0})),p&&(y=$(n,0,1,u,a,c,p)),a||(v=!0),h(0,1),b}function D(e){const t=getComputedStyle(e);if("absolute"!==t.position&&"fixed"!==t.position){const{width:n,height:r}=t,o=e.getBoundingClientRect();e.style.position="absolute",e.style.width=n,e.style.height=r,R(e,o)}}function R(e,t){const n=e.getBoundingClientRect();if(t.left!==n.left||t.top!==n.top){const r=getComputedStyle(e),o="none"===r.transform?"":r.transform;e.style.transform=`${o} translate(${t.left-n.left}px, ${t.top-n.top}px)`}}function W(e){j=e}function Q(){if(!j)throw new Error("Function called outside component initialization");return j}function M(e){Q().$$.on_mount.push(e)}function L(e){Q().$$.on_destroy.push(e)}function B(){const e=Q();return(t,n)=>{const r=e.$$.callbacks[t];if(r){const o=O(t,n);r.slice().forEach((t=>{t.call(e,o)}))}}}function P(e,t){Q().$$.context.set(e,t)}const F=[],V=[],U=[],G=[],J=Promise.resolve();let K=!1;function z(){K||(K=!0,J.then(ee))}function H(){return z(),J}function Y(e){U.push(e)}let X=!1;const Z=new Set;function ee(){if(!X){X=!0;do{for(let e=0;e<F.length;e+=1){const t=F[e];W(t),te(t.$$)}for(W(null),F.length=0;V.length;)V.pop()();for(let e=0;e<U.length;e+=1){const t=U[e];Z.has(t)||(Z.add(t),t())}U.length=0}while(F.length);for(;G.length;)G.pop()();K=!1,X=!1,Z.clear()}}function te(e){if(null!==e.fragment){e.update(),i(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Y)}}let ne;function re(){return ne||(ne=Promise.resolve(),ne.then((()=>{ne=null}))),ne}function oe(e,t,n){e.dispatchEvent(O(`${t?"intro":"outro"}${n}`))}const ie=new Set;let se;function ae(){se={r:0,c:[],p:se}}function ue(){se.r||i(se.c),se=se.p}function ce(e,t){e&&e.i&&(ie.delete(e),e.i(t))}function le(e,t,n,r){if(e&&e.o){if(ie.has(e))return;ie.add(e),se.c.push((()=>{ie.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}}const fe={duration:0};function he(n,r,o){let i,a,u=r(n,o),c=!1,l=0;function f(){i&&A(n,i)}function h(){const{delay:r=0,duration:o=300,easing:s=t,tick:h=e,css:p}=u||fe;p&&(i=$(n,0,1,o,r,s,p,l++)),h(0,1);const y=d()+r,m=y+o;a&&a.abort(),c=!0,Y((()=>oe(n,!0,"start"))),a=g((e=>{if(c){if(e>=m)return h(1,0),oe(n,!0,"end"),f(),c=!1;if(e>=y){const t=s((e-y)/o);h(t,1-t)}}return c}))}let p=!1;return{start(){p||(A(n),s(u)?(u=u(),re().then(h)):h())},invalidate(){p=!1},end(){c&&(f(),c=!1)}}}function de(n,r,o){let a,u=r(n,o),c=!0;const l=se;function f(){const{delay:r=0,duration:o=300,easing:s=t,tick:f=e,css:h}=u||fe;h&&(a=$(n,1,0,o,r,s,h));const p=d()+r,y=p+o;Y((()=>oe(n,!1,"start"))),g((e=>{if(c){if(e>=y)return f(0,1),oe(n,!1,"end"),--l.r||i(l.c),!1;if(e>=p){const t=s((e-p)/o);f(1-t,t)}}return c}))}return l.r+=1,s(u)?re().then((()=>{u=u(),f()})):f(),{end(e){e&&u.tick&&u.tick(1,0),c&&(a&&A(n,a),c=!1)}}}function pe(n,r,o,a){let u=r(n,o),c=a?0:1,l=null,f=null,h=null;function p(){h&&A(n,h)}function y(e,t){const n=e.b-c;return t*=Math.abs(n),{a:c,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function m(r){const{delay:o=0,duration:s=300,easing:a=t,tick:m=e,css:v}=u||fe,b={start:d()+o,b:r};r||(b.group=se,se.r+=1),l||f?f=b:(v&&(p(),h=$(n,c,r,s,o,a,v)),r&&m(0,1),l=y(b,s),Y((()=>oe(n,r,"start"))),g((e=>{if(f&&e>f.start&&(l=y(f,s),f=null,oe(n,l.b,"start"),v&&(p(),h=$(n,c,l.b,l.duration,0,a,u.css))),l)if(e>=l.end)m(c=l.b,1-c),oe(n,l.b,"end"),f||(l.b?p():--l.group.r||i(l.group.c)),l=null;else if(e>=l.start){const t=e-l.start;c=l.a+l.d*a(t/l.duration),m(c,1-c)}return!(!l&&!f)})))}return{run(e){s(u)?re().then((()=>{u=u(),m(e)})):m(e)},end(){p(),l=f=null}}}function ye(e,t){const n=t.token={};function r(e,r,o,i){if(t.token!==n)return;t.resolved=i;let s=t.ctx;void 0!==o&&(s=s.slice(),s[o]=i);const a=e&&(t.current=e)(s);let u=!1;t.block&&(t.blocks?t.blocks.forEach(((e,n)=>{n!==r&&e&&(ae(),le(e,1,1,(()=>{t.blocks[n]===e&&(t.blocks[n]=null)})),ue())})):t.block.d(1),a.c(),ce(a,1),a.m(t.mount(),t.anchor),u=!0),t.block=a,t.blocks&&(t.blocks[r]=a),u&&ee()}if((o=e)&&"object"==typeof o&&"function"==typeof o.then){const n=Q();if(e.then((e=>{W(n),r(t.then,1,t.value,e),W(null)}),(e=>{if(W(n),r(t.catch,2,t.error,e),W(null),!t.hasCatch)throw e})),t.current!==t.pending)return r(t.pending,0),!0}else{if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved=e}var o}const me="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function ge(e,t){e.f(),function(e,t){le(e,1,1,(()=>{t.delete(e.key)}))}(e,t)}function ve(e,t,n,r,o,i,s,a,u,c,l,f){let h=e.length,d=i.length,p=h;const y={};for(;p--;)y[e[p].key]=p;const m=[],g=new Map,v=new Map;for(p=d;p--;){const e=f(o,i,p),a=n(e);let u=s.get(a);u?r&&u.p(e,t):(u=c(a,e),u.c()),g.set(a,m[p]=u),a in y&&v.set(a,Math.abs(p-y[a]))}const b=new Set,w=new Set;function _(e){ce(e,1),e.m(a,l),s.set(e.key,e),l=e.first,d--}for(;h&&d;){const t=m[d-1],n=e[h-1],r=t.key,o=n.key;t===n?(l=t.first,h--,d--):g.has(o)?!s.has(r)||b.has(r)?_(t):w.has(o)?h--:v.get(r)>v.get(o)?(w.add(r),_(t)):(b.add(o),h--):(u(n,s),h--)}for(;h--;){const t=e[h];g.has(t.key)||u(t,s)}for(;d;)_(m[d-1]);return m}function be(e){e&&e.c()}function we(e,t,n,o){const{fragment:a,on_mount:u,on_destroy:c,after_update:l}=e.$$;a&&a.m(t,n),o||Y((()=>{const t=u.map(r).filter(s);c?c.push(...t):i(t),e.$$.on_mount=[]})),l.forEach(Y)}function _e(e,t){const n=e.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ke(t,n,r,s,a,u,c=[-1]){const l=j;W(t);const f=t.$$={fragment:null,ctx:null,props:u,update:e,not_equal:a,bound:o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l?l.$$.context:n.context||[]),callbacks:o(),dirty:c,skip_bound:!1};let h=!1;if(f.ctx=r?r(t,n.props||{},((e,n,...r)=>{const o=r.length?r[0]:n;return f.ctx&&a(f.ctx[e],f.ctx[e]=o)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](o),h&&function(e,t){-1===e.$$.dirty[0]&&(F.push(e),z(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),n})):[],f.update(),h=!0,i(f.before_update),f.fragment=!!s&&s(f.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);f.fragment&&f.fragment.l(e),e.forEach(w)}else f.fragment&&f.fragment.c();n.intro&&ce(t.$$.fragment),we(t,n.target,n.anchor,n.customElement),ee()}W(l)}class xe{$destroy(){_e(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function Ce(e){let t;return{c(){t=_("i"),E(t,"class","loading-default svelte-10h86fq")},m(e,n){b(e,t,n)},d(e){e&&w(t)}}}function Te(e){let t;return{c(){t=_("span"),t.innerHTML='<span class="wave-item svelte-10h86fq"></span> \n\t\t<span class="wave-item svelte-10h86fq"></span> \n\t\t<span class="wave-item svelte-10h86fq"></span> \n\t\t<span class="wave-item svelte-10h86fq"></span> \n\t\t<span class="wave-item svelte-10h86fq"></span>',E(t,"class","loading-wave-dots svelte-10h86fq")},m(e,n){b(e,t,n)},d(e){e&&w(t)}}}function Ee(e){let t;return{c(){t=_("i"),E(t,"class","loading-spiral svelte-10h86fq")},m(e,n){b(e,t,n)},d(e){e&&w(t)}}}function Se(e){let t;return{c(){t=_("span"),t.innerHTML='<span class="circle-item svelte-10h86fq"></span> \n\t\t<span class="circle-item svelte-10h86fq"></span> \n\t\t<span class="circle-item svelte-10h86fq"></span> \n\t\t<span class="circle-item svelte-10h86fq"></span> \n\t\t<span class="circle-item svelte-10h86fq"></span> \n\t\t<span class="circle-item svelte-10h86fq"></span> \n\t\t<span class="circle-item svelte-10h86fq"></span> \n\t\t<span class="circle-item svelte-10h86fq"></span>',E(t,"class","loading-circles svelte-10h86fq")},m(e,n){b(e,t,n)},d(e){e&&w(t)}}}function Oe(e){let t;return{c(){t=_("span"),t.innerHTML='<span class="bubble-item svelte-10h86fq"></span> \n\t\t<span class="bubble-item svelte-10h86fq"></span> \n\t\t<span class="bubble-item svelte-10h86fq"></span> \n\t\t<span class="bubble-item svelte-10h86fq"></span> \n\t\t<span class="bubble-item svelte-10h86fq"></span> \n\t\t<span class="bubble-item svelte-10h86fq"></span> \n\t\t<span class="bubble-item svelte-10h86fq"></span> \n\t\t<span class="bubble-item svelte-10h86fq"></span>',E(t,"class","loading-bubbles svelte-10h86fq")},m(e,n){b(e,t,n)},d(e){e&&w(t)}}}function qe(t){let n;function r(e,t){return"bubbles"===e[0]?Oe:"circles"===e[0]?Se:"spiral"===e[0]?Ee:"wavedots"===e[0]?Te:Ce}let o=r(t),i=o(t);return{c(){i.c(),n=C()},m(e,t){i.m(e,t),b(e,n,t)},p(e,[t]){o!==(o=r(e))&&(i.d(1),i=o(e),i&&(i.c(),i.m(n.parentNode,n)))},i:e,o:e,d(e){i.d(e),e&&w(n)}}}function je(e,t,n){let{spinner:r=""}=t;return e.$$set=e=>{"spinner"in e&&n(0,r=e.spinner)},[r]}class Ie extends xe{constructor(e){super(),ke(this,e,je,qe,a,{spinner:0})}}const $e=e=>({}),Ae=e=>({attemptLoad:e[7]}),Ne=e=>({}),De=e=>({}),Re=e=>({}),We=e=>({}),Qe=e=>({isFirstLoad:2&e}),Me=e=>({isFirstLoad:e[1]});function Le(e){let t,n;const r=e[15].spinner,o=c(r,e,e[14],Me),i=o||function(e){let t,n;return t=new Ie({props:{spinner:e[0]}}),{c(){be(t.$$.fragment)},m(e,r){we(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.spinner=e[0]),t.$set(r)},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){le(t.$$.fragment,e),n=!1},d(e){_e(t,e)}}}(e);return{c(){t=_("div"),i&&i.c(),E(t,"class","infinite-status-prompt")},m(e,r){b(e,t,r),i&&i.m(t,null),n=!0},p(e,t){o?o.p&&16386&t&&f(o,r,e,e[14],t,Qe,Me):i&&i.p&&1&t&&i.p(e,t)},i(e){n||(ce(i,e),n=!0)},o(e){le(i,e),n=!1},d(e){e&&w(t),i&&i.d(e)}}}function Be(e){let t,n;const r=e[15].noResults,o=c(r,e,e[14],We),i=o||function(e){let t;return{c(){t=k("No results :(")},m(e,n){b(e,t,n)},d(e){e&&w(t)}}}();return{c(){t=_("div"),i&&i.c(),E(t,"class","infinite-status-prompt")},m(e,r){b(e,t,r),i&&i.m(t,null),n=!0},p(e,t){o&&o.p&&16384&t&&f(o,r,e,e[14],t,Re,We)},i(e){n||(ce(i,e),n=!0)},o(e){le(i,e),n=!1},d(e){e&&w(t),i&&i.d(e)}}}function Pe(e){let t,n;const r=e[15].noMore,o=c(r,e,e[14],De),i=o||function(e){let t;return{c(){t=k("No more data :)")},m(e,n){b(e,t,n)},d(e){e&&w(t)}}}();return{c(){t=_("div"),i&&i.c(),E(t,"class","infinite-status-prompt")},m(e,r){b(e,t,r),i&&i.m(t,null),n=!0},p(e,t){o&&o.p&&16384&t&&f(o,r,e,e[14],t,Ne,De)},i(e){n||(ce(i,e),n=!0)},o(e){le(i,e),n=!1},d(e){e&&w(t),i&&i.d(e)}}}function Fe(t){let n,r;const o=t[15].error,i=c(o,t,t[14],Ae),s=i||function(t){let n,r,o,i,s,a;return{c(){n=k("Oops, something went wrong :(\n\t\t\t\t"),r=_("br"),o=x(),i=_("button"),i.textContent="Retry",E(i,"class","btn-try-infinite svelte-o3w4bf")},m(e,u){b(e,n,u),b(e,r,u),b(e,o,u),b(e,i,u),s||(a=T(i,"click",t[7]),s=!0)},p:e,d(e){e&&w(n),e&&w(r),e&&w(o),e&&w(i),s=!1,a()}}}(t);return{c(){n=_("div"),s&&s.c(),E(n,"class","infinite-status-prompt")},m(e,t){b(e,n,t),s&&s.m(n,null),r=!0},p(e,t){i&&i.p&&16384&t&&f(i,o,e,e[14],t,$e,Ae)},i(e){r||(ce(s,e),r=!0)},o(e){le(s,e),r=!1},d(e){e&&w(n),s&&s.d(e)}}}function Ve(e){let t,n,r,o,i,s=e[3]&&Le(e),a=e[5]&&Be(e),u=e[6]&&Pe(e),c=e[4]&&Fe(e);return{c(){t=_("div"),s&&s.c(),n=x(),a&&a.c(),r=x(),u&&u.c(),o=x(),c&&c.c(),E(t,"class","infinite-loading-container svelte-o3w4bf")},m(l,f){b(l,t,f),s&&s.m(t,null),v(t,n),a&&a.m(t,null),v(t,r),u&&u.m(t,null),v(t,o),c&&c.m(t,null),e[16](t),i=!0},p(e,[i]){e[3]?s?(s.p(e,i),8&i&&ce(s,1)):(s=Le(e),s.c(),ce(s,1),s.m(t,n)):s&&(ae(),le(s,1,1,(()=>{s=null})),ue()),e[5]?a?(a.p(e,i),32&i&&ce(a,1)):(a=Be(e),a.c(),ce(a,1),a.m(t,r)):a&&(ae(),le(a,1,1,(()=>{a=null})),ue()),e[6]?u?(u.p(e,i),64&i&&ce(u,1)):(u=Pe(e),u.c(),ce(u,1),u.m(t,o)):u&&(ae(),le(u,1,1,(()=>{u=null})),ue()),e[4]?c?(c.p(e,i),16&i&&ce(c,1)):(c=Fe(e),c.c(),ce(c,1),c.m(t,null)):c&&(ae(),le(c,1,1,(()=>{c=null})),ue())},i(e){i||(ce(s),ce(a),ce(u),ce(c),i=!0)},o(e){le(s),le(a),le(u),le(c),i=!1},d(n){n&&w(t),s&&s.d(),a&&a.d(),u&&u.d(),c&&c.d(),e[16](null)}}}const Ue=["executed the callback function more than 10 times for a short time, it looks like searched a wrong scroll wrapper that doest not has fixed height or maximum height, please check it. If you want to force to set a element as scroll wrapper rather than automatic searching, you can do this:","\x3c!-- add a special attribute for the real scroll wrapper (can also be data-infinite-wrapper) --\x3e","<div infinite-wrapper>","  ...","  \x3c!-- set forceUseInfiniteWrapper --\x3e","  <InfiniteLoading forceUseInfiniteWrapper>","</div>","or",'<div class="infinite-wrapper">',"  ...","  \x3c!-- set forceUseInfiniteWrapper as css selector of the real scroll wrapper --\x3e",'  <InfiniteLoading forceUseInfiniteWrapper=".infinite-wrapper" />',"</div>"].join("\n"),Ge=(()=>{let e=!1;try{const t=Object.defineProperty({},"passive",{get:()=>(e={passive:!0},!0)});window.addEventListener("testpassive",t,t),window.remove("testpassive",t,t)}catch(e){}return e})(),Je={timers:[],caches:[],throttle(e){-1===this.caches.indexOf(e)&&(this.caches.push(e),this.timers.push(setTimeout((()=>{e(),this.caches.splice(this.caches.indexOf(e),1),this.timers.shift()}),50)))},reset(){this.timers.forEach((e=>{clearTimeout(e)})),this.timers.length=0,this.caches=[]}},Ke={isChecked:!1,timer:null,times:0,track(){this.times+=1,clearTimeout(this.timer),this.timer=setTimeout((()=>{this.isChecked=!0}),1e3),this.times>10&&(console.error(Ue),this.isChecked=!0)}},ze={key:"_infiniteScrollHeight",getScrollElement:e=>e===window?document.documentElement:e,save(e){const t=this.getScrollElement(e);t[this.key]=t.scrollHeight},restore(e){const t=this.getScrollElement(e);"number"==typeof t[this.key]&&(t.scrollTop=t.scrollHeight-t[this.key]+t.scrollTop),this.remove(t)},remove(e){void 0!==e[this.key]&&delete e[this.key]}};function He(e){return e.offsetWidth+e.offsetHeight>0}function Ye(e,t,n){let r,o,i,s,{$$slots:a={},$$scope:u}=t;const c=B(),l=0,f=1,h=2,d=3;let p,y,{distance:m=100}=t,{spinner:g="default"}=t,{direction:v="bottom"}=t,{forceUseInfiniteWrapper:b=!1}=t,{identifier:w=+new Date}=t,_=!0,k=l,x=!1;const C={loaded:async()=>{n(1,_=!1),"top"===v&&(await H(),ze.restore(y)),k===f&&(await H(),await E(!0))},complete:async()=>{n(12,k=h),await H(),y.removeEventListener("scroll",T,Ge)},reset:async()=>{n(12,k=l),n(1,_=!0),ze.remove(y),y.addEventListener("scroll",T,Ge),setTimeout((()=>{Je.reset(),T()}),1)},error:()=>{n(12,k=d),Je.reset()}};function T(e){k===l&&(e&&e.constructor===Event&&He(p)?Je.throttle(E):E())}async function E(e){k!==h&&He(p)&&function(){let e;if("top"===v)e="number"==typeof y.scrollTop?y.scrollTop:y.pageYOffset;else{e=p.getBoundingClientRect().top-(y===window?window.innerHeight:y.getBoundingClientRect().bottom)}return e}()<=m?(n(12,k=f),"top"===v&&(await H(),ze.save(y)),c("infinite",C),!e||b||Ke.isChecked||Ke.track()):k===f&&n(12,k=l)}function S(e=p){let t;return"string"==typeof b&&(t=document.querySelector(b)),t||("BODY"===e.tagName?t=window:(!b&&["scroll","auto"].indexOf(getComputedStyle(e).overflowY)>-1||e.hasAttribute("infinite-wrapper")||e.hasAttribute("data-infinite-wrapper"))&&(t=e)),t||S(e.parentNode)}function O(){x&&(y=S())}return M((async()=>{n(13,x=!0),setTimeout((()=>{T(),y.addEventListener("scroll",T,Ge)}),1)})),L((()=>{x&&k!==h&&(Je.reset(),ze.remove(y),y.removeEventListener("scroll",T,Ge))})),e.$$set=e=>{"distance"in e&&n(8,m=e.distance),"spinner"in e&&n(0,g=e.spinner),"direction"in e&&n(9,v=e.direction),"forceUseInfiniteWrapper"in e&&n(10,b=e.forceUseInfiniteWrapper),"identifier"in e&&n(11,w=e.identifier),"$$scope"in e&&n(14,u=e.$$scope)},e.$$.update=()=>{4096&e.$$.dirty&&n(3,r=k===f),4096&e.$$.dirty&&n(4,o=k===d),4098&e.$$.dirty&&n(5,i=k===h&&_),4098&e.$$.dirty&&n(6,s=k===h&&!_),9216&e.$$.dirty&&O(),10240&e.$$.dirty&&x&&C.reset()},[g,_,p,r,o,i,s,E,m,v,b,w,k,x,u,a,function(e){V[e?"unshift":"push"]((()=>{p=e,n(2,p)}))}]}class Xe extends xe{constructor(e){super(),ke(this,e,Ye,Ve,a,{distance:8,spinner:0,direction:9,forceUseInfiniteWrapper:10,identifier:11})}}function Ze(e){return("0"+e.toString(16)).substr(-2)}function et(){const e=new Uint32Array(28);return window.crypto.getRandomValues(e),Array.from(e,Ze).join("")}async function tt(e){const t=await function(e){const t=(new TextEncoder).encode(e);return window.crypto.subtle.digest("SHA-256",t)}(e);var n;return n=t,btoa(String.fromCharCode.apply(null,new Uint8Array(n))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const nt="0a004f36100a460ca97d2d99f485af2f",rt="https://sebastian-stubenvoll.github.io/spotify-collab-tracker";let ot,it,st,at;async function ut(){const e="client_id="+nt,t="redirect_uri="+encodeURIComponent(rt),n=et();localStorage.setItem("state",n);const r="state="+n,o="scope="+encodeURIComponent("playlist-read-private playlist-read-collaborative");return"https://accounts.spotify.com/authorize?"+[e,"response_type=code",t,await async function(e){return"code_challenge="+await tt(e)}(function(){const e=et();return localStorage.setItem("verifier",e),e}()),"code_challenge_method=S256",r,o].join("&")}const ct=async function(){clearInterval(at),console.log("Refreshing access token...");let e=[];const t={grant_type:"refresh_token",refresh_token:it,client_id:nt};for(let n in t){const r=encodeURIComponent(n),o=encodeURIComponent(t[n]);e.push(r+"="+o)}e=e.join("&");const n=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e}),r=await n.json();ot=r.access_token,it=r.refresh_token,st=1e3*r.expires_in,at=setInterval(ct,st-.1*st)};function lt(e){return{Authorization:"Bearer "+e}}async function ft(e,t){const n="https://api.spotify.com/v1/users/"+t,r=await fetch(n,{method:"GET",headers:lt(e)}),o=await r.json();return[o.display_name,o.images]}function ht(e){var t={exports:{}};return e(t,t.exports),t.exports
/*!
     * @license :jsstore - V4.2.6 - 21/06/2021
     * https://github.com/ujjwalguptaofficial/JsStore
     * Copyright (c) 2021 @Ujjwal Gupta; Licensed MIT
     */}var dt=ht((function(e){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}({2:function(e,t,n){n.r(t),n.d(t,"Connection",(function(){return w})),n.d(t,"ERROR_TYPE",(function(){return r})),n.d(t,"WORKER_STATUS",(function(){return o})),n.d(t,"DATA_TYPE",(function(){return i})),n.d(t,"API",(function(){return s})),n.d(t,"EVENT",(function(){return a})),n.d(t,"QUERY_OPTION",(function(){return u})),n.d(t,"IDB_MODE",(function(){return c})),n.d(t,"OCCURENCE",(function(){return l})),n.d(t,"CONNECTION_STATUS",(function(){return f})),n.d(t,"promise",(function(){return p})),n.d(t,"promiseAll",(function(){return _})),n.d(t,"promiseResolve",(function(){return y})),n.d(t,"forObj",(function(){return k}));var r,o,i,s,a,u,c,l,f,h=function(){function e(e,t){this.type=e,this._info=t,this.message=this.getMsg()}return e.prototype.throw=function(){throw this.get()},e.prototype.log=function(e){this.status&&console.log(e)},e.prototype.logError=function(){console.error(this.get())},e.prototype.logWarning=function(){console.warn(this.get())},e.prototype.get=function(){return{message:this.message,type:this.type}},e.prototype.getMsg=function(){return this.type,this.message},e}();!function(e){e.UndefinedColumn="undefined_column",e.UndefinedValue="undefined_value",e.UndefinedColumnName="undefined_column_name",e.UndefinedDbName="undefined_database_name",e.UndefinedColumnValue="undefined_column_value",e.NotArray="not_array",e.NoValueSupplied="no_value_supplied",e.ColumnNotExist="column_not_exist",e.EnableSearchOff="enable_search_off",e.InvalidOp="invalid_operator",e.NullValue="null_value",e.WrongDataType="wrong_data_type",e.TableNotExist="table_not_exist",e.DbNotExist="db_not_exist",e.ConnectionAborted="connection_aborted",e.ConnectionClosed="connection_closed",e.NotObject="not_object",e.InvalidConfig="invalid_config",e.DbBlocked="Db_blocked",e.IndexedDbNotSupported="indexeddb_not_supported",e.NullValueInWhere="null_value_in_where",e.InvalidJoinQuery="invalid_join_query",e.InvalidOrderQuery="invalid_order_query",e.InvalidQuery="invalid_query",e.InvalidGroupQuery="invalid_group_query",e.ImportScriptsFailed="import_scripts_failed",e.MethodNotExist="method_not_exist",e.Unknown="unknown",e.InvalidMiddleware="invalid_middleware"}(r||(r={})),function(e){e.Registered="registerd",e.Failed="failed",e.NotStarted="not_started"}(o||(o={})),function(e){e.String="string",e.Object="object",e.Array="array",e.Number="number",e.Boolean="boolean",e.Null="null",e.DateTime="date_time"}(i||(i={})),function(e){e.InitDb="init_db",e.Get="get",e.Set="set",e.Select="select",e.Insert="insert",e.Update="update",e.Remove="remove",e.OpenDb="open_db",e.Clear="clear",e.DropDb="drop_db",e.Count="count",e.ChangeLogStatus="change_log_status",e.Terminate="terminate",e.Transaction="transaction",e.CloseDb="close_db",e.Union="union",e.Intersect="intersect",e.ImportScripts="import_scripts",e.Middleware="middleware"}(s||(s={})),function(e){e.RequestQueueEmpty="requestQueueEmpty",e.RequestQueueFilled="requestQueueFilled",e.Upgrade="upgrade",e.Create="create",e.Open="open"}(a||(a={})),function(e){e.Where="where",e.Like="like",e.Regex="regex",e.In="in",e.Equal="=",e.Between="-",e.GreaterThan=">",e.LessThan="<",e.GreaterThanEqualTo=">=",e.LessThanEqualTo="<=",e.NotEqualTo="!=",e.Aggregate="aggregate",e.Max="max",e.Min="min",e.Avg="avg",e.Count="count",e.Sum="sum",e.Or="or",e.Skip="skip",e.Limit="limit",e.And="and",e.IgnoreCase="ignoreCase",e.Then="then"}(u||(u={})),function(e){e.ReadOnly="readonly",e.ReadWrite="readwrite"}(c||(c={})),function(e){e.First="f",e.Last="l",e.Any="a"}(l||(l={})),function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_started",e.UnableToStart="unable_to_start",e.ClosedByJsStore="closed_by_jsstore"}(f||(f={}));var d,p=function(e){return new Promise(e)},y=function(e){return Promise.resolve(e)},m=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},g=function(){function e(e){this._events={},this._ctx=e}return e.prototype.on=function(e,t){return null==this._events[e]&&(this._events[e]=[]),this._events[e].push(t),this},e.prototype.off=function(e,t){if(this._events[e])if(t){var n=this._events[e].indexOf(t);this._events[e].splice(n,1)}else this._events[e]=[]},e.prototype.emit=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=this._events[e]||[],i=0,s=o.length,a=[],u=function(){var e=o[i++];if(e){var r=e.call.apply(e,m([t._ctx],n));return r&&r.then?r:Promise.resolve(r)}};return new Promise((function(e){var t=function(){i<s?u().then((function(e){a.push(e),t()})):e(a)};t()}))},e.prototype.destroy=function(){this._events=null,this._ctx=null},e}(),v=function(){function e(e){this.isConOpened_=!1,this.isDbIdle_=!0,this.requestQueue_=[],this.isCodeExecuting_=!1,this.inactivityTimer_=-1e3,this.middlewares=[],this.eventBus_=new g(this),this.whiteListApi_=[s.InitDb,s.OpenDb,s.Get,s.Set,s.ChangeLogStatus,s.Terminate,s.DropDb],this.isRuningInWorker=!0,this.logger=new h(null),e?(this.worker_=e,this.worker_.onmessage=this.onMessageFromWorker_.bind(this)):(this.isRuningInWorker=!1,this.initQueryManager_())}return Object.defineProperty(e.prototype,"jsstoreWorker",{get:function(){return this.$worker||self.JsStoreWorker},enumerable:!1,configurable:!0}),e.prototype.initQueryManager_=function(){var e=this.jsstoreWorker;e&&(this.queryManager=new e.QueryManager(this.processFinishedQuery_.bind(this)))},e.prototype.onMessageFromWorker_=function(e){this.processFinishedQuery_(e.data)},e.prototype.processFinishedQuery_=function(e){var t=this.requestQueue_.shift();if(t){if(this.logger.log("request "+t.name+" finished"),e.error)t.onError(e.error);else{switch(t.name){case s.OpenDb:case s.InitDb:this.isConOpened_=!0;break;case s.Terminate:this.isConOpened_=!1,!0===this.isRuningInWorker&&this.worker_.terminate();case s.DropDb:this.isConOpened_=!1,this.requestQueue_=[],this.isDbIdle_=!0;break;case s.CloseDb:this.requestQueue_.length>0?this.openDb_():(this.isDbIdle_=!0,this.eventBus_.emit(a.RequestQueueEmpty,[]))}t.onSuccess(e.result)}this.isCodeExecuting_=!1,this.executeQry_()}},e.prototype.openDb_=function(){this.prcoessExecutionOfQry_({name:s.OpenDb,query:{name:this.database.name,version:this.database.version},onSuccess:function(){},onError:function(e){console.error(e)}},0)},e.prototype.executeMiddleware_=function(e){var t=this;return p((function(n){var r=0,o=t.middlewares.length-1,i=function(){if(r<=o){var s=t.middlewares[r++](e);s&&s.then||(s=y(s)),s.then((function(e){i()}))}else n()};i()}))},e.prototype.callResultMiddleware=function(e,t){return p((function(n){var r=0,o=e.length-1,i=function(){if(r<=o){var s=e[r++](t);s.then||(s=y(s)),s.then((function(e){t=e,i()}))}else n(t)};i()}))},e.prototype.pushApi=function(e){var t=this;return new Promise((function(n,r){var o=[];e.onResult=function(e){o.push((function(t){return e(t)}))},t.executeMiddleware_(e).then((function(){(e.onSuccess=function(r){t.callResultMiddleware(o,r).then((function(e){n(e)})).catch((function(t){e.onError(t)}))},e.onError=function(e){o=[],r(e)},0===t.requestQueue_.length)&&(t.eventBus_.emit(a.RequestQueueFilled,[]),!([s.CloseDb,s.DropDb,s.OpenDb,s.Terminate].indexOf(e.name)>=0)&&t.isDbIdle_&&t.isConOpened_?t.openDb_():clearTimeout(t.inactivityTimer_));t.prcoessExecutionOfQry_(e)})).catch(r)}))},e.prototype.prcoessExecutionOfQry_=function(e,t){this.isDbIdle_=!1,null!=t?this.requestQueue_.splice(t,0,e):this.requestQueue_.push(e),this.logger.log("request pushed: "+e.name),this.executeQry_()},e.prototype.executeQry_=function(){var e=this,t=this.requestQueue_.length;if(!this.isCodeExecuting_&&t>0){if(!0===this.isConOpened_)return void this.sendRequestToWorker_(this.requestQueue_[0]);var n=this.requestQueue_.findIndex((function(t){return e.whiteListApi_.indexOf(t.name)>=0}));n>=0&&(this.requestQueue_.splice(0,0,this.requestQueue_.splice(n,1)[0]),this.sendRequestToWorker_(this.requestQueue_[0]))}else 0===t&&!1===this.isDbIdle_&&this.isConOpened_&&(this.inactivityTimer_=setTimeout((function(){e.prcoessExecutionOfQry_({name:s.CloseDb,onSuccess:function(){},onError:function(e){console.error(e)}})}),100))},e.prototype.sendRequestToWorker_=function(e){this.isCodeExecuting_=!0,this.logger.log("request executing: "+e.name);var t={name:e.name,query:e.query};!0===this.isRuningInWorker?this.worker_.postMessage(t):this.queryManager.run(t)},e}(),b=(d=function(e,t){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),w=function(e){function t(t){return e.call(this,t)||this}return b(t,e),t.prototype.initDb=function(e){var t=this;return this.database=e,this.pushApi({name:s.InitDb,query:e}).then((function(e){var n,r=e.database;return e.isCreated&&(n=e.oldVersion?t.eventBus_.emit(a.Upgrade,r,e.oldVersion,e.newVersion):t.eventBus_.emit(a.Create,r)),(n||y()).then((function(e){return t.eventBus_.emit(a.Open,r)})).then((function(t){return e.isCreated}))}))},t.prototype.dropDb=function(){return this.pushApi({name:s.DropDb})},t.prototype.select=function(e){return this.pushApi({name:s.Select,query:e})},t.prototype.count=function(e){return this.pushApi({name:s.Count,query:e})},t.prototype.insert=function(e){return this.pushApi({name:s.Insert,query:e})},t.prototype.update=function(e){return this.pushApi({name:s.Update,query:e})},t.prototype.remove=function(e){return this.pushApi({name:s.Remove,query:e})},t.prototype.clear=function(e){return this.pushApi({name:s.Clear,query:e})},Object.defineProperty(t.prototype,"logStatus",{set:function(e){this.logger.status=e,this.pushApi({name:s.ChangeLogStatus,query:e})},enumerable:!1,configurable:!0}),t.prototype.openDb=function(e,t){var n=this;return this.pushApi({name:s.OpenDb,query:{version:t,name:e}}).then((function(e){return n.database=e,e}))},t.prototype.getDbList=function(){return console.warn("Api getDbList is recommended to use for debugging only. Do not use in code."),indexedDB.databases()},t.prototype.get=function(e){return this.pushApi({name:s.Get,query:e})},t.prototype.set=function(e,t){return this.pushApi({name:s.Set,query:{key:e,value:t}})},t.prototype.terminate=function(){return this.pushApi({name:s.Terminate})},t.prototype.transaction=function(e){return this.pushApi({name:s.Transaction,query:e})},t.prototype.on=function(e,t){this.eventBus_.on(e,t)},t.prototype.off=function(e,t){this.eventBus_.off(e,t)},t.prototype.union=function(e){return this.pushApi({name:s.Union,query:e})},t.prototype.intersect=function(e){return this.pushApi({name:s.Intersect,query:e})},t.prototype.addPlugin=function(e,t){return e.setup(this,t)},t.prototype.addMiddleware=function(e,t){return t?this.pushApi({name:s.Middleware,query:e}):(this.middlewares.push(e),Promise.resolve())},t.prototype.importScripts=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.pushApi({name:s.ImportScripts,query:e})},t}(v),_=function(e){return Promise.all(e)},k=function(e,t){for(var n in e)t(n,e[n])}}})})),pt=ht((function(e){e.exports=dt})),yt=ht((function(e){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}({2:function(e,t,n){n.r(t),n.d(t,"QueryManager",(function(){return Je}));var r,o,i,s,a,u,c,l,f,h=function(e){return Promise.resolve(e)},d=function(e){return new Promise(e)};!function(e){e.UndefinedColumn="undefined_column",e.UndefinedValue="undefined_value",e.UndefinedColumnName="undefined_column_name",e.UndefinedDbName="undefined_database_name",e.UndefinedColumnValue="undefined_column_value",e.NotArray="not_array",e.NoValueSupplied="no_value_supplied",e.ColumnNotExist="column_not_exist",e.EnableSearchOff="enable_search_off",e.InvalidOp="invalid_operator",e.NullValue="null_value",e.WrongDataType="wrong_data_type",e.TableNotExist="table_not_exist",e.DbNotExist="db_not_exist",e.ConnectionAborted="connection_aborted",e.ConnectionClosed="connection_closed",e.NotObject="not_object",e.InvalidConfig="invalid_config",e.DbBlocked="Db_blocked",e.IndexedDbNotSupported="indexeddb_not_supported",e.NullValueInWhere="null_value_in_where",e.InvalidJoinQuery="invalid_join_query",e.InvalidOrderQuery="invalid_order_query",e.InvalidQuery="invalid_query",e.InvalidGroupQuery="invalid_group_query",e.ImportScriptsFailed="import_scripts_failed",e.MethodNotExist="method_not_exist",e.Unknown="unknown",e.InvalidMiddleware="invalid_middleware"}(r||(r={})),function(e){e.Registered="registerd",e.Failed="failed",e.NotStarted="not_started"}(o||(o={})),function(e){e.String="string",e.Object="object",e.Array="array",e.Number="number",e.Boolean="boolean",e.Null="null",e.DateTime="date_time"}(i||(i={})),function(e){e.InitDb="init_db",e.Get="get",e.Set="set",e.Select="select",e.Insert="insert",e.Update="update",e.Remove="remove",e.OpenDb="open_db",e.Clear="clear",e.DropDb="drop_db",e.Count="count",e.ChangeLogStatus="change_log_status",e.Terminate="terminate",e.Transaction="transaction",e.CloseDb="close_db",e.Union="union",e.Intersect="intersect",e.ImportScripts="import_scripts",e.Middleware="middleware"}(s||(s={})),function(e){e.RequestQueueEmpty="requestQueueEmpty",e.RequestQueueFilled="requestQueueFilled",e.Upgrade="upgrade",e.Create="create",e.Open="open"}(a||(a={})),function(e){e.Where="where",e.Like="like",e.Regex="regex",e.In="in",e.Equal="=",e.Between="-",e.GreaterThan=">",e.LessThan="<",e.GreaterThanEqualTo=">=",e.LessThanEqualTo="<=",e.NotEqualTo="!=",e.Aggregate="aggregate",e.Max="max",e.Min="min",e.Avg="avg",e.Count="count",e.Sum="sum",e.Or="or",e.Skip="skip",e.Limit="limit",e.And="and",e.IgnoreCase="ignoreCase",e.Then="then"}(u||(u={})),function(e){e.ReadOnly="readonly",e.ReadWrite="readwrite"}(c||(c={})),function(e){e.First="f",e.Last="l",e.Any="a"}(l||(l={})),function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_started",e.UnableToStart="unable_to_start",e.ClosedByJsStore="closed_by_jsstore"}(f||(f={}));var p,y=function(){function e(e){this.columns=[],this.autoIncColumnValue={},this.columns=this.setColumn(e.columns),this.name=e.name,this.alter=e.alter||{}}return e.prototype.setColumn=function(e){var t=[],n=function(n){var o=e[n];o.name=n,o.autoIncrement&&(r.autoIncColumnValue[n]=0),o.primaryKey&&(r.primaryKey=n),o.enableSearch=null==o.enableSearch||o.enableSearch;var i=r.columns.indexOf((function(e){return e.name===n}));if(i<0)t.push(o);else{var s=r.columns[i];Object.assign(s,o)}},r=this;for(var o in e)n(o);return t},e}(),m=function(){function e(){}return e.autoIncrementKey=function(e,t){return"JsStore_"+e+"_"+t+"_Value"},e.set=function(t,n,r){r.tx||r.createTransaction([e.tableName]);var o=r.objectStore(e.tableName);return d((function(e,r){var i=o.put({key:t,value:n});i.onsuccess=function(){e()},i.onerror=r}))},e.get=function(t,n){n.tx||n.createTransaction([e.tableName]);var r=n.objectStore(e.tableName);return d((function(e,o){var i=r.get(n.keyRange(t));i.onsuccess=function(){var t=i.result;e(t&&t.value)},i.onerror=o}))},e.remove=function(t,n){n.tx||n.createTransaction([e.tableName]);var r=n.objectStore(e.tableName);return d((function(e,o){var i=r.delete(n.keyRange(t));i.onsuccess=e,i.onerror=o}))},e.tableName="JsStore_Meta",e.dbSchema="JsStore_DbSchema",e}(),g=function(e){this.name=e.name,this.version=e.version||1,e.tables.push({name:m.tableName,columns:{key:{primaryKey:!0},value:{enableSearch:!1}}}),this.tables=e.tables.map((function(e){return new y(e)}))},v=function(e,t){for(var n in e)t(n,e[n])},b=function(){function e(e,t){this.type=e,this.info_=t,this.message=this.getMsg_()}return e.prototype.log=function(e){this.status&&console.log(e)},e.prototype.throw=function(){throw this.get()},e.prototype.logError=function(){console.error(this.get())},e.prototype.get=function(){return{message:this.message,type:this.type}},e.prototype.getMsg_=function(){var e;switch(this.type){case r.NotArray:e="Supplied value is not an array";break;case r.UndefinedColumn:e="Column is undefined in Where";break;case r.UndefinedValue:e="Value is undefined in Where";break;case r.UndefinedColumnName:e="Column name is undefined '"+this.info_.TableName+"'";break;case r.UndefinedDbName:e="Database name is not supplied";break;case r.UndefinedColumnValue:e="Column value is undefined";break;case r.NoValueSupplied:e="No value is supplied";break;case r.InvalidOp:e="Invalid Op Value '"+this.info_.Op+"'";break;case r.ColumnNotExist:e=this.info_.isOrder?"Column '"+this.info_.column+"' in order query does not exist":"Column '"+this.info_.column+"' does not exist";break;case r.EnableSearchOff:e="Search is turned off for the Column '"+this.info_.column+"'";break;case r.NullValue:e="Null value is not allowed for column '"+this.info_.ColumnName+"'";break;case r.WrongDataType:e="Supplied value for column '"+this.info_.column+"' have wrong data type";break;case r.TableNotExist:e="Table '"+this.info_.tableName+"' does not exist";break;case r.DbNotExist:e="Database with name "+this.info_.dbName+" does not exist";break;case r.NotObject:e="supplied value is not object";break;case r.InvalidOp:e="Invalid Config '"+this.info_.Config+" '";break;case r.DbBlocked:e="database is blocked, cant be deleted right now";break;case r.NullValueInWhere:e="Null/undefined is not allowed in where. Column '"+this.info_.column+"' has null";break;case r.MethodNotExist:e="method "+this.info_+" does not exist.";break;case r.IndexedDbNotSupported:e="Browser does not support indexeddb";break;case r.InvalidJoinQuery:case r.InvalidGroupQuery:case r.InvalidOrderQuery:case r.ImportScriptsFailed:e=this.info_;break;case r.InvalidMiddleware:e="No function "+this.info_+" is found.";break;default:this.type||(this.type=r.Unknown),e=this.message}return e},e}(),w=function(){function e(){this.logger=new b(null)}return e.prototype.emptyTx=function(){this.tx&&(this.tx.oncomplete=null,this.tx.onabort=null,this.tx.onerror=null,this.tx=null)},e.prototype.createTransactionIfNotExist=function(e,t){this.tx||this.createTransaction(e,t)},e.prototype.createTransaction=function(e,t){var n=this;return void 0===t&&(t=c.ReadWrite),this.tx=this.con.transaction(e,t),d((function(e,t){n.tx.oncomplete=e,n.tx.onabort=e,n.tx.onerror=t}))},e.prototype.keyRange=function(e,t){var n;switch(t){case u.Between:n=IDBKeyRange.bound(e.low,e.high,!1,!1);break;case u.GreaterThan:n=IDBKeyRange.lowerBound(e,!0);break;case u.GreaterThanEqualTo:n=IDBKeyRange.lowerBound(e);break;case u.LessThan:n=IDBKeyRange.upperBound(e,!0);break;case u.LessThanEqualTo:n=IDBKeyRange.upperBound(e);break;default:n=IDBKeyRange.only(e)}return n},e.prototype.objectStore=function(e){return this.tx.objectStore(e)},e.prototype.abortTransaction=function(){this.tx&&this.tx.abort()},e.prototype.close=function(){var e=this;return this.con&&this.con.close(),d((function(t){e.con=null,setTimeout(t,100)}))},e.prototype.initDb=function(e){var t=this;this.db=e;var n,r=!1,o=e.version;return d((function(i,s){var a=indexedDB.open(e.name,o);a.onsuccess=function(){t.con=a.result,t.con.onversionchange=function(e){e.target.close()},i({isCreated:r,oldVersion:n,newVersion:o})},a.onerror=function(e){console.error("error",e),s(e)},a.onupgradeneeded=function(t){n=t.oldVersion;var i=t.target,s=i.result;r=!0;var a=i.transaction,u=s.objectStoreNames,c=function(e,t){if(t.enableSearch){var n=t.name,r=t.primaryKey?{unique:!0}:{unique:t.unique};r.multiEntry=t.multiEntry;var o=null==t.keyPath?n:t.keyPath;e.createIndex(n,o,r)}},l=function(e,t,n){var r=t.columns.findIndex((function(e){return e.name===n}));r>=0&&(t.columns.splice(r,1),e.deleteIndex(n))};e.tables.forEach((function(e){if(!u.contains(e.name))return function(e){var t=e.primaryKey?{keyPath:e.primaryKey}:{autoIncrement:!0},n=s.createObjectStore(e.name,t);e.columns.forEach((function(e){c(n,e)}))}(e);for(var t=a.objectStore(e.name),r=n;r<=o;r++){var i=e.alter[r];if(i){if(i.add)e.setColumn(i.add).forEach((function(n){c(t,n),e.columns.push(n)}));v(i.drop||{},(function(n){l(t,e,n)})),v(i.modify||{},(function(n,r){var o=r.multiEntry||r.keyPath||r.unique,i=e.columns.find((function(e){return e.name===n})),s=Object.assign(i,r);s.name=n,o&&(l(t,e,n),c(t,s),e.columns.push(s))}))}}}))}}))},e}(),_=function(e){return Promise.all(e)},k=function(e){return Promise.reject(e)},x=function(e){if(e instanceof b)return e.logError(),e.get();var t=void 0;return e.name?(t=new b(e.name)).message=e.message:(t=new b(e.target.error.name)).message=e.target.error.message,t.logError(),t.get()},C=function(){function e(){this.rowAffected=0,this.isTxQuery=!1,this.results=[]}return e.prototype.table=function(e){var t=e||this.tableName;return this.db.tables.find((function(e){return e.name===t}))},e.prototype.primaryKey=function(e){return this.table(e).primaryKey},e.prototype.getColumnInfo=function(e,t){return this.table(t).columns.find((function(t){return t.name===e}))},e.prototype.onException=function(e,t){return console.error(e),this.util.abortTransaction(),k(function(e,t){return void 0===t&&(t=r.InvalidQuery),e.name=t,x(e)}(e,t))},e}(),T=function(e){if(null==e)return i.Null;var t=typeof e;switch(t){case"object":if(Array.isArray(e))return i.Array;if(e instanceof Date)return i.DateTime}return t},E=function(e){if(null==e)return!0;switch(typeof e){case"string":return 0===e.length;case"number":return isNaN(e)}return!1},S=function(){function e(e,t){this.table=e,this.autoIncrementValue=t}return e.prototype.checkAndModifyValues=function(e){var t,n=this;this.query=e;var r=e.values,o=[];return r.every((function(r,i){return t=n.checkAndModifyValue(r),e.ignore&&t&&(o.push(i),t=null),!t})),o.forEach((function(e){r.splice(e,1)})),{err:t,values:r}},e.prototype.checkAndModifyValue=function(e){var t,n=this;return this.table.columns.every((function(r){return!(t=n.checkAndModifyColumnValue_(r,e))})),t},e.prototype.checkNotNullAndDataType_=function(e,t){return e.notNull&&E(t[e.name])?this.getError(r.NullValue,{ColumnName:e.name}):e.dataType&&!E(t[e.name])&&T(t[e.name])!==e.dataType?this.getError(r.WrongDataType,{column:e.name}):void 0},e.prototype.checkAndModifyColumnValue_=function(e,t){var n=t[e.name];if(e.autoIncrement?E(n)?t[e.name]=++this.autoIncrementValue[e.name]:T(n)===i.Number&&n>this.autoIncrementValue[e.name]&&(this.autoIncrementValue[e.name]=n):void 0!==e.default&&E(n)&&(t[e.name]=e.default),this.query.validation)return this.checkNotNullAndDataType_(e,t)},e.prototype.getError=function(e,t){return new b(e,t)},e}(),O=function(){function e(e){this.table=e}return e.prototype.check=function(e,t){var n,o=this;return typeof e===i.Object?this.table?this.table.columns.every((function(t){return t.name in e&&(n=o.checkByColumn_(t,e[t.name])),!n})):n=new b(r.TableNotExist,{tableName:t}):n=new b(r.NotObject),n},e.prototype.checkByColumn_=function(e,t){if(!0===e.notNull&&E(t))return new b(r.NullValue,{ColumnName:e.name});var n=T(t),o=null!=t;if(e.dataType&&o&&n!==e.dataType&&"object"!==n)return new b(r.WrongDataType,{column:e.name});if(o&&"object"===n){var i=["+","-","*","/","{push}"];for(var s in t)if(i.indexOf(s)<0&&e.dataType&&n!==e.dataType)return new b(r.WrongDataType,{column:e.name})}},e}(),q=function(){function e(e){this.db=e}return e.prototype.validate=function(e,t){switch(e){case s.Select:case s.Remove:case s.Count:return this.checkSelect(t);case s.Insert:return this.checkInsertQuery(t);case s.Update:return this.checkUpdate(t)}},e.prototype.getTable_=function(e){return this.db.tables.find((function(t){return t.name===e}))},e.prototype.isInsertQryValid=function(e){var t,n=this.getTable_(e.into);if(n)switch(T(e.values)){case i.Array:break;case i.Null:t=new b(r.NoValueSupplied);break;default:t=new b(r.NotArray)}else t=new b(r.TableNotExist,{tableName:e.into});return{table:n,log:t}},e.prototype.checkUpdate=function(e){var t=new O(this.getTable_(e.in)).check(e.set,e.in);if(t)return t;if(null!=e.where){if(t=this.checkForNullInWhere_(e))return t;this.addGreatAndLessToNotOp_(e)}},e.prototype.checkSelect=function(e){if(!this.getTable_(e.from))return new b(r.TableNotExist,{tableName:e.from});if(e.where){var t=this.checkForNullInWhere_(e);if(t)return t;this.addGreatAndLessToNotOp_(e)}},e.prototype.checkForNullInWhere_=function(e){for(var t in e.where)if(null==e.where[t])return new b(r.NullValueInWhere,{column:t})},e.prototype.addGreatAndLessToNotOp_=function(e){var t=e.where,n=function(e,t){return t.findIndex((function(t){return null!=e[t][u.NotEqualTo]}))>=0},r=function(e,t){var n;return t.forEach((function(t){null!=(n=e[t])[u.NotEqualTo]&&(e[t][u.GreaterThan]=n[u.NotEqualTo],void 0===e[u.Or]?(e[u.Or]={},e[u.Or][t]={}):void 0===e[u.Or][t]&&(e[u.Or][t]={}),e[u.Or][t][u.LessThan]=n[u.NotEqualTo],delete e[t][u.NotEqualTo])})),e};switch(T(t)){case i.Object:var o=Object.keys(t);if(n(t,o))if(1===o.length)e.where=r(t,o);else{var s=[];o.forEach((function(e){var n;s.push(r(((n={})[e]=t[e],n),[e]))})),e.where=s}break;default:var a=[];t.forEach((function(e){var t=Object.keys(e);n(e,t)&&(e=r(e,t)),a.push(e)})),e.where=a}},e.prototype.checkInsertQuery=function(e){var t=this.isInsertQryValid(e),n=t.table,r=t.log;if(r)return r;if(!e.skipDataCheck){var o=new S(n,n.autoIncColumnValue).checkAndModifyValues(e),i=o.values,s=o.err;return e.values=i,s}},e}(),j=(p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),I=function(e){function t(t,n){var r=e.call(this)||this;return r.valuesAffected_=[],null==t.validation&&(t.validation=!0),r.query=t,r.util=n,r.tableName=t.into,r}return j(t,e),t.prototype.execute=function(e){var t=this,n=new q(e).validate(s.Insert,this.query);return n?k(n):this.insertData_(e).then((function(e){return t.query.return?t.valuesAffected_:t.rowAffected})).catch((function(e){return t.util.abortTransaction(),k(e)}))},t.prototype.insertData_=function(e){var t,n,r,o=this,i=this.query;return t=i.return?function(e){o.valuesAffected_.push(e)}:function(e){++o.rowAffected},r=i.upsert?"put":"add",n=i.ignore&&!o.isTxQuery?function(e){return o.util.con.transaction(i.into,c.ReadWrite).objectStore(i.into)[r](e)}:(o.isTxQuery||o.util.createTransaction([i.into,m.tableName]),o.objectStore=o.util.objectStore(o.tableName),function(e){return o.objectStore[r](e)}),_(i.values.map((function(e){return d((function(r,o){var s=n(e);s.onerror=function(e){i.ignore?r():o(e)},s.onsuccess=function(){t(e),r()}}))}))).then((function(){m.set(m.dbSchema,e,o.util)}))},t}(C),$=void 0===self.alert&&"undefined"==typeof ServiceWorkerGlobalScope,A=function(){try{if(indexedDB||(indexedDB=self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB),!indexedDB)return!1;IDBTransaction=IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange}catch(e){return!1}return!0}(),N=function(e){return Object.keys(e)},D=function(e){return Array.isArray(e)},R=function(e){return N(e).length},W=function(e){for(var t in e)return t},Q=function(){function e(){}return e.prototype.setCaseAndValue=function(e,t){this.caseQuery_=e,this.setValue(t)},e.prototype.setCaseAndColumn=function(e,t){return this.caseQuery_=e,this.setColumn(t),this},e.prototype.setColumn=function(e){return this.columnName_=e,this.caseColumnQuery_=this.caseQuery_[this.columnName_],this.length_=this.caseColumnQuery_.length,this},e.prototype.setValue=function(e){return this.value=e,this},e.prototype.evaluate=function(){for(var e=0;e<this.length_;e++)if(!0===this.checkCase_(this.caseColumnQuery_[e]))return this.caseColumnQuery_[e].then;var t=this.caseColumnQuery_[this.length_-1].then;return null==t?this.value[this.columnName_]:t},e.prototype.checkCase_=function(e){var t;for(t in e){switch(t){case u.GreaterThan:if(this.value[this.columnName_]>e[t])return!0;break;case u.Equal:if(this.value[this.columnName_]===e[t])return!0;break;case u.LessThan:if(this.value[this.columnName_]<e[t])return!0;break;case u.GreaterThanEqualTo:if(this.value[this.columnName_]>=e[t])return!0;break;case u.LessThanEqualTo:if(this.value[this.columnName_]<=e[t])return!0;break;case u.NotEqualTo:if(this.value[this.columnName_]!==e[t])return!0;break;case u.Between:if(this.value[this.columnName_]>e[t].low&&this.value[this.columnName_]<e[t].high)return!0}return!1}},e}(),M=function(e){var t,n=this,r=!1;return function(o){(t=o.target.result)?r&&n.results.length!==n.limitRecord?(n.pushResult(t.value),t.continue()):(r=!0,t.advance(n.skipRecord)):e()}},L=function(e){var t,n=this,r=!1;return function(o){(t=o.target.result)?r?(n.pushResult(t.value),t.continue()):(r=!0,t.advance(n.skipRecord)):e()}},B=function(e){var t,n=this;return function(r){(t=r.target.result)?(n.pushResult(t.value),t.continue()):e()}},P=function(e){var t,n=this;return function(r){(t=r.target.result)&&n.results.length!==n.limitRecord?(n.pushResult(t.value),t.continue()):e()}},F=function(e){return e.replace(/\s/g,"")},V=function(e){var t;if(null==this.query.join)t=this.getColumnInfo(e);else{var n=F(e).split(".");e=n[1],t=this.getColumnInfo(e,n[0])}if(null==t){var o=this.results[0][e];if(o)return{dataType:T(o),name:e};throw new b(r.ColumnNotExist,{column:e,isOrder:!0})}return t},U=function(e,t){return t.localeCompare(e)},G=function(e,t){return e.localeCompare(t)},J=function(e,t){return new String(t).localeCompare(e)},K=function(e,t){return new String(e).localeCompare(t)},z=function(e,t){return t-e},H=function(e,t){return e-t},Y=function(e,t){return t.getTime()-e.getTime()},X=function(e,t){return e.getTime()-t.getTime()},Z=function(e,t,n){for(var r in n){this.thenEvaluator.setCaseAndValue(n,e);var o=this.thenEvaluator.setColumn(r).evaluate();this.thenEvaluator.setCaseAndValue(n,t);var s=this.thenEvaluator.setColumn(r).evaluate();switch(typeof e[o]){case i.String:return U(e[o],t[s]);default:return z(e[o],t[s])}}},ee=function(e,t,n){for(var r in n){this.thenEvaluator.setCaseAndValue(n,e);var o=this.thenEvaluator.setColumn(r).evaluate();this.thenEvaluator.setCaseAndValue(n,t);var s=this.thenEvaluator.setColumn(r).evaluate();switch(typeof e[o]){case i.String:return G(e[o],t[s]);default:return H(e[o],t[s])}}},te=function(e,t){switch(e.dataType){case i.String:return"asc"===t.type?G:U;case i.Number:return"asc"===t.type?H:z;case i.DateTime:return"asc"===t.type?X:Y;default:return"asc"===t.type?K:J}},ne=function(e){var t,n=this;e.type=re(e.type);var r=e.by;if(null!=r&&typeof r===i.Object)"asc"===e.type?this.results.sort((function(e,t){return ee.call(n,e,t,r)})):this.results.sort((function(e,t){return Z.call(n,e,t,r)}));else{var o=V.call(this,r);if(null!=o){var s=te(o,e);r=o.name,null==e.case?this.results.sort((function(e,t){return s(e[r],t[r])})):(this.thenEvaluator.setCaseAndColumn(((t={})[r]=e.case,t),r),this.results.sort((function(e,t){return s(n.thenEvaluator.setValue(e).evaluate(),n.thenEvaluator.setValue(t).evaluate())})))}}},re=function(e){return null==e?"asc":e.toLowerCase()},oe=function(e){var t=this,n=!1;return function(r){var o=r.target.result;if(o)if(n&&t.results.length!==t.limitRecord){var i=o.value;t.shouldAddValue(i)&&t.pushResult(i),o.continue()}else n=!0,o.advance(t.skipRecord);else e()}},ie=function(e){var t=this,n=!1;return function(r){var o=r.target.result;if(o)if(n){var i=o.value;t.shouldAddValue(i)&&t.pushResult(i),o.continue()}else n=!0,o.advance(t.skipRecord);else e()}},se=function(e){var t=this;return function(n){var r=n.target.result;if(r&&t.results.length!==t.limitRecord){var o=r.value;t.shouldAddValue(o)&&t.pushResult(o),r.continue()}else e()}},ae=function(e){var t=this;return function(n){var r=n.target.result;if(r){var o=r.value;t.shouldAddValue(o)&&t.pushResult(o),r.continue()}else e()}},ue=function(e){var t,n,r=e.split("%");switch(r[1]?(t=r[1],n=r.length>2?l.Any:l.Last):(t=r[0],n=l.First),n){case l.First:return new RegExp("^"+t,"i");case l.Last:return new RegExp(t+"$","i");default:return new RegExp(""+t,"i")}},ce=function(e){return"object"===T(e)&&!(e instanceof RegExp)},le=function(e){if(ce(e)){var t={};for(var n in e)t[n]=null!=e[n]&&ce(e[n])?le(e[n]):e[n];return t}return e},fe=function(e,t,n){var r=T(e);if(r!==T(t))return!1;switch(r===i.DateTime&&(e=e.getTime(),t=t.getTime()),n){case u.GreaterThan:return e>t;case u.LessThan:return e<t;case u.LessThanEqualTo:return e<=t;case u.GreaterThanEqualTo:return e>=t;case u.NotEqualTo:return e!==t;default:return e===t}},he=function(){function e(e,t){this.where=le(e),this.checkFlag=t}return e.prototype.remove=function(e){var t=e.pop();delete e.reduce((function(e,t){return e&&e[t]}),this.where)[t]},e.prototype.check=function(e){var t=!0;if(!this.checkFlag)return t;for(var n in this.where){if(!t)return t;var r=this.where[n],o=e[n];if("object"===T(r))for(var i in r){if(!t)return t;switch(i){case u.In:t=this.checkIn(n,o);break;case u.Like:t=this.checkLike_(n,o);break;case u.Regex:t=this.checkRegex(n,o);break;case u.Between:case u.GreaterThan:case u.LessThan:case u.GreaterThanEqualTo:case u.LessThanEqualTo:case u.NotEqualTo:t=this.checkComparisionOp_(n,o,i);break;default:t=!1}}else t=fe(r,o)}return t},e.prototype.checkIn=function(e,t){return null!=this.where[e][u.In].find((function(e){return fe(e,t)}))},e.prototype.checkLike_=function(e,t){return ue(this.where[e][u.Like]).test(t)},e.prototype.checkRegex=function(e,t){return this.where[e][u.Regex].test(t)},e.prototype.checkComparisionOp_=function(e,t,n){var r=this.where[e][n];return n!=u.Between?fe(t,r,n):fe(t,r.low,">=")&&fe(t,r.high,"<=")},e}(),de=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.shouldEvaluateLimitAtEnd=!1,t.shouldEvaluateSkipAtEnd=!1,t}return de(t,e),t.prototype.goToWhereLogic=function(){var e=this.query,t=W(e.where);if(!this.objectStore.indexNames.contains(t)){var n=this.getColumnInfo(t),o=new b(null==n?r.ColumnNotExist:r.EnableSearchOff,{column:t});return k(o)}var i=e.where[t];if("object"!==T(i)){s=R(e.where)>1;return this.whereCheckerInstance=new he(e.where,s),this.whereCheckerInstance.remove([t]),this.executeWhereLogic(t,i,null,"next")}var s=R(i)>1||R(e.where)>1;this.whereCheckerInstance=new he(e.where,s);var a=W(i);switch(this.whereCheckerInstance.remove([t,a]),a){case u.Like:var c=ue(i[u.Like]);return this.executeRegexLogic(t,c);case u.Regex:return this.executeRegexLogic(t,i[u.Regex]);case u.In:return this.executeInLogic(t,i[u.In]);case u.Between:case u.GreaterThan:case u.LessThan:case u.GreaterThanEqualTo:case u.LessThanEqualTo:return this.executeWhereLogic(t,i,a,"next");case u.Aggregate:break;default:return this.executeWhereLogic(t,i,null,"next")}},t}(C),ye=function(e,t){var n=this;return function(r){var o=r.target.result;if(n.results.length!==n.limitRecord&&o){var i=o.value;n.shouldAddValue(i)&&t(i),o.continue()}else e()}},me=function(e,t){var n=this;return function(r){var o=r.target.result;if(o){var i=o.value;n.shouldAddValue(i)&&t(i),o.continue()}else e()}},ge=function(e){var t=this;return function(n){var r=n.target.result;if(r){var o=r.value;t.shouldAddValue(o)&&t.pushResult(o),r.continue()}else e()}},ve=function(e,t){var n=this;return function(r){var o=r.target.result;n.results.length!==n.limitRecord&&o?(n.shouldAddValue(o)&&t(o.value),o.continue()):e()}},be=function(e,t){var n=this;return function(r){var o=r.target.result;o?(n.shouldAddValue(o)&&t(o.value),o.continue()):e()}},we=function(e){var t=this;return function(n){var r=n.target.result;t.results.length!==t.limitRecord&&r?(t.shouldAddValue(r)&&t.pushResult(r.value),r.continue()):e()}},_e=function(e){var t=this;return function(n){var r=n.target.result;r?(t.shouldAddValue(r)&&t.pushResult(r.value),r.continue()):e()}},ke=function(){return(ke=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},xe=function(){function e(e){this.joinQueryStack_=[],this.currentQueryStackIndex_=0,this.tablesFetched=[],this.results=[],this.select=e}return Object.defineProperty(e.prototype,"query",{get:function(){return this.select.query},enumerable:!1,configurable:!0}),e.prototype.getTable=function(e){return this.select.table(e)},e.prototype.executeSelect=function(e){return new Se(e,this.select.util).execute(this.select.db)},e.prototype.execute=function(){var e=this,t=this.query;this.joinQueryStack_=T(t.join)===i.Object?[t.join]:t.join;for(var n=t.from,r=[n],o=0,s=this.joinQueryStack_.length;o<s;o++){var a=this.joinQueryStack_[o],u=this.getJoinTableInfo_(a.on);a.with===u.table1.table&&(u={table1:u.table2,table2:u.table1});var c=this.checkJoinQuery_(u,a);if(c)return k(c);this.joinQueryStack_[o].joinTableInfo=u,r.push(a.with)}return this.select.isTxQuery||this.select.util.createTransaction(r),this.executeSelect({from:n,where:t.where,case:t.case,flatten:t.flatten}).then((function(t){return e.results=t.map((function(t){var n;return(n={})[e.currentQueryStackIndex_]=t,n})),e.tablesFetched.push(n),e.startExecutingJoinLogic_()}))},e.prototype.onJoinQueryFinished_=function(){var e=this;if(this.results.length>0)try{var t=[],n=Object.keys(this.results[0]).length,o=function(e,t){if(null!=e.as)for(var n in e.as)void 0===t[e.as[n]]&&(t[e.as[n]]=t[n],delete t[n]);return t};this.results.forEach((function(r){for(var i=r[0],s=1;s<n;s++){var a=e.joinQueryStack_[s-1];i=ke(ke({},i),o(a,r[s]))}t.push(i)})),this.select.results=t,this.select.setLimitAndSkipEvaluationAtEnd_(),this.select.query.flatten=null;try{this.select.processOrderBy()}catch(e){return k(new b(r.InvalidOrderQuery,e.message))}try{this.select.processGroupDistinctAggr()}catch(e){return k(new b(r.InvalidGroupQuery,e.message))}}catch(e){return k(new b(r.InvalidJoinQuery,e.message))}},e.prototype.startExecutingJoinLogic_=function(){var e=this,t=this.joinQueryStack_[this.currentQueryStackIndex_];if(!t)return this.onJoinQueryFinished_();try{var n=t.joinTableInfo;return this.executeSelect({from:t.with,where:t.where,case:t.case,flatten:t.flatten}).then((function(r){return e.jointables(t.type,n,r),e.tablesFetched.push(n.table2.table),++e.currentQueryStackIndex_,e.startExecutingJoinLogic_()}))}catch(e){return k(new b(r.InvalidJoinQuery,e.message))}},e.prototype.jointables=function(e,t,n){var r,o,i,s,a=this,u=[],c=t.table1.column,l=t.table2.column,f=this.tablesFetched.indexOf(t.table1.table),h=this.currentQueryStackIndex_+1;switch(e){case"left":i=0,s={},a.getTable(t.table2.table).columns.forEach((function(e){s[e.name]=null})),a.results.forEach((function(e){r=[],o=1===h?function(t){e[f][c]===t[l]&&r.push(t)}:function(t){var n=e[f];null!=n&&n[c]===t[l]&&r.push(t)},n.forEach(o),0===r.length&&(r=[s]),r.forEach((function(t){u[i]=ke({},e),u[i++][h]=t}))}));break;default:!function(){var e=0;a.results.forEach((function(t){n.forEach((function(n){t[f][c]===n[l]&&(u[e]=ke({},t),u[e++][h]=n)}))}))}()}this.results=u},e.prototype.getJoinTableInfo_=function(e){var t=(e=F(e)).split("="),n=t[0].split("."),r=t[1].split(".");return{table1:{table:n[0],column:n[1]},table2:{table:r[0],column:r[1]}}},e.prototype.checkJoinQuery_=function(e,t){var n,o=e.table1,i=e.table2,s=this.getTable(o.table),a=this.getTable(i.table);return t.with!==i.table&&(n=new b(r.InvalidJoinQuery,"on value should contains value of with")),null==s.columns.find((function(e){return e.name===o.column}))?n=new b(r.InvalidJoinQuery,"column "+o.column+" does not exist in table "+o.table):null==a.columns.find((function(e){return e.name===i.column}))&&(n=new b(r.InvalidJoinQuery,"column "+i.column+" does not exist in table "+i.table)),null==t.as&&(t.as={}),s.columns.every((function(e){var s=a.columns.find((function(t){return t.name===e.name&&t.name!==o.column}));return null==s||null!=t.as[s.name]||(n=new b(r.InvalidJoinQuery,"column "+e.name+" exist in both table "+o.table+" & "+i.table),!1)})),n},e}(),Ce=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Te=function(){return(Te=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Ee=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},Se=function(e){function t(t,n){var r=e.call(this)||this;return r.sorted=!1,r.isSubQuery=!1,r.thenEvaluator=new Q,r.returnResult_=function(){if(r.results.length>0){if(r.query.flatten){var e=[],t={};r.query.flatten.forEach((function(n){r.results.forEach((function(r,o){r[n].forEach((function(t){var o;e.push(Te(Te({},r),((o={})[n]=t,o)))})),t[o]=!0}))}));var n=0;N(t).forEach((function(e){r.results.splice(Number(e)-n,1),++n})),r.results=r.results.concat(e)}r.processGroupDistinctAggr(),r.processOrderBy(),r.shouldEvaluateSkipAtEnd&&r.results.splice(0,r.query.skip),r.shouldEvaluateLimitAtEnd&&(r.results=r.results.slice(0,r.query.limit))}return r.results},r.query=t,r.util=n,r.tableName=t.from,r.setPushResult(),D(r.query.where)?(r.isArrayQry=!0,r.setLimitAndSkipEvaluationAtEnd_()):(r.skipRecord=t.skip,r.limitRecord=t.limit),t.order?((D(t.order)||t.order.case||"object"==typeof t.order.by)&&(r.query.order.idbSorting=!1),r.setLimitAndSkipEvaluationAtEnd_()):t.groupBy&&r.setLimitAndSkipEvaluationAtEnd_(),r}return Ce(t,e),t.prototype.execute=function(e){this.db=e;try{var t=new q(e).validate(s.Select,this.query);return t?k(t):(this.initTransaction_(),(null==this.query.join?null!=this.query.where?D(this.query.where)?this.processWhereArrayQry():this.processWhere_():this.executeWhereUndefinedLogic():this.executeJoinQuery()).then(this.returnResult_.bind(this)))}catch(e){return this.onException(e)}},t.prototype.processWhereArrayQry=function(){var e=this;this.isArrayQry=!0;var t,n=this.query.where,r=this.primaryKey(),o=!0,i=[],s=function(){if(t===u.And){!0===o?i=e.results:i.length>0&&(s=[],e.results.forEach((function(e){var t;t=e[r],i.findIndex((function(e){return e[r]===t}))>=0&&s.push(e)})),i=s,s=null)}else i.length>0?(e.results=Ee(Ee([],i),e.results),e.removeDuplicates(),i=e.results):i=e.results;var s;if(o=!1,n.length>0)return e.results=[],a();e.results=i},a=function(){return e.query.where=n.shift(),e.query.where[u.Or]&&1===R(e.query.where)?(t=u.Or,e.query.where=e.query.where[u.Or]):t=u.And,e.processWhere_().then(s)};return a()},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransactionIfNotExist([this.tableName],c.ReadOnly),this.objectStore=this.util.objectStore(this.tableName)},t.prototype.processWhere_=function(){var e=this;return this.shouldAddValue=function(t){return e.whereCheckerInstance.check(t)},this.query.where.or&&this.processOrLogic_(),this.goToWhereLogic().then((function(){return e.onWhereEvaluated()}))},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQueryFinish_=function(){this.isOr=!1,this.results=this.orInfo.results,this.orInfo=null,this.removeDuplicates()},t.prototype.orQuerySuccess_=function(){if(this.orInfo.results=Ee(Ee([],this.orInfo.results),this.results),!this.query.limit||this.query.limit>this.orInfo.results.length){this.results=[];var e=W(this.orInfo.orQuery);if(null!=e){var t={};return t[e]=this.orInfo.orQuery[e],delete this.orInfo.orQuery[e],this.query.where=t,this.goToWhereLogic().then(this.onWhereEvaluated.bind(this))}}return this.orQueryFinish_()},t.prototype.processOrLogic_=function(){this.isOr=!0;var e=this.query.where;this.orInfo={orQuery:e.or,results:[]},delete e.or},t}(pe);Se.prototype.executeInLogic=function(e,t){var n=this,r=this.skipRecord,o=function(e){0===r?n.pushResult(e):--r},i=function(){if(!1===n.shouldEvaluateLimitAtEnd&&!1===n.shouldEvaluateSkipAtEnd){if(n.skipRecord&&n.limitRecord)return ye;if(n.skipRecord)return me;n.limitRecord}return ge}(),s=this.objectStore.index(e);return _(t.map((function(e){return t=e,d((function(e,r){var a=s.openCursor(n.util.keyRange(t));a.onsuccess=i.call(n,e,o),a.onerror=r}));var t})))},Se.prototype.executeWhereUndefinedLogic=function(){var e,t=this;if(this.query.order&&!1!==this.query.order.idbSorting&&this.query.order.by){if(!this.objectStore.indexNames.contains(this.query.order.by))return k(new b(r.ColumnNotExist,{column:this.query.order.by,isOrder:!0}));var n=this.query.order.type&&"desc"===this.query.order.type.toLowerCase()?"prev":"next";this.sorted=!0,e=this.objectStore.index(this.query.order.by).openCursor(null,n)}else e=this.objectStore.openCursor();var o=function(){if(!1===t.shouldEvaluateLimitAtEnd&&!1===t.shouldEvaluateSkipAtEnd){if(t.skipRecord&&t.limitRecord)return M;if(t.skipRecord)return L;if(t.limitRecord)return P}return B}();return d((function(n,r){e.onerror=r,e.onsuccess=o.call(t,n)}))},Se.prototype.executeWhereLogic=function(e,t,n,r){var o=this;t=n?t[n]:t;var i=this.objectStore.index(e).openCursor(this.util.keyRange(t,n),r),s=function(){if(!1===o.shouldEvaluateLimitAtEnd&&!1===o.shouldEvaluateSkipAtEnd){if(o.skipRecord&&o.limitRecord)return oe;if(o.skipRecord)return ie;if(o.limitRecord)return se}return ae}();return d((function(e,t){i.onerror=t,i.onsuccess=s.call(o,e)}))},Se.prototype.executeRegexLogic=function(e,t){var n=this,r=this.skipRecord,o=function(e){0===r?n.pushResult(e):--r};this.shouldAddValue=function(e){return t.test(e.key)&&n.whereCheckerInstance.check(e.value)};var i=this.objectStore.index(e).openCursor(),s=function(){if(!1===n.shouldEvaluateLimitAtEnd&&!1===n.shouldEvaluateSkipAtEnd){if(n.skipRecord&&n.limitRecord)return ve;if(n.skipRecord)return be;if(n.limitRecord)return we}return _e}();return d((function(e,t){i.onerror=t,i.onsuccess=s.call(n,e,o)}))},Se.prototype.setLimitAndSkipEvaluationAtEnd_=function(){this.query.limit&&(this.shouldEvaluateLimitAtEnd=!0),this.query.skip&&(this.shouldEvaluateSkipAtEnd=!0)},Se.prototype.setPushResult=function(){var e=this;this.query.case?this.pushResult=function(t){var n;for(n in e.thenEvaluator.setCaseAndValue(e.query.case,t),e.query.case)t[n]=e.thenEvaluator.setColumn(n).evaluate();e.results.push(t)}:this.pushResult=function(t){e.results.push(t)}},Se.prototype.removeDuplicates=function(){var e=this.results;this.results=null;for(var t=this.primaryKey(),n={},r=0,o=e.length;r<o;r++)n[e[r][t]]=e[r];for(var r in e=[],n)e.push(n[r]);this.results=e},Se.prototype.executeJoinQuery=function(){return new xe(this).execute()},Se.prototype.processGroupDistinctAggr=function(){if(this.query.distinct){var e=[],t=this.results[0];for(var n in t)e.push(n);var r=this.primaryKey(),o=e.indexOf(r);e.splice(o,1),this.query.groupBy=e.length>0?e:null}this.query.groupBy?this.query.aggregate?this.executeAggregateGroupBy():this.processGroupBy():this.query.aggregate&&this.processAggregateQry()},Se.prototype.processOrderBy=function(){var e=this.query.order;if(e&&this.results.length>0&&!this.sorted){var t=T(e);if(t===i.Object)ne.call(this,e);else if(t===i.Array){ne.call(this,e[0]);for(var n=function(t,n){var o=e[t-1].by,i=e[t],s=i.by,a=V.call(r,s);if(null!=a){s=a.name,i.type=re(i.type);var u=te(a,i);r.results.sort((function(e,t){return e[o]===t[o]?u(e[s],t[s]):0}))}},r=this,o=1,s=e.length;o<s;o++)n(o)}}},Se.prototype.processAggregateQry=function(){var e,t=this.results,n=t.length,r={};this.results=void 0;var o=function(){var n=0;for(var r in t)n+=t[r][e]?1:0;return n},s=function(){var n=0;for(var r in t)n=n>t[r][e]?n:t[r][e];return n},a=function(){var n=1/0,r=1/0;for(var o in t)n=n<(r=t[o][e]?t[o][e]:1/0)?n:r;return n},u=function(){var n=0;for(var r in t)n+=t[r][e];return n},c=function(){var r=0;for(var o in t)r+=t[o][e];return r/n};for(var l in this.query.aggregate){var f=this.query.aggregate[l],h=T(f),d=void 0;switch(l){case"count":d=o;break;case"max":d=s;break;case"min":d=a;break;case"sum":d=u;break;case"avg":d=c}switch(h){case i.String:r[l+"("+(e=f)+")"]=d();break;case i.Array:for(var p in f)r[l+"("+(e=f[p])+")"]=d()}}for(var l in r)t[0][l]=r[l];this.results=[t[0]]},Se.prototype.executeAggregateGroupBy=function(){var e=this.query.groupBy,t=this.results;this.results=void 0;var n,r,o,s,a={},c=this.query.aggregate,l=function(){var e=function(){return o=(o=a[r])?o["count("+s+")"]:0,o+=t[n][s]?1:0},l=function(){return o=(o=a[r])?o["max("+s+")"]:0,t[n][s]=t[n][s]?t[n][s]:0,o>t[n][s]?o:t[n][s]},f=function(){return o=(o=a[r])?o["min("+s+")"]:1/0,t[n][s]=t[n][s]?t[n][s]:1/0,o<t[n][s]?o:t[n][s]},h=function(){return o=(o=a[r])?o["sum("+s+")"]:0,o+=t[n][s]?t[n][s]:0},d=function(){var e=(o=a[r])?o["sum("+s+")"]:0;e+=t[n][s]?t[n][s]:0,t[n]["sum("+s+")"]=e,o=o?o["count("+s+")"]:0,o+=t[n][s]?1:0,t[n]["count("+s+")"]=o};for(var p in c){var y=c[p],m=T(y),g=void 0;switch(p){case u.Count:g=e;break;case u.Max:g=l;break;case u.Min:g=f;break;case u.Sum:g=h;break;case u.Avg:g=d}switch(m){case i.String:s=y,t[n][p+"("+s+")"]=g();break;case i.Array:for(var v in y)s=y[v],t[n][p+"("+s+")"]=g()}}};if(T(e)===i.String)for(n in t)r=t[n][e],l(),a[r]=t[n];else for(n in t){for(var f in r="",e)r+=t[n][e[f]];l(),a[r]=t[n]}for(var h in t=[],a)t.push(a[h]);if(c.avg)if(T(c.avg)===i.String)for(n in t){var d=t[n]["sum("+c.avg+")"],p=t[n]["count("+c.avg+")"];t[n]["avg("+c.avg+")"]=d/p,c.count!==c.avg&&delete t[n]["count("+c.avg+")"],c.sum!==c.avg&&delete t[n]["sum("+c.avg+")"]}else{var y=T(c.count)===i.String,m=T(c.sum)===i.String;for(n in t)for(var f in c.avg){var g=c.avg[f],v=t[n]["sum("+g+")"],b=t[n]["count("+g+")"];t[n]["avg("+g+")"]=v/b,y&&(c.count!==g||-1===c.count.indexOf(g))&&delete t[n]["count("+g+")"],m&&(c.sum!==g||-1===c.sum.indexOf(g))&&delete t[n]["sum("+g+")"]}}this.results=t},Se.prototype.processGroupBy=function(){var e=this.query.groupBy,t=this.results,n={};if(this.results=this.query.groupBy=null,T(e)!==i.Object)if(T(e)===i.String)for(var r in t)n[t[r][e]]=t[r];else{var o=void 0;for(var r in t){for(var s in o="",e)o+=t[r][e[s]];n[o]=t[r]}}else if(1===Object.keys(e).length){var a=W(e);for(var r in this.thenEvaluator.setCaseAndColumn(e,a),t)n[this.thenEvaluator.setValue(t[r]).evaluate()]=t[r]}else{o=void 0;for(var r in t){for(var s in o="",this.thenEvaluator.setCaseAndValue(e,t[r]),e)o+=this.thenEvaluator.setColumn(s).evaluate();n[o]=t[r]}}for(var r in t=[],n)t.push(n[r]);this.results=t};var Oe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qe=function(e){function t(t,n){var r=e.call(this)||this;return r.resultCount=0,r.query=t,r.util=n,r.tableName=t.from,r}return Oe(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var n=new q(e),r=this.query,o=n.validate(s.Count,r);if(o)return k(o);try{var i=function(){var n=new Se(t.query,t.util);return n.isTxQuery=t.isTxQuery,n.execute(e).then((function(e){t.resultCount=e.length}))};return this.initTransaction_(),(null==r.join?null!=r.where?r.where.or||D(this.query.where)?i():this.goToWhereLogic():this.executeWhereUndefinedLogic():i()).then((function(e){return t.resultCount}))}catch(e){this.onException(e)}},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.query.from],c.ReadOnly),this.objectStore=this.util.objectStore(this.query.from)},t}(pe);qe.prototype.executeWhereUndefinedLogic=function(){var e,t,n=this,r=n.objectStore.count?(e=n.objectStore.count(),function(t){return function(){n.resultCount=e.result,t()}}):(e=n.objectStore.openCursor(),function(e){return function(r){(t=r.target.result)?(++n.resultCount,t.continue()):e()}});return d((function(t,n){e.onerror=n,e.onsuccess=r(t)}))},qe.prototype.executeWhereLogic=function(e,t,n){var r,o,i=this;return t=n?t[n]:t,d((function(s,a){1===R(i.query.where)&&i.objectStore.count?(r=i.objectStore.index(e).count(i.util.keyRange(t,n))).onsuccess=function(){i.resultCount=r.result,s()}:(r=i.objectStore.index(e).openCursor(i.util.keyRange(t,n))).onsuccess=function(e){(o=e.target.result)?(i.whereCheckerInstance.check(o.value)&&++i.resultCount,o.continue()):s()},r.onerror=a}))},qe.prototype.executeRegexLogic=function(e,t){var n,r=this,o=this.objectStore.index(e).openCursor();return this.shouldAddValue=function(e){return t.test(e.key)&&r.whereCheckerInstance.check(e.value)},d((function(e,t){o.onerror=t,o.onsuccess=function(t){(n=t.target.result)?(r.shouldAddValue(n)&&++r.resultCount,n.continue()):e()}}))},qe.prototype.executeInLogic=function(e,t){var n,r=this,o=this.objectStore.index(e);return _(t.map((function(e){return t=e,i=r.util.keyRange(t),r.objectStore.count?d((function(e,t){var n=o.count(i);n.onsuccess=function(t){r.resultCount+=t.target.result,e()},n.onerror=t})):d((function(e,t){var s=o.openCursor(i);s.onsuccess=function(t){(n=t.target.result)?(r.whereCheckerInstance.check(n.value)&&++r.resultCount,n.continue()):e()},s.onerror=t}));var t,i})))};var je=function(e,t){for(var n in e)if(T(e[n])!==i.Object)t[n]=e[n];else for(var r in e[n]){switch(r){case"+":t[n]+=e[n][r];break;case"-":t[n]-=e[n][r];break;case"*":t[n]*=e[n][r];break;case"/":t[n]/=e[n][r];break;case"{push}":t[n].push(e[n][r]);break;default:t[n]=e[n]}break}return t},Ie=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),$e=function(e){function t(t,n){var r=e.call(this)||this;return r.query=t,r.util=n,r.tableName=t.in,r}return Ie(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var n=this.query;try{var r=new q(e).validate(s.Update,n);if(r)return k(r);this.initTransaction();return(null!=n.where?n.where.or||D(n.where)?this.executeComplexLogic_():this.goToWhereLogic():this.executeWhereUndefinedLogic()).then((function(){return t.rowAffected}))}catch(e){return this.onException(e)}},t.prototype.executeComplexLogic_=function(){var e=this,t=this.query,n=new Se({from:t.in,where:t.where,ignoreCase:t.ignoreCase},this.util);return n.isTxQuery=this.isTxQuery,n.execute(this.db).then((function(n){var r,o,i=e.primaryKey(t.in),s=[];n.forEach((function(e){s.push(e[i])})),n=null;var a=((r={})[i]=((o={})[u.In]=s,o),r);return e.query.where=a,e.initTransaction(),e.goToWhereLogic()}))},t.prototype.initTransaction=function(){var e=this.query.in;this.isTxQuery||this.util.createTransaction([e]),this.objectStore=this.util.objectStore(e)},t}(pe);$e.prototype.executeWhereUndefinedLogic=function(){var e=this,t=this.objectStore.openCursor(),n=this.query.set;return d((function(r,o){t.onsuccess=function(t){var i=t.target.result;if(i)try{var s=i.update(je(n,i.value));s.onsuccess=function(){++e.rowAffected,i.continue()},s.onerror=o}catch(e){o(e)}else r()},t.onerror=o}))},$e.prototype.executeWhereLogic=function(e,t,n){var r=this;t=n?t[n]:t;var o=this.objectStore.index(e).openCursor(this.util.keyRange(t,n)),i=this.query.set;return d((function(e,t){o.onsuccess=function(n){var o=n.target.result;if(o)if(r.whereCheckerInstance.check(o.value))try{var s=o.update(je(i,o.value));s.onsuccess=function(){++r.rowAffected,o.continue()},s.onerror=t}catch(e){t(e)}else o.continue();else e()},o.onerror=t}))},$e.prototype.executeRegexLogic=function(e,t){var n,r=this,o=this.objectStore.index(e).openCursor();this.shouldAddValue=function(e){return t.test(e.key)&&r.whereCheckerInstance.check(e.value)};var i=this.query.set;return d((function(e,t){o.onsuccess=function(o){if(n=o.target.result)if(r.shouldAddValue(n))try{var s=n.update(je(i,n.value));s.onsuccess=function(){++r.rowAffected,n.continue()},s.onerror=t}catch(e){t(e)}else n.continue();else e()},o.onerror=t}))},$e.prototype.executeInLogic=function(e,t){var n=this,r=this.objectStore.index(e),o=this.query;return _(t.map((function(e){return t=e,d((function(e,i){var s=r.openCursor(n.util.keyRange(t));s.onsuccess=function(t){var r=t.target.result;if(r){var s=r.value;if(n.whereCheckerInstance.check(s))try{var a=r.update(je(o.set,s));a.onsuccess=function(){++n.rowAffected,r.continue()},a.onerror=i}catch(e){i(e)}else r.continue()}else e()},s.onerror=i}));var t})))};var Ae=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ne=function(){return(Ne=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},De=function(e){function t(t,n){var r=e.call(this)||this;return r.query=t,r.util=n,r}return Ae(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var n,r,o=this.query,i=0,s={},a={},u=!0,c=o.queries,l=c.length;if(c.every((function(e,t){return!(t+1<l&&e.from!==c[t+1].from)||(u=!1,!1)})),u){var f=this.primaryKey(c[0].from);n=function(e){return e[f]}}else n=function(e){var t="";for(var n in e)t+=e[n];return t};var h=function(){if(i<l)return(r=new Se(c[i],t.util)).execute(t.db).then((function(e){return s={},e.forEach((function(e){var t=n(e);0===i?a[t]=e:null!=a[t]&&(s[t]=e)})),i>0&&(a=Ne({},s)),++i,h()}));var e,u=[],f=void 0,d=o.skip,p=o.limit,y=!1,m=function(){u.push(s[e])},g=function(){u.length<p?m():y=!0},v=function(e){0===d?e():--d};if(f=o.skip&&o.limit?function(){v((function(){g()}))}:o.limit?g:o.skip?function(){v((function(){m()}))}:function(){m()},p){for(e in s)if(f(e),y)break}else for(e in s)f(e);return r.results=u,Object.assign(r.query,{order:o.order,join:{}}),r.processOrderBy(),r.processGroupDistinctAggr(),r.results};return h()},t}(C),Re=function(){function e(){}return e.prototype.execute=function(e){return d((function(t,n){var o=indexedDB.deleteDatabase(e);o.onblocked=function(){var e=new b(r.DbBlocked);return n(x(e))},o.onerror=function(e){return n(x(e))},o.onsuccess=function(){t()}}))},e}(),We=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Qe=function(e){function t(t,n){var r=e.call(this)||this;return r.query=t,r.util=n,r}return We(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var n,r=this.query,o=0,i={},s=!0,a=r.length;if(r.every((function(e,t){return!(t+1<a&&e.from!==r[t+1].from)||(s=!1,!1)})),s){var u=this.primaryKey(r[0].from);n=function(e){return e[u]}}else n=function(e){var t="";for(var n in e)t+=e[n];return t};var c=function(){if(o<r.length)return new Se(r[o++],t.util).execute(e).then((function(e){return e.forEach((function(e){i[n(e)]=e})),c()}));var s=[];for(var a in i)s.push(i[a]);return s};return c()},t}(C),Me=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Le=function(e){function t(t,n){var r=e.call(this)||this;return r.query=t,r.util=n,r.tableName=t.from,r}return Me(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var n=new q(e),r=this.query,o=n.validate(s.Remove,r);if(o)return k(o);try{this.initTransaction_();return(null!=r.where?D(r.where)?this.processWhereArrayQry():this.processWhere_():this.executeWhereUndefinedLogic()).then((function(){return t.rowAffected}))}catch(e){return this.onException(e)}},t.prototype.processWhereArrayQry=function(){var e=this,t=new Se(this.query,this.util);return t.isTxQuery=this.isTxQuery,t.execute(this.db).then((function(t){var n,r,o=[],i=e.primaryKey(e.query.from);t.forEach((function(e){o.push(e[i])})),t=null;var s=((n={})[i]=((r={})[u.In]=o,r),n);return e.query[u.Where]=s,e.processWhere_()}))},t.prototype.processWhere_=function(){var e=this;return this.query.where.or&&this.processOrLogic(),this.goToWhereLogic().then((function(){return e.onWhereEvaluated()}))},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.query.from]),this.objectStore=this.util.objectStore(this.query.from)},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQuerySuccess_=function(){var e=this,t=W(this._orInfo.OrQuery);if(null!=t){var n={};return n[t]=this._orInfo.OrQuery[t],delete this._orInfo.OrQuery[t],this.query.where=n,this.goToWhereLogic().then((function(){return e.onWhereEvaluated()}))}this.isOr=!0},t.prototype.processOrLogic=function(){this.isOr=!0;var e=this.query.where;this._orInfo={OrQuery:e.or},delete e.or},t}(pe);Le.prototype.executeInLogic=function(e,t){var n=this,r=this.objectStore.index(e);return _(t.map((function(e){return t=e,d((function(e,o){var i=r.openCursor(n.util.keyRange(t));i.onsuccess=function(t){var r=t.target.result;r?(n.whereCheckerInstance.check(r.value)&&(r.delete(),++n.rowAffected),r.continue()):e()},i.onerror=o}));var t})))},Le.prototype.executeWhereUndefinedLogic=function(){var e,t=this,n=this.objectStore.openCursor();return d((function(r,o){n.onsuccess=function(n){(e=n.target.result)?(e.delete(),++t.rowAffected,e.continue()):r()},n.onerror=o}))},Le.prototype.executeWhereLogic=function(e,t,n){var r,o,i=this;return t=n?t[n]:t,o=this.objectStore.index(e).openCursor(this.util.keyRange(t,n)),d((function(e,t){o.onsuccess=function(t){(r=t.target.result)?(i.whereCheckerInstance.check(r.value)&&(r.delete(),++i.rowAffected),r.continue()):e()},o.onerror=t}))},Le.prototype.executeRegexLogic=function(e,t){var n,r=this,o=this.objectStore.index(e).openCursor();return this.shouldAddValue=function(e){return t.test(e.key)&&r.whereCheckerInstance.check(e.value)},d((function(e,t){o.onsuccess=function(t){(n=t.target.result)?(r.shouldAddValue(n)&&(n.delete(),++r.rowAffected),n.continue()):e()},o.onerror=t}))};var Be=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Pe=function(e){function t(t,n){var r=e.call(this)||this;return r.query=t,r.util=n,r.tableName=t,r}return Be(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var n=this.query;this.isTxQuery||this.util.createTransaction([n,m.tableName]);var r=this.util.objectStore(n).clear();try{return d((function(o,i){r.onsuccess=function(r){var s=t.table(n);for(var a in s.autoIncColumnValue)s.autoIncColumnValue[a]=0;m.set(m.dbSchema,e,t.util).then((function(){o()})).catch(i)},r.onerror=i}))}catch(e){return this.onException(e)}},t}(C),Fe=function(e){return(D(e)?e:e.split(".")).reduce((function(e,t){return e&&e[t]}),self)},Ve=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ue=function(e){function t(t,n){var r=e.call(this)||this;return r.results={},r.reqQueue=[],r.isQueryExecuting=!1,r.isTxStarted_=!1,r.query=t,r.util=n,r}return Ve(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var n=this.validate();return n?k(n):(this.startExecution_(),d((function(e,n){t.onSuccess=e,t.onError=n})).then((function(e){return t.log("transaction finished"),e})))},t.prototype.validate=function(){var e=this.query,t=this.notExistingTable_(e.tables);if(t)return new b(r.TableNotExist,{tableName:t});var n=e.method;return Fe(n)?void 0:new b(r.MethodNotExist,n)},t.prototype.startExecution_=function(){var e=this,t=this.query,n=t.method,r=Fe(n);return this.log("transaction query started"),r.call(this,{data:t.data,insert:function(t){return e.pushReq_({name:s.Insert,query:t})},select:function(t){return e.pushReq_({name:s.Select,query:t})},update:function(t){return e.pushReq_({name:s.Update,query:t})},remove:function(t){return e.pushReq_({name:s.Remove,query:t})},count:function(t){return e.pushReq_({name:s.Count,query:t})},setResult:function(t,n){e.results[t]=n},getResult:function(t){return e.results[t]},abort:function(t){e.abortTx_(t)},start:function(){e.startTx_()}})},t.prototype.log=function(e){this.util.logger.log(e)},t.prototype.startTx_=function(){var e=this;try{this.isTxStarted_=!0;var t=this.query.tables;return t=t.concat(m.tableName),this.util.createTransaction(t).then((function(t){e.onSuccess(e.results)})).catch((function(t){e.onError(t)})),this.processExecutionOfQry_()}catch(e){this.onError(this.onException(e))}},t.prototype.onReqFinished_=function(e){var t=this.reqQueue.shift();this.log("finished request : "+t.name+" "),t&&(e.error?(this.abortTx_("automatic abort of transaction due to error occured"),this.log("transaction aborted due to error occured"),this.onError(e.error)):(this.isQueryExecuting=!1,t.onSuccess&&t.onSuccess(e),this.processExecutionOfQry_()))},t.prototype.abortTx_=function(e){this.reqQueue=[],this.util.abortTransaction(),this.log("transaction aborted. Msg : "+e)},t.prototype.executeRequest_=function(e){var t;this.isQueryExecuting=!0,this.log("executing request : "+e.name+" ");var n=this.onReqFinished_.bind(this),r=e.query;switch(e.name){case s.Select:t=new Se(r,this.util);break;case s.Insert:t=new I(r,this.util);break;case s.Update:t=new $e(r,this.util);break;case s.Remove:t=new Le(r,this.util);break;case s.Count:t=new qe(r,this.util)}t.isTxQuery=!0,t.execute(this.db).then(n).catch((function(e){n({error:e})}))},t.prototype.pushReq_=function(e){var t=this,n=function(){t.reqQueue.push(e)},r=d((function(t,n){e.onSuccess=function(e){t(e)},e.onError=function(e){n(e)}}));return!0===this.isTxStarted_?(n(),this.processExecutionOfQry_()):n(),this.log("request pushed : "+e.name),r},t.prototype.processExecutionOfQry_=function(){!1===this.isQueryExecuting&&this.reqQueue.length>0&&this.executeRequest_(this.reqQueue[0])},t.prototype.notExistingTable_=function(e){var t=this,n=null;return e.every((function(e){return null!=t.table(e)||(n=e,!1)})),n},t}(C),Ge=function(e){var t={name:e.name,version:e.version,tables:[]};return e.tables.forEach((function(e){var n={name:e.name,columns:{}};e.columns.forEach((function(e){n.columns[e.name]=e})),t.tables.push(n)})),t},Je=function(){function e(e){this.middlewares=[],this.util=new w,this.onQryFinished=$?function(e){self.postMessage(e)}:e}return Object.defineProperty(e.prototype,"logger",{get:function(){return this.util.logger},enumerable:!1,configurable:!0}),e.prototype.executeMiddleware_=function(e){var t=this,n=R(this.middlewares)-1;if(n<0)return h();var r={},o=this.db;return Object.defineProperty(r,"database",{get:function(){return Ge(o)}}),d((function(o){var i=0,s=function(){if(i<=n){var a=Fe(t.middlewares[i++])(e,r);a&&a.then||(a=Promise.resolve(a)),a.then((function(e){s()}))}else o()};s()}))},e.prototype.executeQuery=function(e){var t,n=e.query;switch(e.name){case s.OpenDb:t=this.openDb(n);break;case s.InitDb:t=this.initDb(n);break;case s.CloseDb:t=this.closeDb();break;case s.Insert:t=new I(n,this.util).execute(this.db);break;case s.Select:t=new Se(n,this.util).execute(this.db);break;case s.Count:t=new qe(n,this.util).execute(this.db);break;case s.Update:t=new $e(n,this.util).execute(this.db);break;case s.Intersect:t=new De(n,this.util).execute(this.db);break;case s.DropDb:t=this.dropDb();break;case s.Terminate:t=this.terminate();break;case s.Union:t=new Qe(n,this.util).execute(this.db);break;case s.Remove:t=new Le(n,this.util).execute(this.db);break;case s.Clear:t=new Pe(n,this.util).execute(this.db);break;case s.Transaction:t=new Ue(n,this.util).execute(this.db);break;case s.Get:t=m.get(n,this.util);break;case s.Set:t=m.set(n.key,n.value,this.util);break;case s.ImportScripts:t=this.importScripts_(e);break;case s.ChangeLogStatus:this.logger.status=n,t=Promise.resolve();break;case s.Middleware:return Fe(n)?(this.middlewares.push(n),h()):k(new b(r.InvalidMiddleware,n));default:console.error("The Api:-"+e.name+" does not support."),t=h()}return this.logger.log("Executing query "+e.name+" in web worker"),t},e.prototype.callResultMiddleware=function(e,t){return d((function(n){var r=0,o=R(e)-1,i=function(){if(r<=o){var s=e[r++](t);s.then||(s=h(s)),s.then((function(e){t=e,i()}))}else n(t)};i()}))},e.prototype.run=function(e){var t=this,n=[];e.onResult=function(e){n.push((function(t){return e(t)}))},this.executeMiddleware_(e).then((function(r){return t.executeQuery(e).then((function(e){return t.callResultMiddleware(n,e).then((function(e){t.returnResult_({result:e})}))}))})).catch((function(e){n=[];var r={error:x(e)};t.returnResult_(r)}))},e.prototype.importScripts_=function(e){return d((function(t,n){try{importScripts.apply(void 0,e.query),t()}catch(e){n(new b(r.ImportScriptsFailed,e.message))}}))},e.prototype.returnResult_=function(e){this.logger.log("Query finished inside web worker"),this.util&&this.util.emptyTx(),this.onQryFinished(e)},e.prototype.dropDb=function(){var e=this.db.name;return this.terminate().then((function(){return(new Re).execute(e)}))},e.prototype.closeDb=function(){return this.util.close()},e.prototype.terminate=function(){var e=this;return this.closeDb().then((function(){e.db=null}))},e.prototype.openDb=function(e){var t,n=this;return t=this.db&&e.name===this.db.name?this.initDb():this.initDb({name:e.name,tables:[],version:e.version}),this.closeDb().then((function(e){return t.then((function(){return n.db}))}))},e.prototype.initDb=function(e){var t=this;if(!A)return k(new b(r.IndexedDbNotSupported));var n=e?new g(e):this.db;return this.util=new w,d((function(e,r){t.util.initDb(n).then((function(r){r.isCreated?m.get(m.dbSchema,t.util).then((function(o){o&&o.tables.forEach((function(e,t){n.tables[t].autoIncColumnValue=e.autoIncColumnValue})),t.db=n,r.database=Ge(t.db),m.set(m.dbSchema,n,t.util).then((function(){e(r)}))})):m.get(m.dbSchema,t.util).then((function(n){t.db=n,r.database=Ge(t.db),e(r)}))})).catch(r)}))},e}();if($){var Ke=new Je;self.onmessage=function(e){Ke.run(e.data)}}}})})),mt={setup(e,t){e.$worker=yt,e.initQueryManager_()}};async function gt(){await async function(){bt=new pt.Connection,bt.addPlugin(mt)}(),await async function(){wt={name:"playlists",columns:{id:{primaryKey:!0,notNull:!0,dataType:"string"},snapshot:{notNull:!0,dataType:"string"}}},_t={name:"songs",columns:{uid:{primaryKey:!0,notNull:!0,dataType:"string"},unix:{notNull:!0,dataType:"number"},subm_name:{notNull:!0,dataType:"string"},subm_id:{notNull:!0,dataType:"string"},subm_link:{dataType:"string"},subm_images:{dataType:"object"},song_title:{notNull:!0,dataType:"string"},song_link:{dataType:"string"},song_popularity:{dataType:"number"},song_duration:{dataType:"number"},song_islocal:{dataType:"boolean"},song_id:{dataType:"string"},album_name:{dataType:"string"},album_link:{dataType:"string"},artists:{notNull:!0,dataType:"array"},playlist_name:{notNull:!0,dataType:"string"},playlist_link:{notNull:!0,dataType:"string"},playlist_id:{notNull:!0,dataType:"string"}}},kt={name:"sctdb",tables:[wt,_t]},await bt.initDb(kt)}();const e=await async function(){const e=await bt.select({from:"playlists"});let t={};e.forEach((e=>{t[e.id]=e.snapshot}));const n=await async function(e,t){let n="https://api.spotify.com/v1/me/playlists?limit=20",r=!0,o=t,i={update:{},remove:{}};for(;r;){const t=await fetch(n,{method:"GET",headers:lt(e)}),s=await t.json();for(let e of s.items){const t=e.id,a=e.snapshot_id;e.collaborative&&(o.hasOwnProperty(t)?(o[t]!=a&&(i.update[t]=a),delete o[t]):i.update[t]=a),null!=s.next?n=s.next:r=!1}}return i.remove=o,i}(ot,t);return Object.keys(n.remove).forEach((e=>{bt.remove({from:"playlists",where:{id:e}}),bt.remove({from:"songs",where:{playlist_id:e}})})),Object.entries(n.update).forEach((e=>{const[t,n]=e,r={id:t,snapshot:n};bt.insert({into:"playlists",values:[r],upsert:"true"}),bt.remove({from:"songs",where:{playlist_id:t}})})),n}();return 0!=(await async function(e){const t=await async function(e,t){const n=t,r={market:"from_token",limit:"100",fields:"name,id,external_urls,tracks.items(is_local,track(duration_ms,external_urls,name,popularity,id),added_at,added_by(id,external_urls,href),track.album(external_urls,name),track.artists(external_urls,name)),tracks(limit,next,offset)"},o={market:"from_token",limit:"100",fields:"items(is_local,track(duration_ms,external_urls,name,popularity,id),added_at,added_by(id,external_urls,href),track.album(external_urls,name),track.artists(external_urls,name)),limit,next,offset"};let i={},s=[];for(let t in n){let n,u=!0,c=new URL("https://api.spotify.com/v1/playlists/"+t),l=r;for(c.search=new URLSearchParams(l).toString();u;){const t=await fetch(c,{method:"GET",headers:lt(e)});let r=await t.json();null!=n&&(n.tracks.items=r.items,n.tracks.next=r.next,r=n);for(let t of r.tracks.items)try{const n=(a=t.added_at,Date.parse(a)),o=t.added_by.id,u=t.added_by.external_urls.spotify,c=t.track.name,l=t.track.external_urls.spotify,f=t.track.popularity,h=t.is_local,d=t.track.id,p=t.track.duration_ms,y=t.track.album.name,m=t.track.album.external_urls.spotify,g=r.name,v=r.external_urls.spotify,b=r.id;let w=[];for(let e of t.track.artists)w.push({name:e.name,link:e.external_urls.spotify});i.hasOwnProperty(o)||(i[o]=await ft(e,o));const _=i[o][0];let k;try{k=i[o][1][0]}catch{k=null}const x={uid:`${n} ${b} ${d}`,unix:n,subm_name:_,subm_id:o,subm_link:u,subm_images:k,song_title:c,song_link:l,song_popularity:f,song_duration:p,song_islocal:h,song_id:d,album_name:y,album_link:m,artists:w,playlist_name:g,playlist_link:v,playlist_id:b};s.push(x)}catch{}null!=r.tracks.next?(c=new URL(r.tracks.next),n=r,l=o):u=!1}}var a;return{songs:s}}(ot,e.update);return await bt.insert({into:"songs",values:t.songs,upsert:"true"}),t}(e)).songs.length}async function vt(e){return await async function(e){return await bt.select({from:"songs",order:{by:"unix",type:"desc"},limit:e})}(e)}let bt,wt,_t,kt;function xt(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function Ct(e){xt(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}function Tt(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function Et(e,t){xt(2,arguments);var n=Ct(e),r=Ct(t),o=n.getTime()-r.getTime();return o<0?-1:o>0?1:o}function St(e,t){xt(2,arguments);var n=Ct(e),r=Ct(t),o=n.getFullYear()-r.getFullYear(),i=n.getMonth()-r.getMonth();return 12*o+i}function Ot(e,t){xt(2,arguments);var n=Ct(e),r=Ct(t);return n.getTime()-r.getTime()}function qt(e){xt(1,arguments);var t=Ct(e);return t.setHours(23,59,59,999),t}function jt(e){xt(1,arguments);var t=Ct(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function It(e){xt(1,arguments);var t=Ct(e);return qt(t).getTime()===jt(t).getTime()}function $t(e,t){xt(2,arguments);var n,r=Ct(e),o=Ct(t),i=Et(r,o),s=Math.abs(St(r,o));if(s<1)n=0;else{1===r.getMonth()&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-i*s);var a=Et(r,o)===-i;It(Ct(e))&&1===s&&1===Et(e,o)&&(a=!1),n=i*(s-Number(a))}return 0===n?0:n}function At(e,t){xt(2,arguments);var n=Ot(e,t)/1e3;return n>0?Math.floor(n):Math.ceil(n)}var Nt={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function Dt(e){return function(t){var n=t||{},r=n.width?String(n.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}var Rt={date:Dt({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:Dt({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:Dt({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},Wt={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function Qt(e){return function(t,n){var r,o=n||{};if("formatting"===(o.context?String(o.context):"standalone")&&e.formattingValues){var i=e.defaultFormattingWidth||e.defaultWidth,s=o.width?String(o.width):i;r=e.formattingValues[s]||e.formattingValues[i]}else{var a=e.defaultWidth,u=o.width?String(o.width):e.defaultWidth;r=e.values[u]||e.values[a]}return r[e.argumentCallback?e.argumentCallback(t):t]}}function Mt(e){return function(t,n){var r=String(t),o=n||{},i=o.width,s=i&&e.matchPatterns[i]||e.matchPatterns[e.defaultMatchWidth],a=r.match(s);if(!a)return null;var u,c=a[0],l=i&&e.parsePatterns[i]||e.parsePatterns[e.defaultParseWidth];return u="[object Array]"===Object.prototype.toString.call(l)?function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n}(l,(function(e){return e.test(c)})):function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n}(l,(function(e){return e.test(c)})),u=e.valueCallback?e.valueCallback(u):u,{value:u=o.valueCallback?o.valueCallback(u):u,rest:r.slice(c.length)}}}var Lt,Bt={code:"en-US",formatDistance:function(e,t,n){var r;return n=n||{},r="string"==typeof Nt[e]?Nt[e]:1===t?Nt[e].one:Nt[e].other.replace("{{count}}",t),n.addSuffix?n.comparison>0?"in "+r:r+" ago":r},formatLong:Rt,formatRelative:function(e,t,n,r){return Wt[e]},localize:{ordinalNumber:function(e,t){var n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:Qt({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:Qt({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return Number(e)-1}}),month:Qt({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:Qt({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:Qt({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(Lt={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}},function(e,t){var n=String(e),r=t||{},o=n.match(Lt.matchPattern);if(!o)return null;var i=o[0],s=n.match(Lt.parsePattern);if(!s)return null;var a=Lt.valueCallback?Lt.valueCallback(s[0]):s[0];return{value:a=r.valueCallback?r.valueCallback(a):a,rest:n.slice(i.length)}}),era:Mt({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:Mt({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:Mt({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:Mt({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:Mt({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function Pt(e){return function(e,t){if(null==e)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in t=t||{})t.hasOwnProperty(n)&&(e[n]=t[n]);return e}({},e)}var Ft=1440,Vt=43200;function Ut(e){const t=e-1;return t*t*t+1}function Gt(e){return-e*(e-2)}function Jt(e){return--e*e*e*e*e+1}function Kt(e,{delay:n=0,duration:r=400,easing:o=t}={}){const i=+getComputedStyle(e).opacity;return{delay:n,duration:r,easing:o,css:e=>"opacity: "+e*i}}function zt(e,{delay:t=0,duration:n=400,easing:r=Ut,x:o=0,y:i=0,opacity:s=0}={}){const a=getComputedStyle(e),u=+a.opacity,c="none"===a.transform?"":a.transform,l=u*(1-s);return{delay:t,duration:n,easing:r,css:(e,t)=>`\n\t\t\ttransform: ${c} translate(${(1-e)*o}px, ${(1-e)*i}px);\n\t\t\topacity: ${u-l*t}`}}function Ht(e,t,n={}){const r=getComputedStyle(e),o="none"===r.transform?"":r.transform,i=t.from.width/e.clientWidth,a=t.from.height/e.clientHeight,u=(t.from.left-t.to.left)/i,c=(t.from.top-t.to.top)/a,l=Math.sqrt(u*u+c*c),{delay:f=0,duration:h=(e=>120*Math.sqrt(e)),easing:d=Ut}=n;return{delay:f,duration:s(h)?h(l):h,easing:d,css:(e,t)=>`transform: ${o} translate(${t*u}px, ${t*c}px);`}}const Yt=[];function Xt(t,n=e){let r;const o=[];function i(e){if(a(t,e)&&(t=e,r)){const e=!Yt.length;for(let e=0;e<o.length;e+=1){const n=o[e];n[1](),Yt.push(n,t)}if(e){for(let e=0;e<Yt.length;e+=2)Yt[e][0](Yt[e+1]);Yt.length=0}}}return{set:i,update:function(e){i(e(t))},subscribe:function(s,a=e){const u=[s,a];return o.push(u),1===o.length&&(r=n(i)||e),s(t),()=>{const e=o.indexOf(u);-1!==e&&o.splice(e,1),0===o.length&&(r(),r=null)}}}}const Zt=(()=>{const{subscribe:e,update:t}=Xt([]);let n=0,r={};return{subscribe:e,push:(e,o={})=>{const i={id:++n,msg:e,...r,...o,theme:{...r.theme,...o.theme}};return t((e=>i.reversed?[...e,i]:[i,...e])),n},pop:e=>{t((t=>e?t.filter((t=>t.id!==e)):t.splice(1)))},set:(e,n)=>{t((t=>{const r=t.findIndex((t=>t.id===e));return r>-1&&(t[r]={...t[r],...n}),t}))},_opts:(e={})=>(r={...r,...e,theme:{...r.theme,...e.theme}},r)}})();function en(e){return"[object Date]"===Object.prototype.toString.call(e)}function tn(e,t){if(e===t||e!=e)return()=>e;const n=typeof e;if(n!==typeof t||Array.isArray(e)!==Array.isArray(t))throw new Error("Cannot interpolate values of different type");if(Array.isArray(e)){const n=t.map(((t,n)=>tn(e[n],t)));return e=>n.map((t=>t(e)))}if("object"===n){if(!e||!t)throw new Error("Object cannot be null");if(en(e)&&en(t)){e=e.getTime();const n=(t=t.getTime())-e;return t=>new Date(e+t*n)}const n=Object.keys(t),r={};return n.forEach((n=>{r[n]=tn(e[n],t[n])})),e=>{const t={};return n.forEach((n=>{t[n]=r[n](e)})),t}}if("number"===n){const n=t-e;return t=>e+t*n}throw new Error(`Cannot interpolate ${n} values`)}function nn(t){let n,r,o;return{c(){n=_("div"),n.textContent="✕",E(n,"class","_toastBtn svelte-1r0vvz1"),E(n,"role","button"),E(n,"tabindex","-1")},m(e,i){b(e,n,i),r||(o=T(n,"click",t[4]),r=!0)},p:e,d(e){e&&w(n),r=!1,o()}}}function rn(t){let n,r,o,i,s,a=t[0].msg+"",u=t[0].dismissable&&nn(t);return{c(){n=_("div"),r=_("div"),o=x(),u&&u.c(),i=x(),s=_("progress"),E(r,"class","_toastMsg svelte-1r0vvz1"),E(s,"class","_toastBar svelte-1r0vvz1"),s.value=t[1],E(n,"class","_toastItem svelte-1r0vvz1")},m(e,t){b(e,n,t),v(n,r),r.innerHTML=a,v(n,o),u&&u.m(n,null),v(n,i),v(n,s)},p(e,[t]){1&t&&a!==(a=e[0].msg+"")&&(r.innerHTML=a),e[0].dismissable?u?u.p(e,t):(u=nn(e),u.c(),u.m(n,i)):u&&(u.d(1),u=null),2&t&&(s.value=e[1])},i:e,o:e,d(e){e&&w(n),u&&u.d()}}}function on(e,r,o){let i,{item:s}=r;const a=function(e,r={}){const o=Xt(e);let i,s=e;function a(a,u){if(null==e)return o.set(e=a),Promise.resolve();s=a;let c=i,l=!1,{delay:f=0,duration:h=400,easing:p=t,interpolate:y=tn}=n(n({},r),u);if(0===h)return c&&(c.abort(),c=null),o.set(e=s),Promise.resolve();const m=d()+f;let v;return i=g((t=>{if(t<m)return!0;l||(v=y(e,a),"function"==typeof h&&(h=h(e,a)),l=!0),c&&(c.abort(),c=null);const n=t-m;return n>h?(o.set(e=a),!1):(o.set(e=v(p(n/h))),!0)})),i.promise}return{set:a,update:(t,n)=>a(t(s,e),n),subscribe:o.subscribe}}(s.initial,{duration:s.duration,easing:t});u(e,a,(e=>o(1,i=e)));let c=s.initial;return e.$$set=e=>{"item"in e&&o(0,s=e.item)},e.$$.update=()=>{9&e.$$.dirty&&c!==s.progress&&(1===s.progress||0===s.progress?a.set(s.progress).then((()=>Zt.pop(s.id))):a.set(s.progress),o(3,c=s.progress))},[s,i,a,c,()=>Zt.pop(s.id)]}class sn extends xe{constructor(e){super(),ke(this,e,on,rn,a,{item:0})}}function an(e,t,n){const r=e.slice();return r[4]=t[n],r}function un(t,n){let r,o,i,s,a,u,c,l,f=e;return o=new sn({props:{item:n[4]}}),{key:t,first:null,c(){r=_("li"),be(o.$$.fragment),i=x(),E(r,"style",s=n[1](n[4].theme)),this.first=r},m(e,t){b(e,r,t),we(o,r,null),v(r,i),l=!0},p(e,t){n=e;const i={};1&t&&(i.item=n[4]),o.$set(i),(!l||1&t&&s!==(s=n[1](n[4].theme)))&&E(r,"style",s)},r(){c=r.getBoundingClientRect()},f(){D(r),f(),R(r,c)},a(){f(),f=N(r,c,Ht,{duration:200})},i(e){l||(ce(o.$$.fragment,e),Y((()=>{u&&u.end(1),a||(a=he(r,zt,n[4].intro)),a.start()})),l=!0)},o(e){le(o.$$.fragment,e),a&&a.invalidate(),u=de(r,Kt,{}),l=!1},d(e){e&&w(r),_e(o),e&&u&&u.end()}}}function cn(e){let t,n,r=[],o=new Map,i=e[0];const s=e=>e[4].id;for(let t=0;t<i.length;t+=1){let n=an(e,i,t),a=s(n);o.set(a,r[t]=un(a,n))}return{c(){t=_("ul");for(let e=0;e<r.length;e+=1)r[e].c();E(t,"class","svelte-1wt6bln")},m(e,o){b(e,t,o);for(let e=0;e<r.length;e+=1)r[e].m(t,null);n=!0},p(e,[n]){if(3&n){i=e[0],ae();for(let e=0;e<r.length;e+=1)r[e].r();r=ve(r,n,s,1,e,i,o,t,ge,un,null,an);for(let e=0;e<r.length;e+=1)r[e].a();ue()}},i(e){if(!n){for(let e=0;e<i.length;e+=1)ce(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)le(r[e]);n=!1},d(e){e&&w(t);for(let e=0;e<r.length;e+=1)r[e].d()}}}function ln(e,t,n){let r;u(e,Zt,(e=>n(0,r=e)));let{options:o={}}=t;Zt._opts({duration:4e3,dismissable:!0,initial:1,progress:0,reversed:!1,intro:{x:256},theme:{}});return e.$$set=e=>{"options"in e&&n(2,o=e.options)},e.$$.update=()=>{4&e.$$.dirty&&Zt._opts(o)},[r,e=>Object.keys(e).reduce(((t,n)=>`${t}${n}:${e[n]};`),""),o]}class fn extends xe{constructor(e){super(),ke(this,e,ln,cn,a,{options:2})}}function hn(e,t,n){const r=e.slice();return r[5]=t[n],r}function dn(e,t,n){const r=e.slice();return r[8]=t[n].name,r[9]=t[n].link,r[11]=n,r}function pn(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function yn(e){let t,n,r,o=[],i=new Map,s=e[0];const a=e=>e[5].uid;for(let t=0;t<s.length;t+=1){let n=hn(e,s,t),r=a(n);i.set(r,o[t]=gn(r,n))}return n=new Xe({}),n.$on("infinite",e[1]),{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=x(),be(n.$$.fragment)},m(e,i){for(let t=0;t<o.length;t+=1)o[t].m(e,i);b(e,t,i),we(n,e,i),r=!0},p(e,n){if(5&n){s=e[0],ae();for(let e=0;e<o.length;e+=1)o[e].r();o=ve(o,n,a,1,e,s,i,t.parentNode,ge,gn,t,hn);for(let e=0;e<o.length;e+=1)o[e].a();ue()}},i(e){if(!r){for(let e=0;e<s.length;e+=1)ce(o[e]);ce(n.$$.fragment,e),r=!0}},o(e){for(let e=0;e<o.length;e+=1)le(o[e]);le(n.$$.fragment,e),r=!1},d(e){for(let t=0;t<o.length;t+=1)o[t].d(e);e&&w(t),_e(n,e)}}}function mn(e){let t,n,r,o,i=e[8]+"",s=wn(e[5].artists,e[11])+"";return{c(){t=_("a"),n=k(i),o=k(s),E(t,"href",r=e[9]),E(t,"target","_blank"),E(t,"class","svelte-56dv4z")},m(e,r){b(e,t,r),v(t,n),b(e,o,r)},p(e,a){1&a&&i!==(i=e[8]+"")&&S(n,i),1&a&&r!==(r=e[9])&&E(t,"href",r),1&a&&s!==(s=wn(e[5].artists,e[11])+"")&&S(o,s)},d(e){e&&w(t),e&&w(o)}}}function gn(t,n){let r,o,i,s,a,u,c,l,f,h,d,p,y,m,g,C,T,O,q,j,I,$,A,R,W,Q,M,L,B,P,F=n[5].song_title+"",V=n[5].playlist_name+"",U=n[5].subm_name+"",G=n[2](n[5].unix)+"",J=e,K=n[5].artists,z=[];for(let e=0;e<K.length;e+=1)z[e]=mn(dn(n,K,e));return{key:t,first:null,c(){r=_("div"),o=_("div"),i=_("h1"),s=_("a"),a=k(F),c=x(),l=_("h2"),f=k("by \n\t\t\t\t\t");for(let e=0;e<z.length;e+=1)z[e].c();h=x(),d=_("h3"),p=k("added to "),y=_("a"),m=k(V),C=k(" \n\t\t\t\t\tby "),T=_("a"),O=_("b"),q=k(U),I=x(),$=k(G),A=x(),R=_("br"),W=x(),Q=_("br"),E(s,"href",u=n[5].song_link),E(s,"target","_blank"),E(s,"class","svelte-56dv4z"),E(i,"class","svelte-56dv4z"),E(l,"class","svelte-56dv4z"),E(y,"href",g=n[5].playlist_link),E(y,"target","_blank"),E(y,"class","svelte-56dv4z"),E(T,"href",j=n[5].subm_link),E(T,"target","_blank"),E(T,"class","svelte-56dv4z"),E(d,"class","svelte-56dv4z"),this.first=r},m(e,t){b(e,r,t),v(r,o),v(o,i),v(i,s),v(s,a),v(o,c),v(o,l),v(l,f);for(let e=0;e<z.length;e+=1)z[e].m(l,null);v(o,h),v(o,d),v(d,p),v(d,y),v(y,m),v(d,C),v(d,T),v(T,O),v(O,q),v(d,I),v(d,$),v(o,A),v(o,R),v(o,W),v(o,Q),P=!0},p(e,t){if(n=e,(!P||1&t)&&F!==(F=n[5].song_title+"")&&S(a,F),(!P||1&t&&u!==(u=n[5].song_link))&&E(s,"href",u),1&t){let e;for(K=n[5].artists,e=0;e<K.length;e+=1){const r=dn(n,K,e);z[e]?z[e].p(r,t):(z[e]=mn(r),z[e].c(),z[e].m(l,null))}for(;e<z.length;e+=1)z[e].d(1);z.length=K.length}(!P||1&t)&&V!==(V=n[5].playlist_name+"")&&S(m,V),(!P||1&t&&g!==(g=n[5].playlist_link))&&E(y,"href",g),(!P||1&t)&&U!==(U=n[5].subm_name+"")&&S(q,U),(!P||1&t&&j!==(j=n[5].subm_link))&&E(T,"href",j),(!P||1&t)&&G!==(G=n[2](n[5].unix)+"")&&S($,G)},r(){B=r.getBoundingClientRect()},f(){D(r),J()},a(){J(),J=N(r,B,Ht,{duration:2e3,easing:Jt})},i(e){P||(Y((()=>{L&&L.end(1),M||(M=he(o,zt,{duration:3e3,x:-300,opacity:0,easing:Jt})),M.start()})),P=!0)},o(e){M&&M.invalidate(),L=de(o,zt,{duration:2e3,x:300,opacity:0,easing:Jt}),P=!1},d(e){e&&w(r),function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(z,e),e&&L&&L.end()}}}function vn(t){let n;return{c(){n=_("p"),n.innerHTML="fetching your collaborative playlists from spotify.\n\t\t<br/> \n\t\t<br/>\n\t\tif this is your first time launching this page, this might take a while."},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&w(n)}}}function bn(e){let t,n,r={ctx:e,current:null,token:null,hasCatch:!1,pending:vn,then:yn,catch:pn,blocks:[,,,]};return ye(gt(),r),{c(){t=_("main"),r.block.c()},m(e,o){b(e,t,o),r.block.m(t,r.anchor=null),r.mount=()=>t,r.anchor=null,n=!0},p(t,[n]){{const o=(e=t).slice();r.block.p(o,n)}},i(e){n||(ce(r.block),n=!0)},o(e){for(let e=0;e<3;e+=1){le(r.blocks[e])}n=!1},d(e){e&&w(t),r.block.d(),r.token=null,r=null}}}function wn(e,t){return e.length-1==t?"":e.length-2==t?" & ":", "}function _n(e,t,n){let r=20,o=[],i=!1;return history.pushState({},"feed","/spotify-collab-tracker"),M((()=>{setInterval((()=>{console.log("Fetching new data..."),gt().then((e=>{e&&vt(r).then((e=>{n(0,o=e),i=!0})).then(Zt.push("Yo, someone did something!"))}))}),12e4),setInterval((()=>{n(0,o)}),1e4)})),[o,function({detail:{loaded:e,complete:t}}){vt(r).then((s=>{s.length!=o.length||i?(r+=20,n(0,o=s),i=!1,e()):t()}))},function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};xt(2,arguments);var r=n.locale||Bt;if(!r.formatDistance)throw new RangeError("locale must contain formatDistance property");var o=Et(e,t);if(isNaN(o))throw new RangeError("Invalid time value");var i,s,a=Pt(n);a.addSuffix=Boolean(n.addSuffix),a.comparison=o,o>0?(i=Ct(t),s=Ct(e)):(i=Ct(e),s=Ct(t));var u,c=At(s,i),l=(Tt(s)-Tt(i))/1e3,f=Math.round((c-l)/60);if(f<2)return n.includeSeconds?c<5?r.formatDistance("lessThanXSeconds",5,a):c<10?r.formatDistance("lessThanXSeconds",10,a):c<20?r.formatDistance("lessThanXSeconds",20,a):c<40?r.formatDistance("halfAMinute",null,a):c<60?r.formatDistance("lessThanXMinutes",1,a):r.formatDistance("xMinutes",1,a):0===f?r.formatDistance("lessThanXMinutes",1,a):r.formatDistance("xMinutes",f,a);if(f<45)return r.formatDistance("xMinutes",f,a);if(f<90)return r.formatDistance("aboutXHours",1,a);if(f<Ft){var h=Math.round(f/60);return r.formatDistance("aboutXHours",h,a)}if(f<2520)return r.formatDistance("xDays",1,a);if(f<Vt){var d=Math.round(f/Ft);return r.formatDistance("xDays",d,a)}if(f<86400)return u=Math.round(f/Vt),r.formatDistance("aboutXMonths",u,a);if((u=$t(s,i))<12){var p=Math.round(f/Vt);return r.formatDistance("xMonths",p,a)}var y=u%12,m=Math.floor(u/12);return y<3?r.formatDistance("aboutXYears",m,a):y<9?r.formatDistance("overXYears",m,a):r.formatDistance("almostXYears",m+1,a)}(new Date(e),new Date,{addSuffix:!0})}]}class kn extends xe{constructor(e){super(),ke(this,e,_n,bn,a,{})}}function xn(t){let n;return{c(){n=_("h1"),n.innerHTML='what is this project?\n<p class="svelte-1uxb3mi">this website can help you keep track of all the activity in your collaborative playlist.\nonce logged in, you will be able to see who added what song by what artist to which playlist how long ago. and it&#39;s all sorted chronologically! just keep scrolling to travel back in time. while you browse the page periodically checks if anything has happened and, if anything has, will automatically adjust your feed and tell you. no refreshing required.</p>\nwhy is this project a thing?\n<p class="svelte-1uxb3mi">there&#39;s a good chance this isn&#39;t something you want (or need). however if you and peers enjoy actively making use of the collaborative playlist feature then this is supposed to serve you as a fairly easy and comfortable way of keeping up with recently added songs across a large quantity of playlists.</p>\nis this it?\n<p class="svelte-1uxb3mi">this is a passion project i work on in my spare time. i am aware the current version is very basic but more features are planned and in development. if you want more information or are looking to contribute feel free to check out the <a href="https://github.com/sebastian-stubenvoll/spotify-collab-tracker" target="_blank" class="svelte-1uxb3mi">the github page</a>.</p>',E(n,"class","svelte-1uxb3mi")},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&w(n)}}}class Cn extends xe{constructor(e){super(),ke(this,e,null,xn,a,{})}}function Tn(t){let n,r,o,i,s,a,u,c,l,f,h,d,p,y,m,g;return{c(){n=_("h1"),r=k("how is my data accessed?\n\t"),o=_("p"),o.innerHTML="once you&#39;ve logged in via spotify and granted the required permissions all the requests are sent from <b>your browser directly to spotify</b>. this means none of your private spotify data is ever accessed by the server hosting this website.",i=k("\nhow is my data stored?\n"),s=_("p"),a=k("all of your data is stored "),u=_("b"),u.textContent="locally",c=k(" inside your browser (indexedDB). this is only done to keep the number of requests as low as possible. you can delete the locally stored information at any point via your browser or by clicking "),l=_("button"),l.innerHTML="<b>here</b>",f=k("."),h=k("\ndoes this page store cookies?\n"),d=_("p"),d.textContent="no.",p=k("\ni'm still not sure...\n"),y=_("p"),y.innerHTML='if you have any remaining concerns, feel free to check out the <a href="https://github.com/sebastian-stubenvoll/spotify-collab-tracker" target="_blank" class="svelte-17vdl9c"><b>source code</b></a>.',E(o,"class","svelte-17vdl9c"),E(l,"class","svelte-17vdl9c"),E(s,"class","svelte-17vdl9c"),E(d,"class","svelte-17vdl9c"),E(y,"class","svelte-17vdl9c"),E(n,"class","svelte-17vdl9c")},m(e,w){b(e,n,w),v(n,r),v(n,o),v(n,i),v(n,s),v(s,a),v(s,u),v(s,c),v(s,l),v(s,f),v(n,h),v(n,d),v(n,p),v(n,y),m||(g=T(l,"click",t[0]),m=!0)},p:e,i:e,o:e,d(e){e&&w(n),m=!1,g()}}}function En(e){return[()=>{indexedDB.deleteDatabase("sctdb"),Zt.push("All your data has been deleted!")}]}class Sn extends xe{constructor(e){super(),ke(this,e,En,Tn,a,{})}}function On(t){let n,r,o;return{c(){n=_("button"),n.textContent="×",E(n,"class","svelte-x3sqgi")},m(e,i){b(e,n,i),r||(o=T(n,"click",(function(){s(t[0])&&t[0].apply(this,arguments)})),r=!0)},p(e,[n]){t=e},i:e,o:e,d(e){e&&w(n),r=!1,o()}}}function qn(e,t,n){let{onClose:r}=t;return e.$$set=e=>{"onClose"in e&&n(0,r=e.onClose)},[r]}class jn extends xe{constructor(e){super(),ke(this,e,qn,On,a,{onClose:0})}}function In(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function $n(t){let n,r,o,s,a,u,c,l,f,h,d,p;return{c(){n=_("h1"),r=_("p"),o=_("a"),s=k("login with spotify"),a=x(),u=_("br"),c=x(),l=_("button"),l.textContent="privacy",f=_("button"),f.textContent="about",E(o,"href",t[6]),E(o,"class","svelte-1qhf4fy"),E(l,"class","svelte-1qhf4fy"),E(f,"class","svelte-1qhf4fy"),E(n,"class","svelte-1qhf4fy")},m(e,i){b(e,n,i),v(n,r),v(r,o),v(o,s),v(r,a),v(r,u),v(r,c),v(r,l),v(r,f),d||(p=[T(l,"click",t[3]),T(f,"click",t[2])],d=!0)},p(e,n){t=e},i(e){h||Y((()=>{h=he(r,zt,{duration:2e3,y:t[0]/3,opacity:0,easing:Gt}),h.start()}))},o:e,d(e){e&&w(n),d=!1,i(p)}}}function An(t){let n;return{c(){n=_("h1"),E(n,"class","svelte-1qhf4fy")},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&w(n)}}}function Nn(t){let n,r,o,i,s;Y(t[4]);let a={ctx:t,current:null,token:null,hasCatch:!1,pending:An,then:$n,catch:In,value:6};return ye(t[1],a),{c(){n=_("link"),r=x(),o=C(),a.block.c(),E(n,"rel","stylesheet"),E(n,"href","login.css")},m(e,u){v(document.head,n),b(e,r,u),b(e,o,u),a.block.m(e,a.anchor=u),a.mount=()=>o.parentNode,a.anchor=o,i||(s=T(window,"resize",t[4]),i=!0)},p(e,[n]){{const r=(t=e).slice();r[6]=a.resolved,a.block.p(r,n)}},i(e){ce(a.block)},o:e,d(e){w(n),e&&w(r),e&&w(o),a.block.d(e),a.token=null,a=null,i=!1,s()}}}function Dn(e,t,n){const r=ut();let o;const{open:i}=(s="simple-modal",Q().$$.context.get(s));var s;return[o,r,()=>i(Cn,{},{closeButton:jn}),()=>i(Sn,{},{closeButton:jn}),function(){n(0,o=window.innerHeight)}]}class Rn extends xe{constructor(e){super(),ke(this,e,Dn,Nn,a,{})}}const{window:Wn}=me;function Qn(e){let t,n,r,o,a,u,c,l,f,h,d,p=e[0].closeButton&&Mn(e);var y=e[1];return y&&(u=new y({})),{c(){t=_("div"),n=_("div"),r=_("div"),p&&p.c(),o=x(),a=_("div"),u&&be(u.$$.fragment),E(a,"class","content svelte-ktxllv"),E(a,"style",e[8]),E(r,"class","window svelte-ktxllv"),E(r,"role","dialog"),E(r,"aria-modal","true"),E(r,"style",e[7]),E(n,"class","window-wrap svelte-ktxllv"),E(n,"style",e[6]),E(t,"class","bg svelte-ktxllv"),E(t,"style",e[5])},m(i,c){b(i,t,c),v(t,n),v(n,r),p&&p.m(r,null),v(r,o),v(r,a),u&&we(u,a,null),e[40](r),e[41](n),e[42](t),f=!0,h||(d=[T(r,"introstart",(function(){s(e[12])&&e[12].apply(this,arguments)})),T(r,"outrostart",(function(){s(e[13])&&e[13].apply(this,arguments)})),T(r,"introend",(function(){s(e[14])&&e[14].apply(this,arguments)})),T(r,"outroend",(function(){s(e[15])&&e[15].apply(this,arguments)})),T(t,"mousedown",e[19]),T(t,"mouseup",e[20])],h=!0)},p(i,s){if((e=i)[0].closeButton?p?(p.p(e,s),1&s[0]&&ce(p,1)):(p=Mn(e),p.c(),ce(p,1),p.m(r,o)):p&&(ae(),le(p,1,1,(()=>{p=null})),ue()),y!==(y=e[1])){if(u){ae();const e=u;le(e.$$.fragment,1,0,(()=>{_e(e,1)})),ue()}y?(u=new y({}),be(u.$$.fragment),ce(u.$$.fragment,1),we(u,a,null)):u=null}(!f||256&s[0])&&E(a,"style",e[8]),(!f||128&s[0])&&E(r,"style",e[7]),(!f||64&s[0])&&E(n,"style",e[6]),(!f||32&s[0])&&E(t,"style",e[5])},i(n){f||(ce(p),u&&ce(u.$$.fragment,n),Y((()=>{c||(c=pe(r,e[11],e[0].transitionWindowProps,!0)),c.run(1)})),Y((()=>{l||(l=pe(t,e[10],e[0].transitionBgProps,!0)),l.run(1)})),f=!0)},o(n){le(p),u&&le(u.$$.fragment,n),c||(c=pe(r,e[11],e[0].transitionWindowProps,!1)),c.run(0),l||(l=pe(t,e[10],e[0].transitionBgProps,!1)),l.run(0),f=!1},d(n){n&&w(t),p&&p.d(),u&&_e(u),e[40](null),n&&c&&c.end(),e[41](null),e[42](null),n&&l&&l.end(),h=!1,i(d)}}}function Mn(e){let t,n,r,o,i;const s=[Bn,Ln],a=[];function u(e,n){return 1&n[0]&&(t=!!e[16](e[0].closeButton)),t?0:1}return n=u(e,[-1]),r=a[n]=s[n](e),{c(){r.c(),o=C()},m(e,t){a[n].m(e,t),b(e,o,t),i=!0},p(e,t){let i=n;n=u(e,t),n===i?a[n].p(e,t):(ae(),le(a[i],1,1,(()=>{a[i]=null})),ue(),r=a[n],r?r.p(e,t):(r=a[n]=s[n](e),r.c()),ce(r,1),r.m(o.parentNode,o))},i(e){i||(ce(r),i=!0)},o(e){le(r),i=!1},d(e){a[n].d(e),e&&w(o)}}}function Ln(t){let n,r,o;return{c(){n=_("button"),E(n,"class","close svelte-ktxllv"),E(n,"style",t[9])},m(e,i){b(e,n,i),r||(o=T(n,"click",t[17]),r=!0)},p(e,t){512&t[0]&&E(n,"style",e[9])},i:e,o:e,d(e){e&&w(n),r=!1,o()}}}function Bn(e){let t,n,r;var o=e[0].closeButton;function i(e){return{props:{onClose:e[17]}}}return o&&(t=new o(i(e))),{c(){t&&be(t.$$.fragment),n=C()},m(e,o){t&&we(t,e,o),b(e,n,o),r=!0},p(e,r){if(o!==(o=e[0].closeButton)){if(t){ae();const e=t;le(e.$$.fragment,1,0,(()=>{_e(e,1)})),ue()}o?(t=new o(i(e)),be(t.$$.fragment),ce(t.$$.fragment,1),we(t,n.parentNode,n)):t=null}},i(e){r||(t&&ce(t.$$.fragment,e),r=!0)},o(e){t&&le(t.$$.fragment,e),r=!1},d(e){e&&w(n),t&&_e(t,e)}}}function Pn(e){let t,n,r,o,i=e[1]&&Qn(e);const s=e[39].default,a=c(s,e,e[38],null);return{c(){i&&i.c(),t=x(),a&&a.c()},m(s,u){i&&i.m(s,u),b(s,t,u),a&&a.m(s,u),n=!0,r||(o=T(Wn,"keydown",e[18]),r=!0)},p(e,n){e[1]?i?(i.p(e,n),2&n[0]&&ce(i,1)):(i=Qn(e),i.c(),ce(i,1),i.m(t.parentNode,t)):i&&(ae(),le(i,1,1,(()=>{i=null})),ue()),a&&a.p&&128&n[1]&&f(a,s,e,e[38],n,null,null)},i(e){n||(ce(i),ce(a,e),n=!0)},o(e){le(i),le(a,e),n=!1},d(e){i&&i.d(e),e&&w(t),a&&a.d(e),r=!1,o()}}}function Fn(e,t,n){let{$$slots:r={},$$scope:o}=t;const i=B(),s=P;let{show:a=null}=t,{key:u="simple-modal"}=t,{closeButton:c=!0}=t,{closeOnEsc:l=!0}=t,{closeOnOuterClick:f=!0}=t,{styleBg:h={}}=t,{styleWindowWrap:d={}}=t,{styleWindow:p={}}=t,{styleContent:y={}}=t,{styleCloseButton:m={}}=t,{setContext:g=s}=t,{transitionBg:v=Kt}=t,{transitionBgProps:b={duration:250}}=t,{transitionWindow:w=v}=t,{transitionWindowProps:_=b}=t,{disableFocusTrap:k=!1}=t;const x={closeButton:c,closeOnEsc:l,closeOnOuterClick:f,styleBg:h,styleWindowWrap:d,styleWindow:p,styleContent:y,styleCloseButton:m,transitionBg:v,transitionBgProps:b,transitionWindow:w,transitionWindowProps:_,disableFocusTrap:k};let C,T,E,S,O,q,j,I,$,A,N,D,R,W,Q,F={...x},U=null;const G=e=>e?Object.keys(e).reduce(((t,n)=>`${t}; ${(e=>e.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase())(n)}: ${e[n]}`),""):"",J=e=>!!(e&&e.constructor&&e.call&&e.apply),K=()=>{};let z=K,H=K,Y=K,X=K;const Z=(e,t={},r={},o={})=>{n(1,U=function(e,t={}){return function(n){return new e({...n,props:{...t,...n.props}})}}(e,t)),n(0,F={...x,...r}),n(5,O=G(Object.assign({},{width:window.innerWidth,height:window.innerHeight},F.styleBg))),n(6,q=G(F.styleWindowWrap)),n(7,j=G(F.styleWindow)),n(8,I=G(F.styleContent)),n(9,$=G(F.styleCloseButton)),n(10,A=F.transitionBg),n(11,N=F.transitionWindow),te(),n(12,z=e=>{o.onOpen&&o.onOpen(e),i("open"),i("opening")}),n(13,H=e=>{o.onClose&&o.onClose(e),i("close"),i("closing")}),n(14,Y=e=>{o.onOpened&&o.onOpened(e),i("opened")}),n(15,X=e=>{o.onClosed&&o.onClosed(e),i("closed")})},ee=(e={})=>{U&&(n(13,H=e.onClose||H),n(15,X=e.onClosed||X),n(1,U=null),ne())},te=()=>{S=window.scrollY,D=document.body.style.position,R=document.body.style.overflow,W=document.body.style.width,document.body.style.position="fixed",document.body.style.top=`-${S}px`,document.body.style.overflow="hidden",document.body.style.width="100%"},ne=()=>{document.body.style.position=D||"",document.body.style.top="",document.body.style.overflow=R||"",document.body.style.width=W||"",window.scrollTo(0,S)};g(u,{open:Z,close:ee});let re=!1;return L((()=>{re&&ee()})),M((()=>{n(37,re=!0)})),e.$$set=e=>{"show"in e&&n(21,a=e.show),"key"in e&&n(22,u=e.key),"closeButton"in e&&n(23,c=e.closeButton),"closeOnEsc"in e&&n(24,l=e.closeOnEsc),"closeOnOuterClick"in e&&n(25,f=e.closeOnOuterClick),"styleBg"in e&&n(26,h=e.styleBg),"styleWindowWrap"in e&&n(27,d=e.styleWindowWrap),"styleWindow"in e&&n(28,p=e.styleWindow),"styleContent"in e&&n(29,y=e.styleContent),"styleCloseButton"in e&&n(30,m=e.styleCloseButton),"setContext"in e&&n(31,g=e.setContext),"transitionBg"in e&&n(32,v=e.transitionBg),"transitionBgProps"in e&&n(33,b=e.transitionBgProps),"transitionWindow"in e&&n(34,w=e.transitionWindow),"transitionWindowProps"in e&&n(35,_=e.transitionWindowProps),"disableFocusTrap"in e&&n(36,k=e.disableFocusTrap),"$$scope"in e&&n(38,o=e.$$scope)},e.$$.update=()=>{2097152&e.$$.dirty[0]|64&e.$$.dirty[1]&&re&&(J(a)?Z(a):ee())},[F,U,C,T,E,O,q,j,I,$,A,N,z,H,Y,X,J,ee,e=>{if(F.closeOnEsc&&U&&"Escape"===e.key&&(e.preventDefault(),ee()),U&&"Tab"===e.key&&!F.disableFocusTrap){const t=E.querySelectorAll("*"),n=Array.from(t).filter((e=>e.tabIndex>=0));let r=n.indexOf(document.activeElement);-1===r&&e.shiftKey&&(r=0),r+=n.length+(e.shiftKey?-1:1),r%=n.length,n[r].focus(),e.preventDefault()}},e=>{!F.closeOnOuterClick||e.target!==C&&e.target!==T||(Q=e.target)},e=>{F.closeOnOuterClick&&e.target===Q&&(e.preventDefault(),ee())},a,u,c,l,f,h,d,p,y,m,g,v,b,w,_,k,re,o,r,function(e){V[e?"unshift":"push"]((()=>{E=e,n(4,E)}))},function(e){V[e?"unshift":"push"]((()=>{T=e,n(3,T)}))},function(e){V[e?"unshift":"push"]((()=>{C=e,n(2,C)}))}]}class Vn extends xe{constructor(e){super(),ke(this,e,Fn,Pn,a,{show:21,key:22,closeButton:23,closeOnEsc:24,closeOnOuterClick:25,styleBg:26,styleWindowWrap:27,styleWindow:28,styleContent:29,styleCloseButton:30,setContext:31,transitionBg:32,transitionBgProps:33,transitionWindow:34,transitionWindowProps:35,disableFocusTrap:36},[-1,-1])}}var Un="%[a-f0-9]{2}",Gn=new RegExp(Un,"gi"),Jn=new RegExp("("+Un+")+","gi");function Kn(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),r=e.slice(t);return Array.prototype.concat.call([],Kn(n),Kn(r))}function zn(e){try{return decodeURIComponent(e)}catch(r){for(var t=e.match(Gn),n=1;n<t.length;n++)t=(e=Kn(t,n).join("")).match(Gn);return e}}var Hn=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},n=Jn.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var r=zn(n[0]);r!==n[0]&&(t[n[0]]=r)}n=Jn.exec(e)}t["%C2"]="�";for(var o=Object.keys(t),i=0;i<o.length;i++){var s=o[i];e=e.replace(new RegExp(s,"g"),t[s])}return e}(e)}},Yn=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const n=e.indexOf(t);return-1===n?[e]:[e.slice(0,n),e.slice(n+t.length)]},Xn=function(e,t){for(var n={},r=Object.keys(e),o=Array.isArray(t),i=0;i<r.length;i++){var s=r[i],a=e[s];(o?-1!==t.indexOf(s):t(s,a,e))&&(n[s]=a)}return n},Zn=ht((function(e,t){function n(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function r(e,t){return t.encode?t.strict?encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)):encodeURIComponent(e):e}function o(e,t){return t.decode?Hn(e):e}function i(e){return Array.isArray(e)?e.sort():"object"==typeof e?i(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function s(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function a(e){const t=(e=s(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function u(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function c(e,t){n((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const r=function(e){let t;switch(e.arrayFormat){case"index":return(e,n,r)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===r[e]&&(r[e]={}),r[e][t[1]]=n):r[e]=n};case"bracket":return(e,n,r)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==r[e]?r[e]=[].concat(r[e],n):r[e]=[n]:r[e]=n};case"comma":case"separator":return(t,n,r)=>{const i="string"==typeof n&&n.includes(e.arrayFormatSeparator),s="string"==typeof n&&!i&&o(n,e).includes(e.arrayFormatSeparator);n=s?o(n,e):n;const a=i||s?n.split(e.arrayFormatSeparator).map((t=>o(t,e))):null===n?n:o(n,e);r[t]=a};case"bracket-separator":return(t,n,r)=>{const i=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!i)return void(r[t]=n?o(n,e):n);const s=null===n?[]:n.split(e.arrayFormatSeparator).map((t=>o(t,e)));void 0!==r[t]?r[t]=[].concat(r[t],s):r[t]=s};default:return(e,t,n)=>{void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t),s=Object.create(null);if("string"!=typeof e)return s;if(!(e=e.trim().replace(/^[?#&]/,"")))return s;for(const n of e.split("&")){if(""===n)continue;let[e,i]=Yn(t.decode?n.replace(/\+/g," "):n,"=");i=void 0===i?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?i:o(i,t),r(o(e,t),i,s)}for(const e of Object.keys(s)){const n=s[e];if("object"==typeof n&&null!==n)for(const e of Object.keys(n))n[e]=u(n[e],t);else s[e]=u(n,t)}return!1===t.sort?s:(!0===t.sort?Object.keys(s).sort():Object.keys(s).sort(t.sort)).reduce(((e,t)=>{const n=s[t];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?e[t]=i(n):e[t]=n,e}),Object.create(null))}t.extract=a,t.parse=c,t.stringify=(e,t)=>{if(!e)return"";n((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const o=n=>t.skipNull&&null==e[n]||t.skipEmptyString&&""===e[n],i=function(e){switch(e.arrayFormat){case"index":return t=>(n,o)=>{const i=n.length;return void 0===o||e.skipNull&&null===o||e.skipEmptyString&&""===o?n:null===o?[...n,[r(t,e),"[",i,"]"].join("")]:[...n,[r(t,e),"[",r(i,e),"]=",r(o,e)].join("")]};case"bracket":return t=>(n,o)=>void 0===o||e.skipNull&&null===o||e.skipEmptyString&&""===o?n:null===o?[...n,[r(t,e),"[]"].join("")]:[...n,[r(t,e),"[]=",r(o,e)].join("")];case"comma":case"separator":case"bracket-separator":{const t="bracket-separator"===e.arrayFormat?"[]=":"=";return n=>(o,i)=>void 0===i||e.skipNull&&null===i||e.skipEmptyString&&""===i?o:(i=null===i?"":i,0===o.length?[[r(n,e),t,r(i,e)].join("")]:[[o,r(i,e)].join(e.arrayFormatSeparator)])}default:return t=>(n,o)=>void 0===o||e.skipNull&&null===o||e.skipEmptyString&&""===o?n:null===o?[...n,r(t,e)]:[...n,[r(t,e),"=",r(o,e)].join("")]}}(t),s={};for(const t of Object.keys(e))o(t)||(s[t]=e[t]);const a=Object.keys(s);return!1!==t.sort&&a.sort(t.sort),a.map((n=>{const o=e[n];return void 0===o?"":null===o?r(n,t):Array.isArray(o)?0===o.length&&"bracket-separator"===t.arrayFormat?r(n,t)+"[]":o.reduce(i(n),[]).join("&"):r(n,t)+"="+r(o,t)})).filter((e=>e.length>0)).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[n,r]=Yn(e,"#");return Object.assign({url:n.split("?")[0]||"",query:c(a(e),t)},t&&t.parseFragmentIdentifier&&r?{fragmentIdentifier:o(r,t)}:{})},t.stringifyUrl=(e,n)=>{n=Object.assign({encode:!0,strict:!0},n);const o=s(e.url).split("?")[0]||"",i=t.extract(e.url),a=t.parse(i,{sort:!1}),u=Object.assign(a,e.query);let c=t.stringify(u,n);c&&(c=`?${c}`);let l=function(e){let t="";const n=e.indexOf("#");return-1!==n&&(t=e.slice(n)),t}(e.url);return e.fragmentIdentifier&&(l=`#${r(e.fragmentIdentifier,n)}`),`${o}${c}${l}`},t.pick=(e,n,r)=>{r=Object.assign({parseFragmentIdentifier:!0},r);const{url:o,query:i,fragmentIdentifier:s}=t.parseUrl(e,r);return t.stringifyUrl({url:o,query:Xn(i,n),fragmentIdentifier:s},r)},t.exclude=(e,n,r)=>{const o=Array.isArray(n)?e=>!n.includes(e):(e,t)=>!n(e,t);return t.pick(e,o,r)}}));function er(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function tr(e){let t,n,r,o;const i=[rr,nr],s=[];function a(e,t){return e[0]?1:0}return t=a(e),n=s[t]=i[t](e),{c(){n.c(),r=C()},m(e,n){s[t].m(e,n),b(e,r,n),o=!0},p(e,o){let u=t;t=a(e),t!==u&&(ae(),le(s[u],1,1,(()=>{s[u]=null})),ue(),n=s[t],n||(n=s[t]=i[t](e),n.c()),ce(n,1),n.m(r.parentNode,r))},i(e){o||(ce(n),o=!0)},o(e){le(n),o=!1},d(e){s[t].d(e),e&&w(r)}}}function nr(e){let t,n;return t=new kn({}),{c(){be(t.$$.fragment)},m(e,r){we(t,e,r),n=!0},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){le(t.$$.fragment,e),n=!1},d(e){_e(t,e)}}}function rr(e){let t,n;return t=new Rn({}),{c(){be(t.$$.fragment)},m(e,r){we(t,e,r),n=!0},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){le(t.$$.fragment,e),n=!1},d(e){_e(t,e)}}}function or(t){let n;return{c(){n=k("checking spotify access!")},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&w(n)}}}function ir(e){let t,n,r,o,i={ctx:e,current:null,token:null,hasCatch:!1,pending:or,then:tr,catch:er,blocks:[,,,]};return ye(e[2],i),r=new fn({props:{options:e[1]}}),{c(){t=_("main"),i.block.c(),n=x(),be(r.$$.fragment),E(t,"class","svelte-rliwxb")},m(e,s){b(e,t,s),i.block.m(t,i.anchor=null),i.mount=()=>t,i.anchor=null,b(e,n,s),we(r,e,s),o=!0},p(t,n){{const r=(e=t).slice();i.block.p(r,n)}},i(e){o||(ce(i.block),ce(r.$$.fragment,e),o=!0)},o(e){for(let e=0;e<3;e+=1){le(i.blocks[e])}le(r.$$.fragment,e),o=!1},d(e){e&&w(t),i.block.d(),i.token=null,i=null,e&&w(n),_e(r,e)}}}function sr(e){let t,n;return t=new Vn({props:{$$slots:{default:[ir]},$$scope:{ctx:e}}}),{c(){be(t.$$.fragment)},m(e,r){we(t,e,r),n=!0},p(e,[n]){const r={};33&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){le(t.$$.fragment,e),n=!1},d(e){_e(t,e)}}}function ar(e,t,n){let r;const o=async function(){await async function(){if("undefined"!=typeof window){const e=Zn.parse(window.location.search);if(e.code){if(await async function(e){if(e.state!=localStorage.getItem("state"))return!1;{let t=[];const n={client_id:nt,grant_type:"authorization_code",code:e.code,redirect_uri:rt,code_verifier:localStorage.getItem("verifier")};for(let e in n){const r=encodeURIComponent(e),o=encodeURIComponent(n[e]);t.push(r+"="+o)}t=t.join("&");const r="https://accounts.spotify.com/api/token",o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t});if(200!=o.status)return!1;{const e=await o.json();return ot=e.access_token,it=e.refresh_token,st=1e3*e.expires_in,localStorage.removeItem("verifier"),at=setInterval(ct,st-.1*st),!0}}}(e))return!0}}return!1}()?n(0,r=!0):n(0,r=!1)}();return[r,{duration:1e4},o]}return new class extends xe{constructor(e){super(),ke(this,e,ar,sr,a,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
